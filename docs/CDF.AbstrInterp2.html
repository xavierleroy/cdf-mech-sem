
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module AbstrInterp2</title>
<meta name="description" content="Documentation of Coq module AbstrInterp2" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module AbstrInterp2</h1>
<div class="coq">
<span class="kwd">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.ZArith.html">ZArith</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.micromega.Psatz.html">Psatz</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html">Bool</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html">String</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html">List</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.FSets.FMaps.html">FMaps</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Logic.FunctionalExtensionality.html">FunctionalExtensionality</a></span>.<br/>
<span class="kwd">From</span> <span class="id">CDF</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="CDF.Sequences.html">Sequences</a></span> <span class="id"><a href="CDF.IMP.html">IMP</a></span>.<br/>
<span class="kwd">From</span> <span class="id">CDF</span> <span class="kwd">Require</span> <span class="id"><a href="CDF.AbstrInterp.html">AbstrInterp</a></span>.<br/>
<br/>
<span class="id">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">string_scope</span>.<br/>
<span class="id">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">Z_scope</span>.<br/>
<br/>
<h1> 5.  Static analysis by abstract interpretation, improved version </h1>
<br/>
<h2> 5.5.  Improved interface of abstract domains </h2>
<br/>
<div class="doc">We enrich the interface of abstract domains for values with
    operations for inverse analysis of conditionals and for widening. </div>
<br/>
<span class="kwd">Module</span> <span class="kwd">Type</span> <span class="id"><a name="VALUE_ABSTRACTION">VALUE_ABSTRACTION</a></span>.<br/>
<br/>
<div class="doc">We reuse all the declarations of the simplified interface. </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Include</span> <span class="id"><a href="CDF.AbstrInterp.html#VALUE_ABSTRACTION">AbstrInterp.VALUE_ABSTRACTION</a></span>.<br/>
<br/>
<div class="doc"><span class="bracket"><span class="id">meet</span></span> computes a lower bound of its two arguments. </div>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="VALUE_ABSTRACTION.meet">meet</a></span>: <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.t">t</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.t">t</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.t">t</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="VALUE_ABSTRACTION.meet_1">meet_1</a></span>: <span class="kwd">forall</span> <span class="id">n</span> <span class="id">N1</span> <span class="id">N2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.In">In</a></span> <span class="id">n</span> <span class="id">N1</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.In">In</a></span> <span class="id">n</span> <span class="id">N2</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.In">In</a></span> <span class="id">n</span> (<span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.meet">meet</a></span> <span class="id">N1</span> <span class="id">N2</span>).<br/>
<br/>
<div class="doc"><span class="bracket"><span class="id">isIn</span></span> tests whether a concrete value belongs to an abstract value. </div>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="VALUE_ABSTRACTION.isIn">isIn</a></span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.t">t</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="VALUE_ABSTRACTION.isIn_1">isIn_1</a></span>: <span class="kwd">forall</span> <span class="id">n</span> <span class="id">N</span>, <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.In">In</a></span> <span class="id">n</span> <span class="id">N</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.isIn">isIn</a></span> <span class="id">n</span> <span class="id">N</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>.<br/>
<br/>
<div class="doc">Abstract operators for inverse analysis of comparisons. </div>
<br/>
<div class="doc">Consider a test <span class="bracket"><span class="id">a1</span> = <span class="id">a2</span></span> that evaluates to true at run-time.
    Let <span class="bracket"><span class="id">N1</span></span> be an abstraction of <span class="bracket"><span class="id">a1</span></span> and <span class="bracket"><span class="id">N2</span></span> be an abstraction of <span class="bracket"><span class="id">a2</span></span>.
    <span class="bracket"><span class="id">eq_inv</span> <span class="id">N1</span> <span class="id">N2</span></span> produces a pair of abstract values <span class="bracket"><span class="id">N1</span>', <span class="id">N2</span>'</span>.
    <span class="bracket"><span class="id">N1</span>'</span> is a possibly more precise abstraction for <span class="bracket"><span class="id">a1</span></span>
    taking into account the fact that <span class="bracket"><span class="id">a1</span> = <span class="id">a2</span></span>.
    <span class="bracket"><span class="id">N2</span>'</span> is a possibly more precise abstraction for <span class="bracket"><span class="id">a2</span></span>
    taking into account the fact that <span class="bracket"><span class="id">a1</span> = <span class="id">a2</span></span>. </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="VALUE_ABSTRACTION.eq_inv">eq_inv</a></span>: <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.t">t</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.t">t</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.t">t</a></span> * <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.t">t</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="VALUE_ABSTRACTION.eq_inv_1">eq_inv_1</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n1</span> <span class="id">n2</span> <span class="id">N1</span> <span class="id">N2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.In">In</a></span> <span class="id">n1</span> <span class="id">N1</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.In">In</a></span> <span class="id">n2</span> <span class="id">N2</span> -&gt; <span class="id">n1</span> = <span class="id">n2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.In">In</a></span> <span class="id">n1</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.eq_inv">eq_inv</a></span> <span class="id">N1</span> <span class="id">N2</span>)) /\ <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.In">In</a></span> <span class="id">n2</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.eq_inv">eq_inv</a></span> <span class="id">N1</span> <span class="id">N2</span>)).<br/>
<br/>
<div class="doc"><span class="bracket"><span class="id">ne_inv</span></span>, <span class="bracket"><span class="id">le_inv</span></span> and <span class="bracket"><span class="id">gt_inv</span></span> are similar but apply to the other
    three basic comparisons: "different", "less than or equal", and
    "greater than". </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="VALUE_ABSTRACTION.ne_inv">ne_inv</a></span>: <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.t">t</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.t">t</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.t">t</a></span> * <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.t">t</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="VALUE_ABSTRACTION.ne_inv_1">ne_inv_1</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n1</span> <span class="id">n2</span> <span class="id">N1</span> <span class="id">N2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.In">In</a></span> <span class="id">n1</span> <span class="id">N1</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.In">In</a></span> <span class="id">n2</span> <span class="id">N2</span> -&gt; <span class="id">n1</span> &lt;&gt; <span class="id">n2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.In">In</a></span> <span class="id">n1</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.ne_inv">ne_inv</a></span> <span class="id">N1</span> <span class="id">N2</span>)) /\ <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.In">In</a></span> <span class="id">n2</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.ne_inv">ne_inv</a></span> <span class="id">N1</span> <span class="id">N2</span>)).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="VALUE_ABSTRACTION.le_inv">le_inv</a></span>: <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.t">t</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.t">t</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.t">t</a></span> * <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.t">t</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="VALUE_ABSTRACTION.le_inv_1">le_inv_1</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n1</span> <span class="id">n2</span> <span class="id">N1</span> <span class="id">N2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.In">In</a></span> <span class="id">n1</span> <span class="id">N1</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.In">In</a></span> <span class="id">n2</span> <span class="id">N2</span> -&gt; <span class="id">n1</span> &lt;= <span class="id">n2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.In">In</a></span> <span class="id">n1</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.le_inv">le_inv</a></span> <span class="id">N1</span> <span class="id">N2</span>)) /\ <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.In">In</a></span> <span class="id">n2</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.le_inv">le_inv</a></span> <span class="id">N1</span> <span class="id">N2</span>)).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="VALUE_ABSTRACTION.gt_inv">gt_inv</a></span>: <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.t">t</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.t">t</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.t">t</a></span> * <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.t">t</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="VALUE_ABSTRACTION.gt_inv_1">gt_inv_1</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n1</span> <span class="id">n2</span> <span class="id">N1</span> <span class="id">N2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.In">In</a></span> <span class="id">n1</span> <span class="id">N1</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.In">In</a></span> <span class="id">n2</span> <span class="id">N2</span> -&gt; <span class="id">n1</span> &gt; <span class="id">n2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.In">In</a></span> <span class="id">n1</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.gt_inv">gt_inv</a></span> <span class="id">N1</span> <span class="id">N2</span>)) /\ <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.In">In</a></span> <span class="id">n2</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.gt_inv">gt_inv</a></span> <span class="id">N1</span> <span class="id">N2</span>)).<br/>
<br/>
<div class="doc"><span class="bracket"><span class="id">widen</span> <span class="id">N1</span> <span class="id">N2</span></span> computes an upper bound of its first argument, chosen
    so as to guarantee and accelerate the convergence of fixed point
    iteration. </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="VALUE_ABSTRACTION.widen">widen</a></span>: <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.t">t</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.t">t</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.t">t</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="VALUE_ABSTRACTION.widen_1">widen_1</a></span>: <span class="kwd">forall</span> <span class="id">N1</span> <span class="id">N2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.le">le</a></span> <span class="id">N1</span> (<span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.widen">widen</a></span> <span class="id">N1</span> <span class="id">N2</span>).<br/>
<br/>
<div class="doc">To guarantee convergence, we provide a measure with nonnegative
    integer values that decreases strictly along the fixed point
    iteration with widening. </div>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="VALUE_ABSTRACTION.measure">measure</a></span>: <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.t">t</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="VALUE_ABSTRACTION.measure_top">measure_top</a></span>: <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.measure">measure</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.top">top</a></span> = 0%<span class="id">nat</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="VALUE_ABSTRACTION.widen_2">widen_2</a></span>: <span class="kwd">forall</span> <span class="id">N1</span> <span class="id">N2</span>, (<span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.measure">measure</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.widen">widen</a></span> <span class="id">N1</span> <span class="id">N2</span>) &lt;= <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.measure">measure</a></span> <span class="id">N1</span>)%<span class="id">nat</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="VALUE_ABSTRACTION.widen_3">widen_3</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">N1</span> <span class="id">N2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.ble">ble</a></span> <span class="id">N2</span> <span class="id">N1</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt; (<span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.measure">measure</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.widen">widen</a></span> <span class="id">N1</span> <span class="id">N2</span>) &lt; <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION.measure">measure</a></span> <span class="id">N1</span>)%<span class="id">nat</span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION">VALUE_ABSTRACTION</a></span>.<br/>
<br/>
<div class="doc">We enrich the interface of abstract stores with a widening operation. </div>
<br/>
<span class="kwd">Module</span> <span class="kwd">Type</span> <span class="id"><a name="STORE_ABSTRACTION">STORE_ABSTRACTION</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">Declare</span> <span class="kwd">Module</span> <span class="id"><a name="STORE_ABSTRACTION.V">V</a></span>: <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION">VALUE_ABSTRACTION</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="STORE_ABSTRACTION.t">t</a></span>: <span class="kwd">Type</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="STORE_ABSTRACTION.get">get</a></span>: <span class="id"><a href="CDF.IMP.html#ident">ident</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.t">t</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.t">V.t</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="STORE_ABSTRACTION.In">In</a></span> (<span class="id">s</span>: <span class="id"><a href="CDF.IMP.html#store">store</a></span>) (<span class="id">S</span>: <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.t">t</a></span>) : <span class="kwd">Prop</span> := <span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.In">V.In</a></span> (<span class="id">s</span> <span class="id">x</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.get">get</a></span> <span class="id">x</span> <span class="id">S</span>).<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="STORE_ABSTRACTION.set">set</a></span>: <span class="id"><a href="CDF.IMP.html#ident">ident</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.t">V.t</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.t">t</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.t">t</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="STORE_ABSTRACTION.set_1">set_1</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">n</span> <span class="id">N</span> <span class="id">s</span> <span class="id">S</span>, <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.In">V.In</a></span> <span class="id">n</span> <span class="id">N</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.In">In</a></span> <span class="id">s</span> <span class="id">S</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.In">In</a></span> (<span class="id"><a href="CDF.IMP.html#update">update</a></span> <span class="id">x</span> <span class="id">n</span> <span class="id">s</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.set">set</a></span> <span class="id">x</span> <span class="id">N</span> <span class="id">S</span>).<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="STORE_ABSTRACTION.le">le</a></span> (<span class="id">S1</span> <span class="id">S2</span>: <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.t">t</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span>, <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.In">In</a></span> <span class="id">s</span> <span class="id">S1</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.In">In</a></span> <span class="id">s</span> <span class="id">S2</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="STORE_ABSTRACTION.ble">ble</a></span>: <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.t">t</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.t">t</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="STORE_ABSTRACTION.ble_1">ble_1</a></span>: <span class="kwd">forall</span> <span class="id">S1</span> <span class="id">S2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.ble">ble</a></span> <span class="id">S1</span> <span class="id">S2</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.le">le</a></span> <span class="id">S1</span> <span class="id">S2</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="STORE_ABSTRACTION.bot">bot</a></span>: <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.t">t</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="STORE_ABSTRACTION.bot_1">bot_1</a></span>: <span class="kwd">forall</span> <span class="id">s</span>, ~(<span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.In">In</a></span> <span class="id">s</span> <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.bot">bot</a></span>).<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="STORE_ABSTRACTION.top">top</a></span>: <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.t">t</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="STORE_ABSTRACTION.top_1">top_1</a></span>: <span class="kwd">forall</span> <span class="id">s</span>, <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.In">In</a></span> <span class="id">s</span> <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.top">top</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="STORE_ABSTRACTION.join">join</a></span>: <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.t">t</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.t">t</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.t">t</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="STORE_ABSTRACTION.join_1">join_1</a></span>: <span class="kwd">forall</span> <span class="id">s</span> <span class="id">S1</span> <span class="id">S2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.In">In</a></span> <span class="id">s</span> <span class="id">S1</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.In">In</a></span> <span class="id">s</span> (<span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.join">join</a></span> <span class="id">S1</span> <span class="id">S2</span>).<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="STORE_ABSTRACTION.join_2">join_2</a></span>: <span class="kwd">forall</span> <span class="id">s</span> <span class="id">S1</span> <span class="id">S2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.In">In</a></span> <span class="id">s</span> <span class="id">S2</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.In">In</a></span> <span class="id">s</span> (<span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.join">join</a></span> <span class="id">S1</span> <span class="id">S2</span>).<br/>
<br/>
<div class="doc">This is the new widening operator. </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="STORE_ABSTRACTION.widen">widen</a></span>: <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.t">t</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.t">t</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.t">t</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="STORE_ABSTRACTION.widen_1">widen_1</a></span>: <span class="kwd">forall</span> <span class="id">S1</span> <span class="id">S2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.le">le</a></span> <span class="id">S1</span> (<span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.widen">widen</a></span> <span class="id">S1</span> <span class="id">S2</span>).<br/>
<br/>
<div class="doc">The order below corresponds to consecutive rounds of the fixed point
    iteration with widening.  We require it to be well founded,
    so as to guarantee termination. </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="STORE_ABSTRACTION.widen_order">widen_order</a></span> (<span class="id">S</span> <span class="id">S1</span>: <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.t">t</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">S2</span>, <span class="id">S</span> = <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.widen">widen</a></span> <span class="id">S1</span> <span class="id">S2</span> /\ <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.ble">ble</a></span> <span class="id">S2</span> <span class="id">S1</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Axiom</span> <span class="id"><a name="STORE_ABSTRACTION.widen_order_wf">widen_order_wf</a></span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Wf.html#well_founded">well_founded</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION.widen_order">widen_order</a></span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION">STORE_ABSTRACTION</a></span>.<br/>
<br/>
<h2> 5.6.  The improved generic analyzer. </h2>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="Analysis">Analysis</a></span> (<span class="id">ST</span>: <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION">STORE_ABSTRACTION</a></span>).<br/>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="Analysis.V">V</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#ST.V">ST.V</a></span>.<br/>
<br/>
<h3> Computing post-fixed points with widening and narrowing. </h3>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="Analysis.FIXPOINT">FIXPOINT</a></span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id"><a name="Analysis.FIXPOINT.F">F</a></span>: <span class="id"><a href="CDF.AbstrInterp2.html#ST.t">ST.t</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#ST.t">ST.t</a></span>.<br/>
<br/>
<span class="id">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="Analysis.is_true">is_true</a></span> (<span class="id">b</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>) : { <span class="id">b</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> } + { <span class="id">b</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> } :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">b</span> <span class="kwd">with</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#left">left</a></span> <span class="id">_</span> | <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#right">right</a></span> <span class="id">_</span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Analysis.iter_up_acc">iter_up_acc</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">S</span>: <span class="id"><a href="CDF.AbstrInterp2.html#ST.t">ST.t</a></span>) (<span class="id">acc</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Wf.html#Acc">Acc</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#ST.widen_order">ST.widen_order</a></span> <span class="id">S</span>) (<span class="id">S</span>': <span class="id"><a href="CDF.AbstrInterp2.html#ST.t">ST.t</a></span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#ST.ble">ST.ble</a></span> <span class="id">S</span>' <span class="id">S</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Wf.html#Acc">Acc</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#ST.widen_order">ST.widen_order</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#ST.widen">ST.widen</a></span> <span class="id">S</span> <span class="id">S</span>').<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof1')">Proof.</span></div>
<div class="proofscript" id="proof1">
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Wf.html#Acc_inv">Acc_inv</a></span>; <span class="id">eauto</span>. <span class="kwd">exists</span> <span class="id">S</span>'. <span class="id">auto</span>. <br/>
Defined.</div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="Analysis.iter_up">iter_up</a></span> (<span class="id">S</span>: <span class="id"><a href="CDF.AbstrInterp2.html#ST.t">ST.t</a></span>) (<span class="id">acc</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Wf.html#Acc">Acc</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#ST.widen_order">ST.widen_order</a></span> <span class="id">S</span>) : <span class="id"><a href="CDF.AbstrInterp2.html#ST.t">ST.t</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">S</span>' := <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.FIXPOINT.F">F</a></span> <span class="id">S</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.is_true">is_true</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#ST.ble">ST.ble</a></span> <span class="id">S</span>' <span class="id">S</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#left">left</a></span> <span class="id">LE</span> =&gt; <span class="id">S</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#right">right</a></span> <span class="id">NOTLE</span> =&gt; <span class="id">iter_up</span> (<span class="id"><a href="CDF.AbstrInterp2.html#ST.widen">ST.widen</a></span> <span class="id">S</span> <span class="id">S</span>') (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.iter_up_acc">iter_up_acc</a></span> <span class="id">S</span> <span class="id">acc</span> <span class="id">S</span>' <span class="id">NOTLE</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="Analysis.iter_down">iter_down</a></span> (<span class="id">n</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) (<span class="id">S</span>: <span class="id"><a href="CDF.AbstrInterp2.html#ST.t">ST.t</a></span>) : <span class="id"><a href="CDF.AbstrInterp2.html#ST.t">ST.t</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">n</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#O">O</a></span> =&gt; <span class="id">S</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span> =&gt; <span class="kwd">let</span> <span class="id">S</span>' := <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.FIXPOINT.F">F</a></span> <span class="id">S</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="CDF.AbstrInterp2.html#ST.ble">ST.ble</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.FIXPOINT.F">F</a></span> <span class="id">S</span>') <span class="id">S</span>' <span class="kwd">then</span> <span class="id">iter_down</span> <span class="id">n</span> <span class="id">S</span>' <span class="kwd">else</span> <span class="id">S</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Analysis.niter_down">niter_down</a></span> := 3%<span class="id">nat</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Analysis.postfixpoint">postfixpoint</a></span> : <span class="id"><a href="CDF.AbstrInterp2.html#ST.t">ST.t</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.iter_down">iter_down</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.niter_down">niter_down</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.iter_up">iter_up</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#ST.bot">ST.bot</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#ST.widen_order_wf">ST.widen_order_wf</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#ST.bot">ST.bot</a></span>)).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Analysis.iter_up_sound">iter_up_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">S</span> <span class="id">acc</span>, <span class="id"><a href="CDF.AbstrInterp2.html#ST.le">ST.le</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.FIXPOINT.F">F</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.iter_up">iter_up</a></span> <span class="id">S</span> <span class="id">acc</span>)) (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.iter_up">iter_up</a></span> <span class="id">S</span> <span class="id">acc</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof2')">Proof.</span></div>
<div class="proofscript" id="proof2">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">S</span> <span class="kwd">using</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Wf.html#well_founded_induction">well_founded_induction</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#ST.widen_order_wf">ST.widen_order_wf</a></span>). <br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">acc</span>. <span class="id">destruct</span> <span class="id">acc</span>. <span class="id">cbn</span>. <span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.is_true">is_true</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#ST.ble">ST.ble</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.FIXPOINT.F">F</a></span> <span class="id">S</span>) <span class="id">S</span>)).<br/>
- <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#ST.ble_1">ST.ble_1</a></span>; <span class="id">auto</span>.<br/>
- <span class="id">apply</span> <span class="id">H</span>. <span class="kwd">exists</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.FIXPOINT.F">F</a></span> <span class="id">S</span>); <span class="id">auto</span>. <br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Analysis.iter_down_sound">iter_down_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">S</span>, <span class="id"><a href="CDF.AbstrInterp2.html#ST.le">ST.le</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.FIXPOINT.F">F</a></span> <span class="id">S</span>) <span class="id">S</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#ST.le">ST.le</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.FIXPOINT.F">F</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.iter_down">iter_down</a></span> <span class="id">n</span> <span class="id">S</span>)) (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.iter_down">iter_down</a></span> <span class="id">n</span> <span class="id">S</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof3')">Proof.</span></div>
<div class="proofscript" id="proof3">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">n</span>; <span class="id">intros</span>; <span class="id">cbn</span>.<br/>
- <span class="id">auto</span>.<br/>
- <span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#ST.ble">ST.ble</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.FIXPOINT.F">F</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.FIXPOINT.F">F</a></span> <span class="id">S</span>)) (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.FIXPOINT.F">F</a></span> <span class="id">S</span>)) <span class="id">eqn</span>:<span class="id">BLE</span>.<br/>
&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHn</span>. <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#ST.ble_1">ST.ble_1</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Analysis.postfixpoint_sound">postfixpoint_sound</a></span>: <span class="id"><a href="CDF.AbstrInterp2.html#ST.le">ST.le</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.FIXPOINT.F">F</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.postfixpoint">postfixpoint</a></span>) <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.postfixpoint">postfixpoint</a></span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof4')">Proof.</span></div>
<div class="proofscript" id="proof4">
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.iter_down_sound">iter_down_sound</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.iter_up_sound">iter_up_sound</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.FIXPOINT">FIXPOINT</a></span>.<br/>
<br/>
<h3> Abstract interpretation of arithmetic expressions </h3>
<br/>
<div class="doc">Same definition as in the simplified version. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="Analysis.Aeval">Aeval</a></span> (<span class="id">a</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>) (<span class="id">S</span>: <span class="id"><a href="CDF.AbstrInterp2.html#ST.t">ST.t</a></span>) : <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.t">V.t</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">a</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#CONST">CONST</a></span> <span class="id">n</span> =&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.const">V.const</a></span> <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> <span class="id">x</span> =&gt; <span class="id"><a href="CDF.AbstrInterp2.html#ST.get">ST.get</a></span> <span class="id">x</span> <span class="id">S</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#PLUS">PLUS</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.add">V.add</a></span> (<span class="id">Aeval</span> <span class="id">a1</span> <span class="id">S</span>) (<span class="id">Aeval</span> <span class="id">a2</span> <span class="id">S</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#MINUS">MINUS</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.sub">V.sub</a></span> (<span class="id">Aeval</span> <span class="id">a1</span> <span class="id">S</span>) (<span class="id">Aeval</span> <span class="id">a2</span> <span class="id">S</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Analysis.Aeval_sound">Aeval_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">S</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#ST.In">ST.In</a></span> <span class="id">s</span> <span class="id">S</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.In">V.In</a></span> (<span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a</span> <span class="id">s</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval">Aeval</a></span> <span class="id">a</span> <span class="id">S</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof5')">Proof.</span></div>
<div class="proofscript" id="proof5">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">a</span>; <span class="id">cbn</span>; <span class="id">intros</span>.<br/>
- <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.const_1">V.const_1</a></span>.<br/>
- <span class="id">apply</span> <span class="id">H</span>.<br/>
- <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.add_1">V.add_1</a></span>; <span class="id">auto</span>.<br/>
- <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.sub_1">V.sub_1</a></span>; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<h3> Inverse analysis of arithmetic and Boolean expressions </h3>
<br/>
<div class="doc">Assuming that the concrete value of <span class="bracket"><span class="id">a</span></span> belongs to the abstract
    value <span class="bracket"><span class="id">Res</span></span>, what do we learn about the values of the variables
    that occur in <span class="bracket"><span class="id">a</span></span>?  The facts that we learn are used to refine
    the abstract values of these variables in the abstract store <span class="bracket"><span class="id">S</span></span>. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="Analysis.assume_eval">assume_eval</a></span> (<span class="id">a</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>) (<span class="id">Res</span>: <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.t">V.t</a></span>) (<span class="id">S</span>: <span class="id"><a href="CDF.AbstrInterp2.html#ST.t">ST.t</a></span>) : <span class="id"><a href="CDF.AbstrInterp2.html#ST.t">ST.t</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">a</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#CONST">CONST</a></span> <span class="id">n</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.isIn">V.isIn</a></span> <span class="id">n</span> <span class="id">Res</span> <span class="kwd">then</span> <span class="id">S</span> <span class="kwd">else</span> <span class="id"><a href="CDF.AbstrInterp2.html#ST.bot">ST.bot</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> <span class="id">x</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#ST.set">ST.set</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.meet">V.meet</a></span> <span class="id">Res</span> (<span class="id"><a href="CDF.AbstrInterp2.html#ST.get">ST.get</a></span> <span class="id">x</span> <span class="id">S</span>)) <span class="id">S</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#PLUS">PLUS</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">N1</span> := <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval">Aeval</a></span> <span class="id">a1</span> <span class="id">S</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">N2</span> := <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval">Aeval</a></span> <span class="id">a2</span> <span class="id">S</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Res1</span> := <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.meet">V.meet</a></span> <span class="id">N1</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.sub">V.sub</a></span> <span class="id">Res</span> <span class="id">N2</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Res2</span> := <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.meet">V.meet</a></span> <span class="id">N2</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.sub">V.sub</a></span> <span class="id">Res</span> <span class="id">N1</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assume_eval</span> <span class="id">a1</span> <span class="id">Res1</span> (<span class="id">assume_eval</span> <span class="id">a2</span> <span class="id">Res2</span> <span class="id">S</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#MINUS">MINUS</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">N1</span> := <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval">Aeval</a></span> <span class="id">a1</span> <span class="id">S</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">N2</span> := <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval">Aeval</a></span> <span class="id">a2</span> <span class="id">S</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Res1</span> := <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.meet">V.meet</a></span> <span class="id">N1</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.add">V.add</a></span> <span class="id">Res</span> <span class="id">N2</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Res2</span> := <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.meet">V.meet</a></span> <span class="id">N2</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.sub">V.sub</a></span> <span class="id">N1</span> <span class="id">Res</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assume_eval</span> <span class="id">a1</span> <span class="id">Res1</span> (<span class="id">assume_eval</span> <span class="id">a2</span> <span class="id">Res2</span> <span class="id">S</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Analysis.assume_eval_sound">assume_eval_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">Res</span> <span class="id">S</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.In">V.In</a></span> (<span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a</span> <span class="id">s</span>) <span class="id">Res</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#ST.In">ST.In</a></span> <span class="id">s</span> <span class="id">S</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#ST.In">ST.In</a></span> <span class="id">s</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.assume_eval">assume_eval</a></span> <span class="id">a</span> <span class="id">Res</span> <span class="id">S</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof6')">Proof.</span></div>
<div class="proofscript" id="proof6">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">a</span>; <span class="id">cbn</span>; <span class="id">intros</span>.<br/>
- <span class="comment">(*&nbsp;CONST&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.isIn_1">V.isIn_1</a></span> <span class="kwd">by</span> <span class="id">auto</span>. <span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;VAR&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">replace</span> <span class="id">s</span> <span class="kwd">with</span> (<span class="id"><a href="CDF.IMP.html#update">update</a></span> <span class="id">x</span> (<span class="id">s</span> <span class="id">x</span>) <span class="id">s</span>).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#ST.set_1">ST.set_1</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.meet_1">V.meet_1</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Logic.FunctionalExtensionality.html#functional_extensionality">functional_extensionality</a></span>; <span class="id">intros</span> <span class="id">y</span>. <br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.IMP.html#update">update</a></span>; <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x</span> <span class="id">y</span>); <span class="id">congruence</span>.<br/>
- <span class="comment">(*&nbsp;PLUS&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">set</span> (<span class="id">n1</span> := <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a1</span> <span class="id">s</span>) <span class="kwd">in</span> *. <span class="id">set</span> (<span class="id">n2</span> := <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a2</span> <span class="id">s</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">set</span> (<span class="id">N1</span> := <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval">Aeval</a></span> <span class="id">a1</span> <span class="id">S</span>). <span class="id">set</span> (<span class="id">N2</span> := <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval">Aeval</a></span> <span class="id">a2</span> <span class="id">S</span>).<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.In">V.In</a></span> <span class="id">n1</span> <span class="id">N1</span>) <span class="kwd">by</span> (<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval_sound">Aeval_sound</a></span>; <span class="id">auto</span>).<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.In">V.In</a></span> <span class="id">n2</span> <span class="id">N2</span>) <span class="kwd">by</span> (<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval_sound">Aeval_sound</a></span>; <span class="id">auto</span>).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">IHa1</span>; <span class="id">fold</span> <span class="id">n1</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.meet_1">V.meet_1</a></span>. <span class="id">auto</span>. <span class="id">replace</span> <span class="id">n1</span> <span class="kwd">with</span> ((<span class="id">n1</span> + <span class="id">n2</span>) - <span class="id">n2</span>) <span class="kwd">by</span> <span class="id">lia</span>. <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.sub_1">V.sub_1</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">IHa2</span>; <span class="id">fold</span> <span class="id">n2</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.meet_1">V.meet_1</a></span>. <span class="id">auto</span>. <span class="id">replace</span> <span class="id">n2</span> <span class="kwd">with</span> ((<span class="id">n1</span> + <span class="id">n2</span>) - <span class="id">n1</span>) <span class="kwd">by</span> <span class="id">lia</span>. <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.sub_1">V.sub_1</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;MINUS&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">set</span> (<span class="id">n1</span> := <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a1</span> <span class="id">s</span>) <span class="kwd">in</span> *. <span class="id">set</span> (<span class="id">n2</span> := <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a2</span> <span class="id">s</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">set</span> (<span class="id">N1</span> := <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval">Aeval</a></span> <span class="id">a1</span> <span class="id">S</span>). <span class="id">set</span> (<span class="id">N2</span> := <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval">Aeval</a></span> <span class="id">a2</span> <span class="id">S</span>).<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.In">V.In</a></span> <span class="id">n1</span> <span class="id">N1</span>) <span class="kwd">by</span> (<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval_sound">Aeval_sound</a></span>; <span class="id">auto</span>).<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.In">V.In</a></span> <span class="id">n2</span> <span class="id">N2</span>) <span class="kwd">by</span> (<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval_sound">Aeval_sound</a></span>; <span class="id">auto</span>).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">IHa1</span>; <span class="id">fold</span> <span class="id">n1</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.meet_1">V.meet_1</a></span>. <span class="id">auto</span>. <span class="id">replace</span> <span class="id">n1</span> <span class="kwd">with</span> ((<span class="id">n1</span> - <span class="id">n2</span>) + <span class="id">n2</span>) <span class="kwd">by</span> <span class="id">lia</span>. <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.add_1">V.add_1</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">IHa2</span>; <span class="id">fold</span> <span class="id">n2</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.meet_1">V.meet_1</a></span>. <span class="id">auto</span>. <span class="id">replace</span> <span class="id">n2</span> <span class="kwd">with</span> (<span class="id">n1</span> - (<span class="id">n1</span> - <span class="id">n2</span>)) <span class="kwd">by</span> <span class="id">lia</span>. <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.sub_1">V.sub_1</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Assuming that the Boolean expression <span class="bracket"><span class="id">b</span></span> evaluates concretely to
    the Boolean value <span class="bracket"><span class="id">res</span></span>, what do we learn about the values of the
    variables that occur in <span class="bracket"><span class="id">b</span></span>?  The facts that we learn are used to
    refine the abstract values of these variables in the abstract
    store <span class="bracket"><span class="id">S</span></span>. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="Analysis.assume_test">assume_test</a></span> (<span class="id">b</span>: <span class="id"><a href="CDF.IMP.html#bexp">bexp</a></span>) (<span class="id">res</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>) (<span class="id">S</span>: <span class="id"><a href="CDF.AbstrInterp2.html#ST.t">ST.t</a></span>): <span class="id"><a href="CDF.AbstrInterp2.html#ST.t">ST.t</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">b</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#TRUE">TRUE</a></span> =&gt; <span class="kwd">if</span> <span class="id">res</span> <span class="kwd">then</span> <span class="id">S</span> <span class="kwd">else</span> <span class="id"><a href="CDF.AbstrInterp2.html#ST.bot">ST.bot</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#FALSE">FALSE</a></span> =&gt; <span class="kwd">if</span> <span class="id">res</span> <span class="kwd">then</span> <span class="id"><a href="CDF.AbstrInterp2.html#ST.bot">ST.bot</a></span> <span class="kwd">else</span> <span class="id">S</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#EQUAL">EQUAL</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">Res1</span>, <span class="id">Res2</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">res</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.eq_inv">V.eq_inv</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval">Aeval</a></span> <span class="id">a1</span> <span class="id">S</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval">Aeval</a></span> <span class="id">a2</span> <span class="id">S</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.ne_inv">V.ne_inv</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval">Aeval</a></span> <span class="id">a1</span> <span class="id">S</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval">Aeval</a></span> <span class="id">a2</span> <span class="id">S</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.assume_eval">assume_eval</a></span> <span class="id">a1</span> <span class="id">Res1</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.assume_eval">assume_eval</a></span> <span class="id">a2</span> <span class="id">Res2</span> <span class="id">S</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#LESSEQUAL">LESSEQUAL</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">Res1</span>, <span class="id">Res2</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">res</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.le_inv">V.le_inv</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval">Aeval</a></span> <span class="id">a1</span> <span class="id">S</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval">Aeval</a></span> <span class="id">a2</span> <span class="id">S</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.gt_inv">V.gt_inv</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval">Aeval</a></span> <span class="id">a1</span> <span class="id">S</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval">Aeval</a></span> <span class="id">a2</span> <span class="id">S</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.assume_eval">assume_eval</a></span> <span class="id">a1</span> <span class="id">Res1</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.assume_eval">assume_eval</a></span> <span class="id">a2</span> <span class="id">Res2</span> <span class="id">S</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#NOT">NOT</a></span> <span class="id">b1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assume_test</span> <span class="id">b1</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#negb">negb</a></span> <span class="id">res</span>) <span class="id">S</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#AND">AND</a></span> <span class="id">b1</span> <span class="id">b2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">res</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">assume_test</span> <span class="id">b1</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> (<span class="id">assume_test</span> <span class="id">b2</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> <span class="id">S</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="CDF.AbstrInterp2.html#ST.join">ST.join</a></span> (<span class="id">assume_test</span> <span class="id">b1</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> <span class="id">S</span>) (<span class="id">assume_test</span> <span class="id">b2</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> <span class="id">S</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Analysis.assume_test_sound">assume_test_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">res</span> <span class="id">S</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> = <span class="id">res</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#ST.In">ST.In</a></span> <span class="id">s</span> <span class="id">S</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#ST.In">ST.In</a></span> <span class="id">s</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.assume_test">assume_test</a></span> <span class="id">b</span> <span class="id">res</span> <span class="id">S</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof7')">Proof.</span></div>
<div class="proofscript" id="proof7">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">b</span>; <span class="id">cbn</span>; <span class="id">intros</span>.<br/>
- <span class="comment">(*&nbsp;TRUE&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">subst</span> <span class="id">res</span>; <span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;FALSE&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">subst</span> <span class="id">res</span>; <span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;EQUAL&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">set</span> (<span class="id">Res</span> := <span class="kwd">if</span> <span class="id">res</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.eq_inv">V.eq_inv</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval">Aeval</a></span> <span class="id">a1</span> <span class="id">S</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval">Aeval</a></span> <span class="id">a2</span> <span class="id">S</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.ne_inv">V.ne_inv</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval">Aeval</a></span> <span class="id">a1</span> <span class="id">S</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval">Aeval</a></span> <span class="id">a2</span> <span class="id">S</span>)).<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">A</span>: <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.In">V.In</a></span> (<span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a1</span> <span class="id">s</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">Res</span>) /\ <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.In">V.In</a></span> (<span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a2</span> <span class="id">s</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">Res</span>)).<br/>
&nbsp;&nbsp;{ <span class="id">unfold</span> <span class="id">Res</span>; <span class="id">destruct</span> <span class="id">res</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.eq_inv_1">V.eq_inv_1</a></span> | <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.ne_inv_1">V.ne_inv_1</a></span> ]; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval_sound">Aeval_sound</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eqb_eq">Z.eqb_eq</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eqb_neq">Z.eqb_neq</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">A</span> <span class="kwd">as</span> [<span class="id">A1</span> <span class="id">A2</span>]. <span class="id">destruct</span> <span class="id">Res</span> <span class="kwd">as</span> [<span class="id">Res1</span> <span class="id">Res2</span>]. <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.assume_eval_sound">assume_eval_sound</a></span>.<br/>
- <span class="comment">(*&nbsp;LESSEQUAL&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">set</span> (<span class="id">Res</span> := <span class="kwd">if</span> <span class="id">res</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.le_inv">V.le_inv</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval">Aeval</a></span> <span class="id">a1</span> <span class="id">S</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval">Aeval</a></span> <span class="id">a2</span> <span class="id">S</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.gt_inv">V.gt_inv</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval">Aeval</a></span> <span class="id">a1</span> <span class="id">S</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval">Aeval</a></span> <span class="id">a2</span> <span class="id">S</span>)).<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">A</span>: <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.In">V.In</a></span> (<span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a1</span> <span class="id">s</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">Res</span>) /\ <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.In">V.In</a></span> (<span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a2</span> <span class="id">s</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">Res</span>)).<br/>
&nbsp;&nbsp;{ <span class="id">unfold</span> <span class="id">Res</span>; <span class="id">destruct</span> <span class="id">res</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.le_inv_1">V.le_inv_1</a></span> | <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.gt_inv_1">V.gt_inv_1</a></span> ]; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval_sound">Aeval_sound</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.leb_le">Z.leb_le</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.leb_nle">Z.leb_nle</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">A</span> <span class="kwd">as</span> [<span class="id">A1</span> <span class="id">A2</span>]. <span class="id">destruct</span> <span class="id">Res</span> <span class="kwd">as</span> [<span class="id">Res1</span> <span class="id">Res2</span>]. <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.assume_eval_sound">assume_eval_sound</a></span>.<br/>
- <span class="comment">(*&nbsp;NOT&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">IHb</span>; <span class="id">auto</span>. <span class="id">rewrite</span> &lt;- <span class="id">H</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html#negb_involutive">negb_involutive</a></span>; <span class="id">auto</span>. <br/>
- <span class="comment">(*&nbsp;AND&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">res</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;AND,&nbsp;true&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#andb_prop">andb_prop</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>). <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;AND,&nbsp;false&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html#andb_false_elim">andb_false_elim</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>); [<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#ST.join_1">ST.join_1</a></span> | <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#ST.join_2">ST.join_2</a></span>]; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<h3> Improved abstract interpretation of commands </h3>
<br/>
<div class="doc">We add calls to <span class="bracket"><span class="id">assume_test</span></span> every time a Boolean condition
    is known to be true or to be false. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="Analysis.Cexec">Cexec</a></span> (<span class="id">c</span>: <span class="id"><a href="CDF.IMP.html#com">com</a></span>) (<span class="id">S</span>: <span class="id"><a href="CDF.AbstrInterp2.html#ST.t">ST.t</a></span>) : <span class="id"><a href="CDF.AbstrInterp2.html#ST.t">ST.t</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span> =&gt; <span class="id">S</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span> =&gt; <span class="id"><a href="CDF.AbstrInterp2.html#ST.set">ST.set</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval">Aeval</a></span> <span class="id">a</span> <span class="id">S</span>) <span class="id">S</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#SEQ">SEQ</a></span> <span class="id">c1</span> <span class="id">c2</span> =&gt; <span class="id">Cexec</span> <span class="id">c2</span> (<span class="id">Cexec</span> <span class="id">c1</span> <span class="id">S</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#ST.join">ST.join</a></span> (<span class="id">Cexec</span> <span class="id">c1</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.assume_test">assume_test</a></span> <span class="id">b</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> <span class="id">S</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Cexec</span> <span class="id">c2</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.assume_test">assume_test</a></span> <span class="id">b</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> <span class="id">S</span>))<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.assume_test">assume_test</a></span> <span class="id">b</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.postfixpoint">postfixpoint</a></span> (<span class="kwd">fun</span> <span class="id">X</span> =&gt; <span class="id"><a href="CDF.AbstrInterp2.html#ST.join">ST.join</a></span> <span class="id">S</span> (<span class="id">Cexec</span> <span class="id">c</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.assume_test">assume_test</a></span> <span class="id">b</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> <span class="id">X</span>))))<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="Analysis.Cexec_sound">Cexec_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">s</span> <span class="id">s</span>' <span class="id">S</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#ST.In">ST.In</a></span> <span class="id">s</span> <span class="id">S</span> -&gt; <span class="id"><a href="CDF.IMP.html#cexec">cexec</a></span> <span class="id">s</span> <span class="id">c</span> <span class="id">s</span>' -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#ST.In">ST.In</a></span> <span class="id">s</span>' (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Cexec">Cexec</a></span> <span class="id">c</span> <span class="id">S</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof8')">Proof.</span></div>
<div class="proofscript" id="proof8">
<span class="kwd">Opaque</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.niter_down">niter_down</a></span>.<br/>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">c</span>; <span class="id">intros</span> <span class="id">s</span> <span class="id">s</span>' <span class="id">S</span> <span class="id">PRE</span> <span class="id">EXEC</span>; <span class="id">cbn</span>.<br/>
- <span class="comment">(*&nbsp;SKIP&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">EXEC</span>; <span class="id">subst</span>. <span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;ASSIGN&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">EXEC</span>; <span class="id">subst</span>. <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#ST.set_1">ST.set_1</a></span>; <span class="id">auto</span>. <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Aeval_sound">Aeval_sound</a></span>; <span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;SEQ&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">EXEC</span>; <span class="id">subst</span>. <span class="id">eauto</span>.<br/>
- <span class="comment">(*&nbsp;IFTHENELSE&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">EXEC</span>; <span class="id">subst</span>. <span class="id">destruct</span> (<span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span>) <span class="id">eqn</span>:<span class="id">B</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#ST.join_1">ST.join_1</a></span>. <span class="id">eapply</span> <span class="id">IHc1</span>; <span class="id">eauto</span>. <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.assume_test_sound">assume_test_sound</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#ST.join_2">ST.join_2</a></span>. <span class="id">eapply</span> <span class="id">IHc2</span>; <span class="id">eauto</span>. <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.assume_test_sound">assume_test_sound</a></span>; <span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;WHILE&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">set</span> (<span class="id">F</span> := <span class="kwd">fun</span> <span class="id">X</span> =&gt; <span class="id"><a href="CDF.AbstrInterp2.html#ST.join">ST.join</a></span> <span class="id">S</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.Cexec">Cexec</a></span> <span class="id">c</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.assume_test">assume_test</a></span> <span class="id">b</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> <span class="id">X</span>))).<br/>
&nbsp;&nbsp;<span class="id">set</span> (<span class="id">X</span> := <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.postfixpoint">postfixpoint</a></span> <span class="id">F</span>).<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">L</span> : <span class="id"><a href="CDF.AbstrInterp2.html#ST.le">ST.le</a></span> (<span class="id">F</span> <span class="id">X</span>) <span class="id">X</span>) <span class="kwd">by</span> (<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.postfixpoint_sound">postfixpoint_sound</a></span>).<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">REC</span>: <span class="kwd">forall</span> <span class="id">s1</span> <span class="id">c1</span> <span class="id">s2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#cexec">cexec</a></span> <span class="id">s1</span> <span class="id">c1</span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">c1</span> = <span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#ST.In">ST.In</a></span> <span class="id">s1</span> <span class="id">X</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#ST.In">ST.In</a></span> <span class="id">s2</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Analysis.assume_test">assume_test</a></span> <span class="id">b</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> <span class="id">X</span>)).<br/>
&nbsp;&nbsp;{ <span class="id">induction</span> 1; <span class="id">intro</span> <span class="id">EQ</span>; <span class="id">inversion</span> <span class="id">EQ</span>; <span class="id">subst</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;WHILE&nbsp;done&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.assume_test_sound">assume_test_sound</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;WHILE&nbsp;loop&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">IHcexec2</span>; <span class="id">auto</span>. <span class="id">apply</span> <span class="id">L</span>. <span class="id">unfold</span> <span class="id">F</span>. <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#ST.join_2">ST.join_2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">IHc</span>; <span class="id">eauto</span>. <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis.assume_test_sound">assume_test_sound</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">REC</span>; <span class="id">eauto</span>. <span class="id">apply</span> <span class="id">L</span>. <span class="id">unfold</span> <span class="id">F</span>. <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#ST.join_1">ST.join_1</a></span>. <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.AbstrInterp2.html#Analysis">Analysis</a></span>.<br/>
<br/>
<h2> 5.7.  An improved abstract domain for stores </h2>
<br/>
<div class="doc">We start from the abstract domain in module <span class="bracket"><span class="id">AbstrInterp</span></span>, section 5.3,
    and add the widening operator and its properties. </div>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="IdentMap">IdentMap</a></span> := <span class="id"><a href="CDF.AbstrInterp.html#IdentMap">AbstrInterp.IdentMap</a></span>.<br/>
<span class="kwd">Module</span> <span class="id"><a name="IMFact">IMFact</a></span> := <span class="id"><a href="CDF.AbstrInterp.html#IMFact">AbstrInterp.IMFact</a></span>.<br/>
<span class="kwd">Module</span> <span class="id"><a name="IMProp">IMProp</a></span> := <span class="id"><a href="CDF.AbstrInterp.html#IMProp">AbstrInterp.IMProp</a></span>.<br/>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="StoreAbstr">StoreAbstr</a></span> (<span class="id">VA</span>: <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION">VALUE_ABSTRACTION</a></span>) &lt;: <span class="id"><a href="CDF.AbstrInterp2.html#STORE_ABSTRACTION">STORE_ABSTRACTION</a></span>.<br/>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="StoreAbstr.V">V</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#VA">VA</a></span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="StoreAbstr.abstr_state">abstr_state</a></span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="StoreAbstr.Bot">Bot</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a name="StoreAbstr.Top_except">Top_except</a></span> (<span class="id">m</span>: <span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.t">IdentMap.t</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.t">V.t</a></span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="StoreAbstr.t">t</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.abstr_state">abstr_state</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="StoreAbstr.get">get</a></span> (<span class="id">x</span>: <span class="id"><a href="CDF.IMP.html#ident">ident</a></span>) (<span class="id">S</span>: <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.t">t</a></span>) : <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.t">V.t</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">S</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Bot">Bot</a></span> =&gt; <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.bot">V.bot</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Top_except">Top_except</a></span> <span class="id">m</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.find">IdentMap.find</a></span> <span class="id">x</span> <span class="id">m</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.top">V.top</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span> =&gt; <span class="id">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="StoreAbstr.In">In</a></span> (<span class="id">s</span>: <span class="id"><a href="CDF.IMP.html#store">store</a></span>) (<span class="id">S</span>: <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.t">t</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.In">V.In</a></span> (<span class="id">s</span> <span class="id">x</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.get">get</a></span> <span class="id">x</span> <span class="id">S</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="StoreAbstr.set">set</a></span> (<span class="id">x</span>: <span class="id"><a href="CDF.IMP.html#ident">ident</a></span>) (<span class="id">N</span>: <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.t">V.t</a></span>) (<span class="id">S</span>: <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.t">t</a></span>): <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.t">t</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.ble">V.ble</a></span> <span class="id">N</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.bot">V.bot</a></span> <span class="kwd">then</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Bot">Bot</a></span> <span class="kwd">else</span> <br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">S</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Bot">Bot</a></span> =&gt; <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Bot">Bot</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Top_except">Top_except</a></span> <span class="id">m</span> =&gt; <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Top_except">Top_except</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.add">IdentMap.add</a></span> <span class="id">x</span> <span class="id">N</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="StoreAbstr.set_1">set_1</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">n</span> <span class="id">N</span> <span class="id">s</span> <span class="id">S</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.In">V.In</a></span> <span class="id">n</span> <span class="id">N</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.In">In</a></span> <span class="id">s</span> <span class="id">S</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.In">In</a></span> (<span class="id"><a href="CDF.IMP.html#update">update</a></span> <span class="id">x</span> <span class="id">n</span> <span class="id">s</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.set">set</a></span> <span class="id">x</span> <span class="id">N</span> <span class="id">S</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof9')">Proof.</span></div>
<div class="proofscript" id="proof9">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.In">In</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.get">get</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.set">set</a></span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.ble">V.ble</a></span> <span class="id">N</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.bot">V.bot</a></span>) <span class="id">eqn</span>:<span class="id">BLE</span>; [ | <span class="id">destruct</span> <span class="id">S</span> ].<br/>
- <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.ble_1">V.ble_1</a></span> <span class="kwd">in</span> <span class="id">BLE</span>. <span class="id">apply</span> <span class="id">BLE</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">elim</span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.bot_1">V.bot_1</a></span> <span class="id">n</span>); <span class="id">auto</span>. <br/>
- <span class="id">elim</span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.bot_1">V.bot_1</a></span> (<span class="id">s</span> "")). <span class="id">auto</span>. <br/>
- <span class="id">rewrite</span> <span class="id"><a href="CDF.AbstrInterp2.html#IMFact.add_o">IMFact.add_o</a></span>. <span class="id">change</span> <span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.E.eq_dec">IdentMap.E.eq_dec</a></span> <span class="kwd">with</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span>. <span class="id">unfold</span> <span class="id"><a href="CDF.IMP.html#update">update</a></span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x</span> <span class="id">x0</span>); <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">The order between abstract states. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="StoreAbstr.le">le</a></span> (<span class="id">S1</span> <span class="id">S2</span>: <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.t">t</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span>, <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.In">In</a></span> <span class="id">s</span> <span class="id">S1</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.In">In</a></span> <span class="id">s</span> <span class="id">S2</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="StoreAbstr.ble">ble</a></span> (<span class="id">S1</span> <span class="id">S2</span>: <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.t">t</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">S1</span>, <span class="id">S2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Bot">Bot</a></span>, <span class="id">_</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Bot">Bot</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Top_except">Top_except</a></span> <span class="id">m1</span>, <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Top_except">Top_except</a></span> <span class="id">m2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#IMProp.for_all">IMProp.for_all</a></span> (<span class="kwd">fun</span> <span class="id">x</span> <span class="id">v</span> =&gt; <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.ble">V.ble</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.get">get</a></span> <span class="id">x</span> <span class="id">S1</span>) <span class="id">v</span>) <span class="id">m2</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="StoreAbstr.ble_1">ble_1</a></span>: <span class="kwd">forall</span> <span class="id">S1</span> <span class="id">S2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.ble">ble</a></span> <span class="id">S1</span> <span class="id">S2</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.le">le</a></span> <span class="id">S1</span> <span class="id">S2</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof10')">Proof.</span></div>
<div class="proofscript" id="proof10">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.ble">ble</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.le">le</a></span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">S1</span> <span class="kwd">as</span> [ | <span class="id">m1</span>].<br/>
- <span class="id">elim</span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.bot_1">V.bot_1</a></span> (<span class="id">s</span> "")). <span class="id">apply</span> <span class="id">H0</span>. <br/>
- <span class="id">destruct</span> <span class="id">S2</span> <span class="kwd">as</span> [ | <span class="id">m2</span>]. <span class="id">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id">red</span>; <span class="id">cbn</span>; <span class="id">intros</span>. <span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.find">IdentMap.find</a></span> <span class="id">x</span> <span class="id">m2</span>) <span class="kwd">as</span> [<span class="id">N2</span>|] <span class="id">eqn</span>:<span class="id">F2</span>.<br/>
&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.find_2">IdentMap.find_2</a></span> <span class="kwd">in</span> <span class="id">F2</span>. <span class="id">eapply</span> <span class="id"><a href="CDF.AbstrInterp2.html#IMProp.for_all_iff">IMProp.for_all_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.ble_1">V.ble_1</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">apply</span> <span class="id">H</span>. <span class="id">apply</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">hnf</span>. <span class="id">intros</span>; <span class="id">subst</span> <span class="id">x0</span>. <span class="id">hnf</span>; <span class="id">intros</span>. <span class="id">subst</span> <span class="id">x0</span>. <span class="id">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.top_1">V.top_1</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="StoreAbstr.ble_false">ble_false</a></span>: <span class="kwd">forall</span> <span class="id">s1</span> <span class="id">s2</span>,<br/>
&nbsp;&nbsp;<span class="id">s2</span> &lt;&gt; <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Bot">Bot</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.ble">ble</a></span> <span class="id">s1</span> <span class="id">s2</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt; <span class="kwd">exists</span> <span class="id">x</span>, <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.ble">V.ble</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.get">get</a></span> <span class="id">x</span> <span class="id">s1</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.get">get</a></span> <span class="id">x</span> <span class="id">s2</span>) = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof11')">Proof.</span></div>
<div class="proofscript" id="proof11">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.ble">ble</a></span>; <span class="id">intros</span>. <br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">s1</span> <span class="kwd">as</span> [ | <span class="id">m1</span>]. <span class="id">discriminate</span>. <span class="id">destruct</span> <span class="id">s2</span> <span class="kwd">as</span> [ | <span class="id">m2</span>]. <span class="id">congruence</span>.<br/>
- <span class="id">set</span> (<span class="id">p</span> := <span class="kwd">fun</span> (<span class="id">x</span>: <span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.key">IdentMap.key</a></span>) <span class="id">v</span> =&gt; <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.ble">V.ble</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.get">get</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Top_except">Top_except</a></span> <span class="id">m1</span>)) <span class="id">v</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">set</span> (<span class="id">m</span>' := <span class="id"><a href="CDF.AbstrInterp2.html#IMProp.filter">IMProp.filter</a></span> (<span class="kwd">fun</span> <span class="id">x</span> <span class="id">v</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#negb">negb</a></span> (<span class="id">p</span> <span class="id">x</span> <span class="id">v</span>)) <span class="id">m2</span>).<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.elements">IdentMap.elements</a></span> <span class="id">m</span>') <span class="kwd">as</span> [ | [<span class="id">x1</span> <span class="id">v1</span>] <span class="id">l1</span>] <span class="id">eqn</span>:<span class="id">ELT</span>.<br/>
+ <span class="id">assert</span> (<span class="id"><a href="CDF.AbstrInterp2.html#IMProp.for_all">IMProp.for_all</a></span> <span class="id">p</span> <span class="id">m2</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>).<br/>
&nbsp;&nbsp;{ <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#IMProp.for_all_iff">IMProp.for_all_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> (<span class="id">hnf</span>; <span class="id">intros</span>). <span class="id">congruence</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">destruct</span> (<span class="id">p</span> <span class="id">k</span> <span class="id">e</span>) <span class="id">eqn</span>:<span class="id">P</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">M</span>: <span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.MapsTo">IdentMap.MapsTo</a></span> <span class="id">k</span> <span class="id">e</span> <span class="id">m</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#IMProp.filter_iff">IMProp.filter_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> (<span class="id">hnf</span>; <span class="id">intros</span>). <span class="id">congruence</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">P</span>; <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.elements_1">IdentMap.elements_1</a></span> <span class="kwd">in</span> <span class="id">M</span>. <span class="id">rewrite</span> <span class="id">ELT</span> <span class="kwd">in</span> <span class="id">M</span>. <span class="id">inversion</span> <span class="id">M</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">congruence</span>.<br/>
+ <span class="id">assert</span> (<span class="id">M</span>: <span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.MapsTo">IdentMap.MapsTo</a></span> <span class="id">x1</span> <span class="id">v1</span> <span class="id">m</span>').<br/>
&nbsp;&nbsp;{ <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.elements_2">IdentMap.elements_2</a></span>. <span class="id">rewrite</span> <span class="id">ELT</span>. <span class="id">constructor</span>. <span class="id">hnf</span>; <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#IMProp.filter_iff">IMProp.filter_iff</a></span> <span class="kwd">in</span> <span class="id">M</span>. <span class="id">destruct</span> <span class="id">M</span> <span class="kwd">as</span> [<span class="id">M</span> <span class="id">N</span>]. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html#negb_true_iff">negb_true_iff</a></span> <span class="kwd">in</span> <span class="id">N</span>.<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">x1</span>. <span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.get">get</a></span> <span class="kwd">at</span> 2. <span class="id">erewrite</span> <span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.find_1">IdentMap.find_1</a></span> <span class="kwd">by</span> <span class="id">eauto</span>. <span class="id">exact</span> <span class="id">N</span>.<br/>
&nbsp;&nbsp;<span class="id">repeat</span> (<span class="id">hnf</span>; <span class="id">intros</span>). <span class="id">congruence</span>.<br/>
Qed.</div>
<br/>
<div class="doc">The lattice operations. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="StoreAbstr.bot">bot</a></span>: <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.t">t</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Bot">Bot</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="StoreAbstr.bot_1">bot_1</a></span>: <span class="kwd">forall</span> <span class="id">s</span>, ~(<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.In">In</a></span> <span class="id">s</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.bot">bot</a></span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof12')">Proof.</span></div>
<div class="proofscript" id="proof12">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.In">In</a></span>; <span class="id">cbn</span>. <span class="id">intros</span> <span class="id">s</span> <span class="id">IN</span>. <span class="id">apply</span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.bot_1">V.bot_1</a></span> (<span class="id">s</span> "")). <span class="id">apply</span> <span class="id">IN</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="StoreAbstr.top">top</a></span>: <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.t">t</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Top_except">Top_except</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.empty">IdentMap.empty</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.t">V.t</a></span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="StoreAbstr.top_1">top_1</a></span>: <span class="kwd">forall</span> <span class="id">s</span>, <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.In">In</a></span> <span class="id">s</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.top">top</a></span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof13')">Proof.</span></div>
<div class="proofscript" id="proof13">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.In">In</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.top">top</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.get">get</a></span>; <span class="id">cbn</span>. <span class="id">intros</span>. <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.top_1">V.top_1</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="StoreAbstr.join_aux">join_aux</a></span> (<span class="id">ov1</span> <span class="id">ov2</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.t">V.t</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.t">V.t</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ov1</span>, <span class="id">ov2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v1</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v2</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.join">V.join</a></span> <span class="id">v1</span> <span class="id">v2</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="StoreAbstr.join">join</a></span> (<span class="id">S1</span> <span class="id">S2</span>: <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.t">t</a></span>) : <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.t">t</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">S1</span>, <span class="id">S2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Bot">Bot</a></span>, <span class="id">_</span> =&gt; <span class="id">S2</span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Bot">Bot</a></span> =&gt; <span class="id">S1</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Top_except">Top_except</a></span> <span class="id">m1</span>, <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Top_except">Top_except</a></span> <span class="id">m2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Top_except">Top_except</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.map2">IdentMap.map2</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.join_aux">join_aux</a></span> <span class="id">m1</span> <span class="id">m2</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="StoreAbstr.join_1">join_1</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">S1</span> <span class="id">S2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.In">In</a></span> <span class="id">s</span> <span class="id">S1</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.In">In</a></span> <span class="id">s</span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.join">join</a></span> <span class="id">S1</span> <span class="id">S2</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof14')">Proof.</span></div>
<div class="proofscript" id="proof14">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.join">join</a></span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">S1</span> <span class="kwd">as</span> [ | <span class="id">m1</span>]. <span class="id">elim</span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.bot_1">bot_1</a></span> <span class="id">s</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">S2</span> <span class="kwd">as</span> [ | <span class="id">m2</span>]. <span class="id">auto</span>.<br/>
- <span class="id">red</span>; <span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.get">get</a></span>; <span class="id">intros</span>. <span class="id">rewrite</span> <span class="id"><a href="CDF.AbstrInterp2.html#IMFact.map2_1bis">IMFact.map2_1bis</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.join_aux">join_aux</a></span>. <span class="id">specialize</span> (<span class="id">H</span> <span class="id">x</span>). <span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.get">get</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.find">IdentMap.find</a></span> <span class="id">x</span> <span class="id">m1</span>). <br/>
&nbsp;&nbsp;+ <span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.find">IdentMap.find</a></span> <span class="id">x</span> <span class="id">m2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.join_1">V.join_1</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.top_1">V.top_1</a></span>.<br/>
&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.top_1">V.top_1</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="StoreAbstr.join_2">join_2</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">S1</span> <span class="id">S2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.In">In</a></span> <span class="id">s</span> <span class="id">S2</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.In">In</a></span> <span class="id">s</span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.join">join</a></span> <span class="id">S1</span> <span class="id">S2</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof15')">Proof.</span></div>
<div class="proofscript" id="proof15">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.join">join</a></span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">S1</span> <span class="kwd">as</span> [ | <span class="id">m1</span>]. <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">S2</span> <span class="kwd">as</span> [ | <span class="id">m2</span>]. <span class="id">elim</span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.bot_1">bot_1</a></span> <span class="id">s</span>); <span class="id">auto</span>.<br/>
- <span class="id">red</span>; <span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.get">get</a></span>; <span class="id">intros</span>. <span class="id">rewrite</span> <span class="id"><a href="CDF.AbstrInterp2.html#IMFact.map2_1bis">IMFact.map2_1bis</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.join_aux">join_aux</a></span>. <span class="id">specialize</span> (<span class="id">H</span> <span class="id">x</span>). <span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.get">get</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.find">IdentMap.find</a></span> <span class="id">x</span> <span class="id">m1</span>). <br/>
&nbsp;&nbsp;+ <span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.find">IdentMap.find</a></span> <span class="id">x</span> <span class="id">m2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.join_2">V.join_2</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.top_1">V.top_1</a></span>.<br/>
&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.top_1">V.top_1</a></span>.<br/>
Qed.</div>
<br/>
<div class="doc">The widening operator.  We apply pointwise the <span class="bracket"><span class="id">V.widen</span></span> widening
    provided by the value domain, with default cases for variables
    not described in the map, which are implicitly set to <span class="bracket"><span class="id">V.top</span></span>. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="StoreAbstr.widen_aux">widen_aux</a></span> (<span class="id">ov1</span> <span class="id">ov2</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.t">V.t</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.t">V.t</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ov1</span>, <span class="id">ov2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v1</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v2</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.widen">V.widen</a></span> <span class="id">v1</span> <span class="id">v2</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>, <span class="id">_</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="StoreAbstr.widen">widen</a></span> (<span class="id">s1</span> <span class="id">s2</span>: <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.t">t</a></span>) : <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.t">t</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">s1</span>, <span class="id">s2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Bot">Bot</a></span>, <span class="id">_</span> =&gt; <span class="id">s2</span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Bot">Bot</a></span> =&gt; <span class="id">s1</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Top_except">Top_except</a></span> <span class="id">m1</span>, <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Top_except">Top_except</a></span> <span class="id">m2</span> =&gt; <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Top_except">Top_except</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.map2">IdentMap.map2</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.widen_aux">widen_aux</a></span> <span class="id">m1</span> <span class="id">m2</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="StoreAbstr.widen_1">widen_1</a></span>: <span class="kwd">forall</span> <span class="id">s1</span> <span class="id">s2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.le">le</a></span> <span class="id">s1</span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.widen">widen</a></span> <span class="id">s1</span> <span class="id">s2</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof16')">Proof.</span></div>
<div class="proofscript" id="proof16">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.le">le</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.widen">widen</a></span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">s1</span> <span class="kwd">as</span> [ | <span class="id">m1</span>]. <span class="id">elim</span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.bot_1">bot_1</a></span> <span class="id">_</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">s2</span> <span class="kwd">as</span> [ | <span class="id">m2</span>]. <span class="id">auto</span>. <br/>
&nbsp;&nbsp;<span class="id">red</span>; <span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.get">get</a></span>; <span class="id">intros</span>. <span class="id">specialize</span> (<span class="id">H</span> <span class="id">x</span>); <span class="id">cbn</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="CDF.AbstrInterp2.html#IMFact.map2_1bis">IMFact.map2_1bis</a></span>; <span class="id">auto</span>. <span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.widen_aux">widen_aux</a></span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.find">IdentMap.find</a></span> <span class="id">x</span> <span class="id">m1</span>); <span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.find">IdentMap.find</a></span> <span class="id">x</span> <span class="id">m2</span>);<br/>
&nbsp;&nbsp;<span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.top_1">V.top_1</a></span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.widen_1">V.widen_1</a></span>; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Constructing a well-founded order that guarantees termination is difficult.
    We start by defining a measure with nonnegative integer values
    for a finite map <span class="bracket"><span class="id">IdentMap.t</span> <span class="id">V.t</span></span>.  This measure is the sum
    of the measures of the abstract values in the codomain of this
    finite map. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="StoreAbstr.measure_map">measure_map</a></span> (<span class="id">m</span>: <span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.t">IdentMap.t</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.t">V.t</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.fold">IdentMap.fold</a></span> (<span class="kwd">fun</span> <span class="id">x</span> <span class="id">v</span> <span class="id">n</span> =&gt; (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure">V.measure</a></span> <span class="id">v</span> + <span class="id">n</span>)%<span class="id">nat</span>) <span class="id">m</span> 0%<span class="id">nat</span>.<br/>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="StoreAbstr.measure_map_empty">measure_map_empty</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span>, <span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.Empty">IdentMap.Empty</a></span> <span class="id">m</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_map">measure_map</a></span> <span class="id">m</span> = 0%<span class="id">nat</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof17')">Proof.</span></div>
<div class="proofscript" id="proof17">
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#IMProp.fold_Empty">IMProp.fold_Empty</a></span>; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="StoreAbstr.measure_map_add">measure_map_add</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">x</span> <span class="id">v</span> <span class="id">m</span>', ~<span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.In">IdentMap.In</a></span> <span class="id">x</span> <span class="id">m</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#IMProp.Add">IMProp.Add</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">m</span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_map">measure_map</a></span> <span class="id">m</span>' = (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure">V.measure</a></span> <span class="id">v</span> + <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_map">measure_map</a></span> <span class="id">m</span>)%<span class="id">nat</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof18')">Proof.</span></div>
<div class="proofscript" id="proof18">
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_map">measure_map</a></span>; <span class="id">eapply</span> <span class="id"><a href="CDF.AbstrInterp2.html#IMProp.fold_Add">IMProp.fold_Add</a></span> <span class="kwd">with</span> (<span class="id">f</span> := <span class="kwd">fun</span> <span class="id">x</span> <span class="id">v</span> <span class="id">n</span> =&gt; (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure">V.measure</a></span> <span class="id">v</span> + <span class="id">n</span>)%<span class="id">nat</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">repeat</span> (<span class="id">hnf</span>; <span class="id">intros</span>). <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;<span class="id">hnf</span>; <span class="id">intros</span>. <span class="id">lia</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="StoreAbstr.measure_map_remove">measure_map_remove</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_map">measure_map</a></span> <span class="id">m</span> = (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure">V.measure</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.get">get</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Top_except">Top_except</a></span> <span class="id">m</span>)) + <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_map">measure_map</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.remove">IdentMap.remove</a></span> <span class="id">x</span> <span class="id">m</span>))%<span class="id">nat</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof19')">Proof.</span></div>
<div class="proofscript" id="proof19">
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.get">get</a></span>. <span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.find">IdentMap.find</a></span> <span class="id">x</span> <span class="id">m</span>) <span class="kwd">as</span> [<span class="id">v</span>|] <span class="id">eqn</span>:<span class="id">F</span>.<br/>
- <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_map_add">measure_map_add</a></span> <span class="kwd">with</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#IMFact.not_find_in_iff">IMFact.not_find_in_iff</a></span>. <span class="id">rewrite</span> <span class="id"><a href="CDF.AbstrInterp2.html#IMFact.remove_eq_o">IMFact.remove_eq_o</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">red</span>; <span class="id">intros</span>. <span class="id">rewrite</span> <span class="id"><a href="CDF.AbstrInterp2.html#IMFact.add_o">IMFact.add_o</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#IMFact.remove_o">IMFact.remove_o</a></span>. <br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp.html#IdentMap.E.eq_dec">AbstrInterp.IdentMap.E.eq_dec</a></span> <span class="id">x</span> <span class="id">y</span>); <span class="id">congruence</span>.<br/>
- <span class="id">rewrite</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_top">V.measure_top</a></span>. <span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_map">measure_map</a></span>. <span class="id">eapply</span> <span class="id"><a href="CDF.AbstrInterp2.html#IMProp.fold_Equal">IMProp.fold_Equal</a></span>. <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">repeat</span> (<span class="id">hnf</span>; <span class="id">intros</span>). <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;<span class="id">hnf</span>; <span class="id">intros</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;<span class="id">red</span>; <span class="id">intros</span>. <span class="id">rewrite</span> <span class="id"><a href="CDF.AbstrInterp2.html#IMFact.remove_o">IMFact.remove_o</a></span>. <br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp.html#IdentMap.E.eq_dec">AbstrInterp.IdentMap.E.eq_dec</a></span> <span class="id">x</span> <span class="id">y</span>); <span class="id">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="StoreAbstr.measure_map_le">measure_map_le</a></span>: <span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure">V.measure</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.get">get</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Top_except">Top_except</a></span> <span class="id">m1</span>)) &lt;= <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure">V.measure</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.get">get</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Top_except">Top_except</a></span> <span class="id">m2</span>)))%<span class="id">nat</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_map">measure_map</a></span> <span class="id">m1</span> &lt;= <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_map">measure_map</a></span> <span class="id">m2</span>)%<span class="id">nat</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof20')">Proof.</span></div>
<div class="proofscript" id="proof20">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">m0</span>. <span class="id">pattern</span> <span class="id">m0</span>. <span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_map">measure_map</a></span> <span class="kwd">at</span> 1; <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#IMProp.fold_rec">IMProp.fold_rec</a></span>.<br/>
- <span class="id">intros</span> <span class="id">m</span> <span class="id">EMPTY</span> <span class="id">m2</span> <span class="id">LE</span>. <span class="id">lia</span>.<br/>
- <span class="id">intros</span> <span class="id">x</span> <span class="id">v1</span> <span class="id">n</span> <span class="id">m</span>' <span class="id">m</span>'' <span class="id">MAP</span> <span class="id">NOTIN</span> <span class="id">ADD</span> <span class="id">REC</span> <span class="id">m2</span> <span class="id">LE</span>.<br/>
&nbsp;&nbsp;<span class="id">set</span> (<span class="id">m2</span>' := <span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.remove">IdentMap.remove</a></span> <span class="id">x</span> <span class="id">m2</span>).<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">LE</span>': <span class="kwd">forall</span> <span class="id">x</span>, (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure">V.measure</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.get">get</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Top_except">Top_except</a></span> <span class="id">m</span>')) &lt;= <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure">V.measure</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.get">get</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Top_except">Top_except</a></span> <span class="id">m2</span>')))%<span class="id">nat</span>).<br/>
&nbsp;&nbsp;{ <span class="id">intros</span> <span class="id">y</span>. <span class="id">generalize</span> (<span class="id">LE</span> <span class="id">y</span>). <span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.get">get</a></span>, <span class="id">m2</span>'. <span class="id">rewrite</span> <span class="id">ADD</span>, <span class="id"><a href="CDF.AbstrInterp2.html#IMFact.add_o">IMFact.add_o</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#IMFact.remove_o">IMFact.remove_o</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp.html#IdentMap.E.eq_dec">AbstrInterp.IdentMap.E.eq_dec</a></span> <span class="id">x</span> <span class="id">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">subst</span> <span class="id">y</span>. <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#IMFact.not_find_in_iff">IMFact.not_find_in_iff</a></span> <span class="kwd">in</span> <span class="id">NOTIN</span>. <span class="id">rewrite</span> <span class="id">NOTIN</span>. <span class="id">rewrite</span> ! <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_top">V.measure_top</a></span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">REC</span> <span class="kwd">in</span> <span class="id">LE</span>'.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_map_remove">measure_map_remove</a></span> <span class="id">m2</span> <span class="id">x</span>). <span class="id">fold</span> <span class="id">m2</span>'.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">LE</span> <span class="id">x</span>). <span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.get">get</a></span> <span class="kwd">at</span> 1 <span class="kwd">in</span> <span class="id">LE</span>. <span class="id">rewrite</span> <span class="id">ADD</span>, <span class="id"><a href="CDF.AbstrInterp2.html#IMFact.add_eq_o">IMFact.add_eq_o</a></span> <span class="kwd">in</span> <span class="id">LE</span> <span class="kwd">by</span> <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">lia</span>.  <br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="StoreAbstr.measure_map_lt">measure_map_lt</a></span>: <span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure">V.measure</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.get">get</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Top_except">Top_except</a></span> <span class="id">m1</span>)) &lt;= <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure">V.measure</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.get">get</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Top_except">Top_except</a></span> <span class="id">m2</span>)))%<span class="id">nat</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">exists</span> <span class="id">x</span>, <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure">V.measure</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.get">get</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Top_except">Top_except</a></span> <span class="id">m1</span>)) &lt; <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure">V.measure</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.get">get</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Top_except">Top_except</a></span> <span class="id">m2</span>)))%<span class="id">nat</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_map">measure_map</a></span> <span class="id">m1</span> &lt; <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_map">measure_map</a></span> <span class="id">m2</span>)%<span class="id">nat</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof21')">Proof.</span></div>
<div class="proofscript" id="proof21">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">LE</span> (<span class="id">x</span> &amp; <span class="id">LT</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_map_remove">measure_map_remove</a></span> <span class="id">m1</span> <span class="id">x</span>), (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_map_remove">measure_map_remove</a></span> <span class="id">m2</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;<span class="id">assert</span> ((<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_map">measure_map</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.remove">IdentMap.remove</a></span> <span class="id">x</span> <span class="id">m1</span>) &lt;= <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_map">measure_map</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.remove">IdentMap.remove</a></span> <span class="id">x</span> <span class="id">m2</span>))%<span class="id">nat</span>).<br/>
&nbsp;&nbsp;{ <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_map_le">measure_map_le</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">y</span>; <span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.get">get</a></span>. <span class="id">rewrite</span> ! <span class="id"><a href="CDF.AbstrInterp2.html#IMFact.remove_o">IMFact.remove_o</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp.html#IdentMap.E.eq_dec">AbstrInterp.IdentMap.E.eq_dec</a></span> <span class="id">x</span> <span class="id">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">LE</span>. }<br/>
&nbsp;&nbsp;<span class="id">lia</span>.<br/>
Qed.</div>
<br/>
<div class="doc">We then show that this measure strictly decreases during a widening
    step that does not mention <span class="bracket"><span class="id">Bot</span></span>. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="StoreAbstr.measure_widen_lt">measure_widen_lt</a></span>: <span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.ble">ble</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Top_except">Top_except</a></span> <span class="id">m2</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Top_except">Top_except</a></span> <span class="id">m1</span>) = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_map">measure_map</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.map2">IdentMap.map2</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.widen_aux">widen_aux</a></span> <span class="id">m1</span> <span class="id">m2</span>) &lt; <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_map">measure_map</a></span> <span class="id">m1</span>)%<span class="id">nat</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof22')">Proof.</span></div>
<div class="proofscript" id="proof22">
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.ble_false">ble_false</a></span> <span class="kwd">in</span> <span class="id">H</span>. 2: <span class="id">congruence</span>. <span class="id">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">x</span> &amp; <span class="id">BL</span>).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_map_lt">measure_map_lt</a></span>.<br/>
- <span class="id">intros</span> <span class="id">y</span>. <span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.get">get</a></span>. <span class="id">rewrite</span> <span class="id"><a href="CDF.AbstrInterp2.html#IMFact.map2_1bis">IMFact.map2_1bis</a></span> <span class="kwd">by</span> <span class="id">auto</span>. <span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.widen_aux">widen_aux</a></span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.find">IdentMap.find</a></span> <span class="id">y</span> <span class="id">m1</span>) <span class="kwd">as</span> [ <span class="id">v1</span> |].<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.find">IdentMap.find</a></span> <span class="id">y</span> <span class="id">m2</span>) <span class="kwd">as</span> [ <span class="id">v2</span> |].<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.widen_2">V.widen_2</a></span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_top">V.measure_top</a></span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_top">V.measure_top</a></span>; <span class="id">lia</span>.<br/>
- <span class="kwd">exists</span> <span class="id">x</span>. <span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.get">get</a></span> <span class="kwd">in</span> *. <span class="id">rewrite</span> <span class="id"><a href="CDF.AbstrInterp2.html#IMFact.map2_1bis">IMFact.map2_1bis</a></span> <span class="kwd">by</span> <span class="id">auto</span>. <span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.widen_aux">widen_aux</a></span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.find">IdentMap.find</a></span> <span class="id">x</span> <span class="id">m1</span>) <span class="kwd">as</span> [ <span class="id">v1</span> |].<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#IdentMap.find">IdentMap.find</a></span> <span class="id">x</span> <span class="id">m2</span>) <span class="kwd">as</span> [ <span class="id">v2</span> |].<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.widen_3">V.widen_3</a></span> <span class="kwd">in</span> <span class="id">BL</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.widen_3">V.widen_3</a></span> <span class="kwd">in</span> <span class="id">BL</span>; <span class="id">rewrite</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_top">V.measure_top</a></span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">T</span>: <span class="kwd">forall</span> <span class="id">z</span>, <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.ble">V.ble</a></span> <span class="id">z</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.top">V.top</a></span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>).<br/>
&nbsp;&nbsp;{ <span class="id">intros</span>. <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.ble_2">V.ble_2</a></span>. <span class="id">red</span>; <span class="id">intros</span>. <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.top_1">V.top_1</a></span>. }<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">T</span> <span class="kwd">in</span> <span class="id">BL</span>. <span class="id">congruence</span>.<br/>
Qed.</div>
<br/>
<div class="doc">We conclude that the widening order is well founded. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="StoreAbstr.widen_order">widen_order</a></span> (<span class="id">S</span> <span class="id">S1</span>: <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.t">t</a></span>) := <span class="kwd">exists</span> <span class="id">S2</span>, <span class="id">S</span> = <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.widen">widen</a></span> <span class="id">S1</span> <span class="id">S2</span> /\ <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.ble">ble</a></span> <span class="id">S2</span> <span class="id">S1</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="StoreAbstr.widen_order_wf">widen_order_wf</a></span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Wf.html#well_founded">well_founded</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.widen_order">widen_order</a></span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof23')">Proof.</span></div>
<div class="proofscript" id="proof23">
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">A</span>: <span class="kwd">forall</span> <span class="id">m</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Wf.html#Acc">Acc</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.widen_order">widen_order</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Top_except">Top_except</a></span> <span class="id">m</span>)).<br/>
&nbsp;&nbsp;{ <span class="id">induction</span> <span class="id">m</span> <span class="kwd">using</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Wf.html#well_founded_ind">well_founded_ind</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Wf_nat.html#well_founded_ltof">well_founded_ltof</a></span> <span class="id">_</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_map">measure_map</a></span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="id">intros</span> <span class="id">S</span> (<span class="id">S2</span> &amp; <span class="id">EQ</span> &amp; <span class="id">BLE</span>). <span class="id">subst</span> <span class="id">S</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">S2</span>. <span class="id">discriminate</span>. <span class="id">apply</span> <span class="id">H</span>. <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.measure_widen_lt">measure_widen_lt</a></span>. <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">B</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Wf.html#Acc">Acc</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.widen_order">widen_order</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.Bot">Bot</a></span>).<br/>
&nbsp;&nbsp;{ <span class="id">constructor</span>. <span class="id">intros</span> <span class="id">S</span> (<span class="id">S2</span> &amp; <span class="id">EQ</span> &amp; <span class="id">BLE</span>). <span class="id">subst</span> <span class="id">S</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr.ble">ble</a></span> <span class="kwd">in</span> <span class="id">BLE</span>. <span class="id">destruct</span> <span class="id">S2</span>. <span class="id">discriminate</span>. <span class="id">apply</span> <span class="id">A</span>. }<br/>
&nbsp;&nbsp;<span class="id">red</span>. <span class="id">destruct</span> <span class="id">a</span>; <span class="id">auto</span>.<br/>
Defined.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr">StoreAbstr</a></span>.<br/>
<br/>
<h2> 5.8.  The abstract domain of intervals </h2>
<br/>
<div class="doc">We first define the type <span class="bracket"><span class="id">zinf</span></span> of integers complemented with a
    "plus infinity" value. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="zinf">zinf</a></span> : <span class="kwd">Type</span> := <span class="id"><a name="Fin">Fin</a></span> (<span class="id">h</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) | <span class="id"><a name="Inf">Inf</a></span>.<br/>
<br/>
<span class="kwd">Coercion</span> <span class="id">Fin</span> : <span class="id">Z</span> &gt;-&gt; <span class="id">zinf</span>.<br/>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="Zinf">Zinf</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Zinf.In">In</a></span> (<span class="id">n</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">N</span>: <span class="id"><a href="CDF.AbstrInterp2.html#zinf">zinf</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">N</span> <span class="kwd">with</span> <span class="id"><a href="CDF.AbstrInterp2.html#Fin">Fin</a></span> <span class="id">h</span> =&gt; <span class="id">n</span> &lt;= <span class="id">h</span> | <span class="id"><a href="CDF.AbstrInterp2.html#Inf">Inf</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span> <span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Zinf.In_mono">In_mono</a></span>: <span class="kwd">forall</span> <span class="id">n1</span> <span class="id">n2</span> <span class="id">N</span>, <span class="id">n1</span> &lt;= <span class="id">n2</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">In</a></span> <span class="id">n2</span> <span class="id">N</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">In</a></span> <span class="id">n1</span> <span class="id">N</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof24')">Proof.</span></div>
<div class="proofscript" id="proof24">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">In</a></span>; <span class="id">destruct</span> <span class="id">N</span>; <span class="id">intros</span>. <span class="id">lia</span>. <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Zinf.le">le</a></span> (<span class="id">N1</span> <span class="id">N2</span>: <span class="id"><a href="CDF.AbstrInterp2.html#zinf">zinf</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">In</a></span> <span class="id">n</span> <span class="id">N1</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">In</a></span> <span class="id">n</span> <span class="id">N2</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Zinf.le_Fin">le_Fin</a></span>: <span class="kwd">forall</span> <span class="id">n1</span> <span class="id">N2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.le">le</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Fin">Fin</a></span> <span class="id">n1</span>) <span class="id">N2</span> &lt;-&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">In</a></span> <span class="id">n1</span> <span class="id">N2</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof25')">Proof.</span></div>
<div class="proofscript" id="proof25">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.le">le</a></span>; <span class="id">cbn</span>; <span class="id">intros</span>; <span class="id">split</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id">H</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">N2</span>; <span class="id">cbn</span> <span class="kwd">in</span> *; <span class="id">auto</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Zinf.le_is_Inf">le_is_Inf</a></span>: <span class="kwd">forall</span> <span class="id">N</span> <span class="id">h</span>, (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id">h</span> &lt;= <span class="id">n</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">In</a></span> <span class="id">n</span> <span class="id">N</span>) -&gt; <span class="id">N</span> = <span class="id"><a href="CDF.AbstrInterp2.html#Inf">Inf</a></span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof26')">Proof.</span></div>
<div class="proofscript" id="proof26">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">N</span>; <span class="id">cbn</span>; <span class="id">intros</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.max">Z.max</a></span> <span class="id">h0</span> (<span class="id">h</span> + 1))). <span class="id">lia</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Zinf.le_Inf">le_Inf</a></span>: <span class="kwd">forall</span> <span class="id">N</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.le">le</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#Inf">Inf</a></span> <span class="id">N</span> &lt;-&gt; <span class="id">N</span> = <span class="id"><a href="CDF.AbstrInterp2.html#Inf">Inf</a></span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof27')">Proof.</span></div>
<div class="proofscript" id="proof27">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.le">le</a></span>; <span class="id">intros</span>; <span class="id">split</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.le_is_Inf">le_is_Inf</a></span> <span class="kwd">with</span> 0. <span class="id">intros</span>; <span class="id">apply</span> <span class="id">H</span>; <span class="id">exact</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">subst</span> <span class="id">N</span>; <span class="id">exact</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Zinf.ble">ble</a></span> (<span class="id">N1</span> <span class="id">N2</span>: <span class="id"><a href="CDF.AbstrInterp2.html#zinf">zinf</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">N1</span>, <span class="id">N2</span> <span class="kwd">with</span> <span class="id">_</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Inf">Inf</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> | <span class="id"><a href="CDF.AbstrInterp2.html#Inf">Inf</a></span>, <span class="id">_</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> | <span class="id"><a href="CDF.AbstrInterp2.html#Fin">Fin</a></span> <span class="id">h1</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Fin">Fin</a></span> <span class="id">h2</span> =&gt; <span class="id">h1</span> &lt;=? <span class="id">h2</span> <span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Zinf.ble_1">ble_1</a></span>: <span class="kwd">forall</span> <span class="id">N1</span> <span class="id">N2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.ble">ble</a></span> <span class="id">N1</span> <span class="id">N2</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.le">le</a></span> <span class="id">N1</span> <span class="id">N2</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof28')">Proof.</span></div>
<div class="proofscript" id="proof28">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.ble">ble</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.le">le</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">In</a></span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">N1</span>, <span class="id">N2</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.leb_le">Z.leb_le</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">discriminate</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Zinf.ble_2">ble_2</a></span>: <span class="kwd">forall</span> <span class="id">N1</span> <span class="id">N2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.le">le</a></span> <span class="id">N1</span> <span class="id">N2</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.ble">ble</a></span> <span class="id">N1</span> <span class="id">N2</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof29')">Proof.</span></div>
<div class="proofscript" id="proof29">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.ble">ble</a></span>; <span class="id">intros</span>. <span class="id">destruct</span> <span class="id">N1</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.le_Fin">le_Fin</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">destruct</span> <span class="id">N2</span>; <span class="id">auto</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.leb_le">Z.leb_le</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.le_Inf">le_Inf</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">rewrite</span> <span class="id">H</span>. <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Zinf.max">max</a></span> (<span class="id">N1</span> <span class="id">N2</span>: <span class="id"><a href="CDF.AbstrInterp2.html#zinf">zinf</a></span>) : <span class="id"><a href="CDF.AbstrInterp2.html#zinf">zinf</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">N1</span>, <span class="id">N2</span> <span class="kwd">with</span> <span class="id"><a href="CDF.AbstrInterp2.html#Inf">Inf</a></span>, <span class="id">_</span> =&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Inf">Inf</a></span> | <span class="id">_</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Inf">Inf</a></span> =&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Inf">Inf</a></span> | <span class="id"><a href="CDF.AbstrInterp2.html#Fin">Fin</a></span> <span class="id">h1</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Fin">Fin</a></span> <span class="id">h2</span> =&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Fin">Fin</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.max">Z.max</a></span> <span class="id">h1</span> <span class="id">h2</span>) <span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Zinf.max_1">max_1</a></span>: <span class="kwd">forall</span> <span class="id">n</span> <span class="id">N1</span> <span class="id">N2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">In</a></span> <span class="id">n</span> <span class="id">N1</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">In</a></span> <span class="id">n</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.max">max</a></span> <span class="id">N1</span> <span class="id">N2</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof30')">Proof.</span></div>
<div class="proofscript" id="proof30">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">In</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.max">max</a></span>; <span class="id">intros</span>. <span class="id">destruct</span> <span class="id">N1</span>; <span class="id">auto</span>. <span class="id">destruct</span> <span class="id">N2</span>; <span class="id">auto</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Zinf.max_2">max_2</a></span>: <span class="kwd">forall</span> <span class="id">n</span> <span class="id">N1</span> <span class="id">N2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">In</a></span> <span class="id">n</span> <span class="id">N2</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">In</a></span> <span class="id">n</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.max">max</a></span> <span class="id">N1</span> <span class="id">N2</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof31')">Proof.</span></div>
<div class="proofscript" id="proof31">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">In</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.max">max</a></span>; <span class="id">intros</span>. <span class="id">destruct</span> <span class="id">N1</span>; <span class="id">auto</span>. <span class="id">destruct</span> <span class="id">N2</span>; <span class="id">auto</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Zinf.min">min</a></span> (<span class="id">N1</span> <span class="id">N2</span>: <span class="id"><a href="CDF.AbstrInterp2.html#zinf">zinf</a></span>) : <span class="id"><a href="CDF.AbstrInterp2.html#zinf">zinf</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">N1</span>, <span class="id">N2</span> <span class="kwd">with</span> <span class="id"><a href="CDF.AbstrInterp2.html#Inf">Inf</a></span>, <span class="id">_</span> =&gt; <span class="id">N2</span> | <span class="id">_</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Inf">Inf</a></span> =&gt; <span class="id">N1</span> | <span class="id"><a href="CDF.AbstrInterp2.html#Fin">Fin</a></span> <span class="id">h1</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Fin">Fin</a></span> <span class="id">h2</span> =&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Fin">Fin</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.min">Z.min</a></span> <span class="id">h1</span> <span class="id">h2</span>) <span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Zinf.min_1">min_1</a></span>: <span class="kwd">forall</span> <span class="id">n</span> <span class="id">N1</span> <span class="id">N2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">In</a></span> <span class="id">n</span> <span class="id">N1</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">In</a></span> <span class="id">n</span> <span class="id">N2</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">In</a></span> <span class="id">n</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.min">min</a></span> <span class="id">N1</span> <span class="id">N2</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof32')">Proof.</span></div>
<div class="proofscript" id="proof32">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">In</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.min">min</a></span>; <span class="id">intros</span>. <span class="id">destruct</span> <span class="id">N1</span>; <span class="id">auto</span>. <span class="id">destruct</span> <span class="id">N2</span>; <span class="id">auto</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Zinf.add">add</a></span> (<span class="id">N1</span> <span class="id">N2</span>: <span class="id"><a href="CDF.AbstrInterp2.html#zinf">zinf</a></span>) : <span class="id"><a href="CDF.AbstrInterp2.html#zinf">zinf</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">N1</span>, <span class="id">N2</span> <span class="kwd">with</span> <span class="id"><a href="CDF.AbstrInterp2.html#Inf">Inf</a></span>, <span class="id">_</span> =&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Inf">Inf</a></span> | <span class="id">_</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Inf">Inf</a></span> =&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Inf">Inf</a></span> | <span class="id"><a href="CDF.AbstrInterp2.html#Fin">Fin</a></span> <span class="id">h1</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Fin">Fin</a></span> <span class="id">h2</span> =&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Fin">Fin</a></span> (<span class="id">h1</span> + <span class="id">h2</span>) <span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Zinf.add_1">add_1</a></span>: <span class="kwd">forall</span> <span class="id">n1</span> <span class="id">n2</span> <span class="id">N1</span> <span class="id">N2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">In</a></span> <span class="id">n1</span> <span class="id">N1</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">In</a></span> <span class="id">n2</span> <span class="id">N2</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">In</a></span> (<span class="id">n1</span> + <span class="id">n2</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.add">add</a></span> <span class="id">N1</span> <span class="id">N2</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof33')">Proof.</span></div>
<div class="proofscript" id="proof33">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">In</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.add">add</a></span>; <span class="id">intros</span>. <span class="id">destruct</span> <span class="id">N1</span>; <span class="id">auto</span>. <span class="id">destruct</span> <span class="id">N2</span>; <span class="id">auto</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Zinf.isIn">isIn</a></span> (<span class="id">n</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">N</span>: <span class="id"><a href="CDF.AbstrInterp2.html#zinf">zinf</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">N</span> <span class="kwd">with</span> <span class="id"><a href="CDF.AbstrInterp2.html#Fin">Fin</a></span> <span class="id">h</span> =&gt; <span class="id">n</span> &lt;=? <span class="id">h</span> | <span class="id"><a href="CDF.AbstrInterp2.html#Inf">Inf</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> <span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Zinf.isIn_1">isIn_1</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">N</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">In</a></span> <span class="id">n</span> <span class="id">N</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.isIn">isIn</a></span> <span class="id">n</span> <span class="id">N</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof34')">Proof.</span></div>
<div class="proofscript" id="proof34">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">In</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.isIn">isIn</a></span>; <span class="id">intros</span>. <span class="id">destruct</span> <span class="id">N</span>; <span class="id">auto</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.leb_le">Z.leb_le</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Zinf.pred">pred</a></span> (<span class="id">N</span>: <span class="id"><a href="CDF.AbstrInterp2.html#zinf">zinf</a></span>) : <span class="id"><a href="CDF.AbstrInterp2.html#zinf">zinf</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">N</span> <span class="kwd">with</span> <span class="id"><a href="CDF.AbstrInterp2.html#Inf">Inf</a></span> =&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Inf">Inf</a></span> | <span class="id"><a href="CDF.AbstrInterp2.html#Fin">Fin</a></span> <span class="id">n</span> =&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Fin">Fin</a></span> (<span class="id">n</span> - 1) <span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Zinf.pred_1">pred_1</a></span>: <span class="kwd">forall</span> <span class="id">n</span> <span class="id">N</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">In</a></span> <span class="id">n</span> <span class="id">N</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">In</a></span> (<span class="id">n</span> - 1) (<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.pred">pred</a></span> <span class="id">N</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof35')">Proof.</span></div>
<div class="proofscript" id="proof35">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.pred">pred</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">In</a></span>; <span class="id">intros</span>; <span class="id">destruct</span> <span class="id">N</span>; <span class="id">auto</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">We define widening between two possibly infinite integers as follows:
    if the integer increases strictly, we jump to infinity, otherwise
    we keep the first integer. </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Zinf.widen">widen</a></span> (<span class="id">N1</span> <span class="id">N2</span>: <span class="id"><a href="CDF.AbstrInterp2.html#zinf">zinf</a></span>) : <span class="id"><a href="CDF.AbstrInterp2.html#zinf">zinf</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.ble">ble</a></span> <span class="id">N2</span> <span class="id">N1</span> <span class="kwd">then</span> <span class="id">N1</span> <span class="kwd">else</span> <span class="id"><a href="CDF.AbstrInterp2.html#Inf">Inf</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Zinf.widen_1">widen_1</a></span>: <span class="kwd">forall</span> <span class="id">N1</span> <span class="id">N2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.le">le</a></span> <span class="id">N1</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.widen">widen</a></span> <span class="id">N1</span> <span class="id">N2</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof36')">Proof.</span></div>
<div class="proofscript" id="proof36">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.widen">widen</a></span>; <span class="id">intros</span>. <span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.ble">ble</a></span> <span class="id">N2</span> <span class="id">N1</span>) <span class="id">eqn</span>:<span class="id">LE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span>; <span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">In</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Zinf.measure">measure</a></span> (<span class="id">N</span>: <span class="id"><a href="CDF.AbstrInterp2.html#zinf">zinf</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">N</span> <span class="kwd">with</span> <span class="id"><a href="CDF.AbstrInterp2.html#Inf">Inf</a></span> =&gt; 0%<span class="id">nat</span> | <span class="id"><a href="CDF.AbstrInterp2.html#Fin">Fin</a></span> <span class="id">_</span> =&gt; 1%<span class="id">nat</span> <span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Zinf.measure_1">measure_1</a></span>: <span class="kwd">forall</span> <span class="id">N</span>, (<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.measure">measure</a></span> <span class="id">N</span> &lt;= 1)%<span class="id">nat</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof37')">Proof.</span></div>
<div class="proofscript" id="proof37">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">N</span>; <span class="id">cbn</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Zinf.widen_2">widen_2</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">N1</span> <span class="id">N2</span>, (<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.measure">measure</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.widen">widen</a></span> <span class="id">N1</span> <span class="id">N2</span>) &lt;= <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.measure">measure</a></span> <span class="id">N1</span>)%<span class="id">nat</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof38')">Proof.</span></div>
<div class="proofscript" id="proof38">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.widen">widen</a></span>. <span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.ble">ble</a></span> <span class="id">N2</span> <span class="id">N1</span>) <span class="id">eqn</span>:<span class="id">BLE</span>.<br/>
&nbsp;&nbsp;- <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">N1</span>. <span class="id">cbn</span>; <span class="id">lia</span>. <span class="id">destruct</span> <span class="id">N2</span>; <span class="id">discriminate</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Zinf.widen_3">widen_3</a></span>: <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">N1</span> <span class="id">N2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.ble">ble</a></span> <span class="id">N2</span> <span class="id">N1</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt; (<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.measure">measure</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.widen">widen</a></span> <span class="id">N1</span> <span class="id">N2</span>) &lt; <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.measure">measure</a></span> <span class="id">N1</span>)%<span class="id">nat</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof39')">Proof.</span></div>
<div class="proofscript" id="proof39">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">N1</span>, <span class="id">N2</span>; <span class="id">cbn</span>; <span class="id">intros</span>; <span class="id">auto</span>; <span class="id">try</span> <span class="id">discriminate</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.widen">widen</a></span>. <span class="id">cbn</span>. <span class="id">rewrite</span> <span class="id">H</span>. <span class="id">cbn</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf">Zinf</a></span>.<br/>
<br/>
<div class="doc">An interval is encoded as a pair of two <span class="bracket"><span class="id">zinf</span></span>.
    The second <span class="bracket"><span class="id">zinf</span></span> is the upper bound.
    The first <span class="bracket"><span class="id">zinf</span></span> is the opposite of the lower bound.
    This representation trick makes it possible to have only one
    infinity <span class="bracket"><span class="id">Inf</span></span>, instead of a negative infinity for lower bounds
    and a positive infinity for upper bounds. </div>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="Intervals">Intervals</a></span> &lt;: <span class="id"><a href="CDF.AbstrInterp2.html#VALUE_ABSTRACTION">VALUE_ABSTRACTION</a></span>.<br/>
<br/>
<div class="doc">The type of abstract values. </div>
&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="Intervals.interval">interval</a></span> : <span class="kwd">Type</span> := <span class="id"><a name="Intervals.intv">intv</a></span> { <span class="id"><a name="Intervals.low">low</a></span>: <span class="id"><a href="CDF.AbstrInterp2.html#zinf">zinf</a></span>; <span class="id"><a name="Intervals.high">high</a></span>: <span class="id"><a href="CDF.AbstrInterp2.html#zinf">zinf</a></span> }.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Intervals.t">t</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.interval">interval</a></span>.<br/>
<br/>
<div class="doc">Membership: <span class="bracket"><span class="id">n</span></span> must be below the upper bound, and the opposite of <span class="bracket"><span class="id">n</span></span>
    must be below the opposite of the lower bound. </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Intervals.In">In</a></span> (<span class="id">n</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">N</span>: <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">Zinf.In</a></span> <span class="id">n</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">N</span>) /\ <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">Zinf.In</a></span> (-<span class="id">n</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> <span class="id">N</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Intervals.le">le</a></span> (<span class="id">N1</span> <span class="id">N2</span>: <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n</span> <span class="id">N1</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n</span> <span class="id">N2</span>.<br/>
<br/>
<div class="doc">Test whether an interval is empty. </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Intervals.isempty">isempty</a></span> (<span class="id">N</span>: <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">N</span> <span class="kwd">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;| {| <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Fin">Fin</a></span> <span class="id">l</span>; <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Fin">Fin</a></span> <span class="id">h</span> |} =&gt; <span class="id">h</span> &lt;? (-<span class="id">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Intervals.isempty_1">isempty_1</a></span>: <span class="kwd">forall</span> <span class="id">n</span> <span class="id">N</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty">isempty</a></span> <span class="id">N</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n</span> <span class="id">N</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof40')">Proof.</span></div>
<div class="proofscript" id="proof40">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty">isempty</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span>; <span class="id">intros</span>. <span class="id">destruct</span> <span class="id">N</span> <span class="kwd">as</span> [[<span class="id">l</span>|] [<span class="id">h</span>|]]; <span class="id">try</span> <span class="id">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.ltb_lt">Z.ltb_lt</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">cbn</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Intervals.isempty_2">isempty_2</a></span>: <span class="kwd">forall</span> <span class="id">N</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty">isempty</a></span> <span class="id">N</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt; <span class="kwd">exists</span> <span class="id">n</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n</span> <span class="id">N</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof41')">Proof.</span></div>
<div class="proofscript" id="proof41">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty">isempty</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span>; <span class="id">intros</span>. <span class="id">destruct</span> <span class="id">N</span> <span class="kwd">as</span> [[<span class="id">l</span>|] [<span class="id">h</span>|]]; <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.ltb_ge">Z.ltb_ge</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="kwd">exists</span> <span class="id">h</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="kwd">exists</span> (- <span class="id">l</span>); <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="kwd">exists</span> <span class="id">h</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="kwd">exists</span> 0; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Intervals.nonempty_le">nonempty_le</a></span>: <span class="kwd">forall</span> <span class="id">N1</span> <span class="id">N2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.le">le</a></span> <span class="id">N1</span> <span class="id">N2</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty">isempty</a></span> <span class="id">N1</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt; (<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.le">Zinf.le</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">N1</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">N2</span>) /\ <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.le">Zinf.le</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> <span class="id">N1</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> <span class="id">N2</span>)).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof42')">Proof.</span></div>
<div class="proofscript" id="proof42">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.le">le</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty">isempty</a></span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">N1</span> <span class="kwd">as</span> [[<span class="id">l1</span> |] [<span class="id">h1</span>|]]; <span class="id">cbn</span> <span class="kwd">in</span> *; <span class="id">rewrite</span> ? <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.le_Fin">Zinf.le_Fin</a></span>, ? <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.le_Inf">Zinf.le_Inf</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.ltb_ge">Z.ltb_ge</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">H</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">replace</span> <span class="id">l1</span> <span class="kwd">with</span> (- - <span class="id">l1</span>) <span class="kwd">by</span> <span class="id">lia</span>. <span class="id">apply</span> <span class="id">H</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.le_is_Inf">Zinf.le_is_Inf</a></span> <span class="kwd">with</span> (-<span class="id">l1</span>). <span class="id">intros</span>; <span class="id">apply</span> <span class="id">H</span>. <span class="id">intuition</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">replace</span> <span class="id">l1</span> <span class="kwd">with</span> (- - <span class="id">l1</span>) <span class="kwd">by</span> <span class="id">lia</span>. <span class="id">apply</span> <span class="id">H</span>. <span class="id">intuition</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">H</span>. <span class="id">intuition</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.le_is_Inf">Zinf.le_is_Inf</a></span> <span class="kwd">with</span>(- <span class="id">h1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">replace</span> <span class="id">n</span> <span class="kwd">with</span> (- - <span class="id">n</span>) <span class="kwd">by</span> <span class="id">lia</span>. <span class="id">apply</span> <span class="id">H</span>. <span class="id">intuition</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">split</span>; <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.le_is_Inf">Zinf.le_is_Inf</a></span> <span class="kwd">with</span> 0; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">H</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">replace</span> <span class="id">n</span> <span class="kwd">with</span> (- - <span class="id">n</span>) <span class="kwd">by</span> <span class="id">lia</span>. <span class="id">apply</span> <span class="id">H</span>. <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc"><span class="bracket"><span class="id">ble</span></span> is a Boolean-valued function that decides the <span class="bracket"><span class="id">le</span></span> relation. </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Intervals.ble">ble</a></span> (<span class="id">N1</span> <span class="id">N2</span>: <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty">isempty</a></span> <span class="id">N1</span> || (<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.ble">Zinf.ble</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">N1</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">N2</span>) &amp;&amp; <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.ble">Zinf.ble</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> <span class="id">N1</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> <span class="id">N2</span>)).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Intervals.ble_1">ble_1</a></span>: <span class="kwd">forall</span> <span class="id">N1</span> <span class="id">N2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.ble">ble</a></span> <span class="id">N1</span> <span class="id">N2</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.le">le</a></span> <span class="id">N1</span> <span class="id">N2</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof43')">Proof.</span></div>
<div class="proofscript" id="proof43">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.ble">ble</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.le">le</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty">isempty</a></span> <span class="id">N1</span>) <span class="id">eqn</span>:<span class="id">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">elim</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty_1">isempty_1</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">E</span> <span class="id">H0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#andb_prop">andb_prop</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">B1</span> <span class="id">B2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.ble_1">Zinf.ble_1</a></span> <span class="kwd">in</span> <span class="id">B1</span>. <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.ble_1">Zinf.ble_1</a></span> <span class="kwd">in</span> <span class="id">B2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intuition</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Intervals.ble_2">ble_2</a></span>: <span class="kwd">forall</span> <span class="id">N1</span> <span class="id">N2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.le">le</a></span> <span class="id">N1</span> <span class="id">N2</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.ble">ble</a></span> <span class="id">N1</span> <span class="id">N2</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof44')">Proof.</span></div>
<div class="proofscript" id="proof44">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.ble">ble</a></span>; <span class="id">intros</span>. <span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty">isempty</a></span> <span class="id">N1</span>) <span class="id">eqn</span>:<span class="id">E</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.nonempty_le">nonempty_le</a></span> <span class="id">N1</span> <span class="id">N2</span>) <span class="kwd">as</span> [<span class="id">P</span> <span class="id">Q</span>]; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#andb_true_intro">andb_true_intro</a></span>; <span class="id">split</span>; <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.ble_2">Zinf.ble_2</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc"><span class="bracket"><span class="id">const</span> <span class="id">n</span></span> is the abstract value for the singleton set <span class="bracket">{<span class="id">n</span>}</span>. </div>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Intervals.const">const</a></span> (<span class="id">n</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span> := {| <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Fin">Fin</a></span> (-<span class="id">n</span>); <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Fin">Fin</a></span> <span class="id">n</span> |}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Intervals.const_1">const_1</a></span>: <span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.const">const</a></span> <span class="id">n</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof45')">Proof.</span></div>
<div class="proofscript" id="proof45">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.const">const</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">Zinf.In</a></span>; <span class="id">intros</span>; <span class="id">cbn</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc"><span class="bracket"><span class="id">bot</span></span> represents the empty set. </div>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Intervals.bot">bot</a></span>: <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span> := {| <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Fin">Fin</a></span> 0; <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Fin">Fin</a></span> (-1) |}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Intervals.bot_1">bot_1</a></span>: <span class="kwd">forall</span> <span class="id">n</span>, ~(<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.bot">bot</a></span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof46')">Proof.</span></div>
<div class="proofscript" id="proof46">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.bot">bot</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In">Zinf.In</a></span>; <span class="id">intros</span>; <span class="id">cbn</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc"><span class="bracket"><span class="id">top</span></span> represents the set of all integers. </div>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Intervals.top">top</a></span>: <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span> := {| <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Inf">Inf</a></span>; <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Inf">Inf</a></span> |}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Intervals.top_1">top_1</a></span>: <span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.top">top</a></span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof47')">Proof.</span></div>
<div class="proofscript" id="proof47">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">split</span>; <span class="id">exact</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc"><span class="bracket"><span class="id">join</span></span> computes an upper bound of its two arguments. </div>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Intervals.join">join</a></span> (<span class="id">N1</span> <span class="id">N2</span>: <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span>) : <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.max">Zinf.max</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> <span class="id">N1</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> <span class="id">N2</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.max">Zinf.max</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">N1</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">N2</span>) |}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Intervals.join_1">join_1</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">N1</span> <span class="id">N2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n</span> <span class="id">N1</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.join">join</a></span> <span class="id">N1</span> <span class="id">N2</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof48')">Proof.</span></div>
<div class="proofscript" id="proof48">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.join">join</a></span>; <span class="id">intros</span>; <span class="id">cbn</span>. <span class="id">split</span>; <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.max_1">Zinf.max_1</a></span>; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Intervals.join_2">join_2</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">N1</span> <span class="id">N2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n</span> <span class="id">N2</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.join">join</a></span> <span class="id">N1</span> <span class="id">N2</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof49')">Proof.</span></div>
<div class="proofscript" id="proof49">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.join">join</a></span>; <span class="id">intros</span>; <span class="id">cbn</span>. <span class="id">split</span>; <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.max_2">Zinf.max_2</a></span>; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">The abstract operators for addition and subtraction. </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Intervals.add">add</a></span> (<span class="id">N1</span> <span class="id">N2</span>: <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span>) : <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty">isempty</a></span> <span class="id">N1</span> || <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty">isempty</a></span> <span class="id">N2</span> <span class="kwd">then</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.bot">bot</a></span> <span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.add">Zinf.add</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> <span class="id">N1</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> <span class="id">N2</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.add">Zinf.add</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">N1</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">N2</span>) |}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Intervals.add_1">add_1</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n1</span> <span class="id">n2</span> <span class="id">N1</span> <span class="id">N2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n1</span> <span class="id">N1</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n2</span> <span class="id">N2</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> (<span class="id">n1</span> + <span class="id">n2</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.add">add</a></span> <span class="id">N1</span> <span class="id">N2</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof50')">Proof.</span></div>
<div class="proofscript" id="proof50">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.add">add</a></span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty">isempty</a></span> <span class="id">N1</span>) <span class="id">eqn</span>:<span class="id">E1</span>. <span class="id">elim</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty_1">isempty_1</a></span> <span class="id">n1</span> <span class="id">N1</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty">isempty</a></span> <span class="id">N2</span>) <span class="id">eqn</span>:<span class="id">E2</span>. <span class="id">elim</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty_1">isempty_1</a></span> <span class="id">n2</span> <span class="id">N2</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H</span>; <span class="id">destruct</span> <span class="id">H0</span>; <span class="id">split</span>; <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.add_1">Zinf.add_1</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">replace</span> (- (<span class="id">n1</span> + <span class="id">n2</span>)) <span class="kwd">with</span> ((-<span class="id">n1</span>) + (-<span class="id">n2</span>)) <span class="kwd">by</span> <span class="id">lia</span>. <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.add_1">Zinf.add_1</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Intervals.opp">opp</a></span> (<span class="id">v</span>: <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span>) : <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span> := {| <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">v</span>; <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> <span class="id">v</span> |}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Intervals.opp_1">opp_1</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">v</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n</span> <span class="id">v</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> (-<span class="id">n</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.opp">opp</a></span> <span class="id">v</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof51')">Proof.</span></div>
<div class="proofscript" id="proof51">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.opp">opp</a></span>; <span class="id">intros</span>; <span class="id">cbn</span>. <span class="id">replace</span> (- - <span class="id">n</span>) <span class="kwd">with</span> <span class="id">n</span> <span class="kwd">by</span> <span class="id">lia</span>. <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Intervals.sub">sub</a></span> (<span class="id">N1</span> <span class="id">N2</span>: <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span>) : <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.add">add</a></span> <span class="id">N1</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.opp">opp</a></span> <span class="id">N2</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Intervals.sub_1">sub_1</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n1</span> <span class="id">n2</span> <span class="id">N1</span> <span class="id">N2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n1</span> <span class="id">N1</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n2</span> <span class="id">N2</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> (<span class="id">n1</span> - <span class="id">n2</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.sub">sub</a></span> <span class="id">N1</span> <span class="id">N2</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof52')">Proof.</span></div>
<div class="proofscript" id="proof52">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.add_1">add_1</a></span>; <span class="id">auto</span>. <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.opp_1">opp_1</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc"><span class="bracket"><span class="id">meet</span></span> computes a lower bound for its two arguments.</div>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Intervals.meet">meet</a></span> (<span class="id">N1</span> <span class="id">N2</span>: <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span>) : <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.min">Zinf.min</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> <span class="id">N1</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> <span class="id">N2</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.min">Zinf.min</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">N1</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">N2</span>) |}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Intervals.meet_1">meet_1</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">N1</span> <span class="id">N2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n</span> <span class="id">N1</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n</span> <span class="id">N2</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.meet">meet</a></span> <span class="id">N1</span> <span class="id">N2</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof53')">Proof.</span></div>
<div class="proofscript" id="proof53">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.meet">meet</a></span>; <span class="id">intros</span>; <span class="id">cbn</span>. <span class="id">split</span>; <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.min_1">Zinf.min_1</a></span>; <span class="id">tauto</span>. <br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc"><span class="bracket"><span class="id">isIn</span></span> tests whether a concrete value belongs to an abstract value. </div>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Intervals.isIn">isIn</a></span> (<span class="id">n</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">v</span>: <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.isIn">Zinf.isIn</a></span> <span class="id">n</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">v</span>) &amp;&amp; <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.isIn">Zinf.isIn</a></span> (-<span class="id">n</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> <span class="id">v</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Intervals.isIn_1">isIn_1</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">v</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n</span> <span class="id">v</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isIn">isIn</a></span> <span class="id">n</span> <span class="id">v</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof54')">Proof.</span></div>
<div class="proofscript" id="proof54">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isIn">isIn</a></span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#andb_true_intro">andb_true_intro</a></span>; <span class="id">split</span>; <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.isIn_1">Zinf.isIn_1</a></span>; <span class="id">tauto</span>. <br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">Abstract operators for inverse analysis of comparisons. </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Intervals.eq_inv">eq_inv</a></span> (<span class="id">N1</span> <span class="id">N2</span>: <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span>) : <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span> * <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span> := (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.meet">meet</a></span> <span class="id">N1</span> <span class="id">N2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.meet">meet</a></span> <span class="id">N1</span> <span class="id">N2</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Intervals.eq_inv_1">eq_inv_1</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n1</span> <span class="id">n2</span> <span class="id">a1</span> <span class="id">a2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n1</span> <span class="id">a1</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n2</span> <span class="id">a2</span> -&gt; <span class="id">n1</span> = <span class="id">n2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n1</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.eq_inv">eq_inv</a></span> <span class="id">a1</span> <span class="id">a2</span>)) /\ <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n2</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.eq_inv">eq_inv</a></span> <span class="id">a1</span> <span class="id">a2</span>)).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof55')">Proof.</span></div>
<div class="proofscript" id="proof55">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">cbn</span>. <span class="id">subst</span> <span class="id">n2</span>. <span class="id">split</span>; <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.meet_1">meet_1</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Intervals.ne_inv">ne_inv</a></span> (<span class="id">N1</span> <span class="id">N2</span>: <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span>) : <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span> * <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span> := (<span class="id">N1</span>, <span class="id">N2</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Intervals.ne_inv_1">ne_inv_1</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n1</span> <span class="id">n2</span> <span class="id">a1</span> <span class="id">a2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n1</span> <span class="id">a1</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n2</span> <span class="id">a2</span> -&gt; <span class="id">n1</span> &lt;&gt; <span class="id">n2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n1</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.ne_inv">ne_inv</a></span> <span class="id">a1</span> <span class="id">a2</span>)) /\ <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n2</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.ne_inv">ne_inv</a></span> <span class="id">a1</span> <span class="id">a2</span>)).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof56')">Proof.</span></div>
<div class="proofscript" id="proof56">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">cbn</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">For the <span class="bracket">&lt;=</span> comparison, the upper bound of <span class="bracket"><span class="id">N1</span></span> is at most that of <span class="bracket"><span class="id">N2</span></span>,
    and the lower bound of <span class="bracket"><span class="id">N2</span></span> is at least that of <span class="bracket"><span class="id">N1</span></span>. </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Intervals.le_inv">le_inv</a></span> (<span class="id">N1</span> <span class="id">N2</span>: <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span>) : <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span> * <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;( {| <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> <span class="id">N1</span>; <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.min">Zinf.min</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">N1</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">N2</span>) |},<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.min">Zinf.min</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> <span class="id">N1</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> <span class="id">N2</span>); <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">N2</span> |} ).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Intervals.le_inv_1">le_inv_1</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n1</span> <span class="id">n2</span> <span class="id">a1</span> <span class="id">a2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n1</span> <span class="id">a1</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n2</span> <span class="id">a2</span> -&gt; <span class="id">n1</span> &lt;= <span class="id">n2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n1</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.le_inv">le_inv</a></span> <span class="id">a1</span> <span class="id">a2</span>)) /\ <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n2</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.le_inv">le_inv</a></span> <span class="id">a1</span> <span class="id">a2</span>)).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof57')">Proof.</span></div>
<div class="proofscript" id="proof57">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.le_inv">le_inv</a></span>; <span class="id">intros</span>; <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intuition</span> <span class="id">auto</span>; <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.min_1">Zinf.min_1</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In_mono">Zinf.In_mono</a></span> <span class="kwd">with</span> <span class="id">n2</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In_mono">Zinf.In_mono</a></span> <span class="kwd">with</span> (-<span class="id">n1</span>); <span class="id">auto</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">For the <span class="bracket">&gt;</span> comparison, the upper bound of <span class="bracket"><span class="id">N1</span></span> is at least that of <span class="bracket"><span class="id">N2</span></span>,
    and the lower bound of <span class="bracket"><span class="id">N2</span></span> is at most that of <span class="bracket"><span class="id">N1</span></span> - 1. </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Intervals.gt_inv">gt_inv</a></span> (<span class="id">N1</span> <span class="id">N2</span>: <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span>) : <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span> * <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;( {| <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.min">Zinf.min</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> <span class="id">N1</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.pred">Zinf.pred</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> <span class="id">N2</span>)); <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">N1</span> |},<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> <span class="id">N2</span>; <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.min">Zinf.min</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">N2</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.pred">Zinf.pred</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">N1</span>)) |} ).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Intervals.gt_inv_1">gt_inv_1</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n1</span> <span class="id">n2</span> <span class="id">a1</span> <span class="id">a2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n1</span> <span class="id">a1</span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n2</span> <span class="id">a2</span> -&gt; <span class="id">n1</span> &gt; <span class="id">n2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n1</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.gt_inv">gt_inv</a></span> <span class="id">a1</span> <span class="id">a2</span>)) /\ <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span> <span class="id">n2</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.gt_inv">gt_inv</a></span> <span class="id">a1</span> <span class="id">a2</span>)).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof58')">Proof.</span></div>
<div class="proofscript" id="proof58">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.In">In</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.gt_inv">gt_inv</a></span>; <span class="id">intros</span>; <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intuition</span> <span class="id">auto</span>; <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.min_1">Zinf.min_1</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In_mono">Zinf.In_mono</a></span> <span class="kwd">with</span> ((-<span class="id">n2</span>) - 1). <span class="id">lia</span>. <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.pred_1">Zinf.pred_1</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.In_mono">Zinf.In_mono</a></span> <span class="kwd">with</span> (<span class="id">n1</span> - 1). <span class="id">lia</span>. <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.pred_1">Zinf.pred_1</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">The widening operator. </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Intervals.widen">widen</a></span> (<span class="id">N1</span> <span class="id">N2</span>: <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span>) : <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty">isempty</a></span> <span class="id">N1</span> <span class="kwd">then</span> <span class="id">N2</span> <span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty">isempty</a></span> <span class="id">N2</span> <span class="kwd">then</span> <span class="id">N1</span> <span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.widen">Zinf.widen</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> <span class="id">N1</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> <span class="id">N2</span>); <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.widen">Zinf.widen</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">N1</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">N2</span>) |}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Intervals.widen_1">widen_1</a></span>: <span class="kwd">forall</span> <span class="id">N1</span> <span class="id">N2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.le">le</a></span> <span class="id">N1</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.widen">widen</a></span> <span class="id">N1</span> <span class="id">N2</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof59')">Proof.</span></div>
<div class="proofscript" id="proof59">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.le">le</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.widen">widen</a></span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty">isempty</a></span> <span class="id">N1</span>) <span class="id">eqn</span>:<span class="id">E1</span>. <span class="id">elim</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty_1">isempty_1</a></span> <span class="id">n</span> <span class="id">N1</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty">isempty</a></span> <span class="id">N2</span>) <span class="id">eqn</span>:<span class="id">E2</span>. <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H</span>. <span class="id">split</span>; <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.widen_1">Zinf.widen_1</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Intervals.measure">measure</a></span> (<span class="id">v</span>: <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.t">t</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty">isempty</a></span> <span class="id">v</span> <span class="kwd">then</span> 3%<span class="id">nat</span> <span class="kwd">else</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.measure">Zinf.measure</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> <span class="id">v</span>) + <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.measure">Zinf.measure</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">v</span>))%<span class="id">nat</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Intervals.measure_top">measure_top</a></span>: <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.measure">measure</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.top">top</a></span> = 0%<span class="id">nat</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof60')">Proof.</span></div>
<div class="proofscript" id="proof60">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Remark</span> <span class="id"><a name="Intervals.isempty_widen">isempty_widen</a></span>: <span class="kwd">forall</span> <span class="id">N1</span> <span class="id">N2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty">isempty</a></span> <span class="id">N1</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty">isempty</a></span> <span class="id">N2</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt; <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty">isempty</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.widen">widen</a></span> <span class="id">N1</span> <span class="id">N2</span>) = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof61')">Proof.</span></div>
<div class="proofscript" id="proof61">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty">isempty</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.widen">widen</a></span> <span class="id">N1</span> <span class="id">N2</span>)) <span class="id">eqn</span>:<span class="id">E</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty_2">isempty_2</a></span> <span class="id">_</span> <span class="id">H</span>) <span class="kwd">as</span> (<span class="id">n1</span> &amp; <span class="id">IN1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">elim</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty_1">isempty_1</a></span> <span class="id">n1</span> <span class="id">_</span> <span class="id">E</span>). <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.widen_1">widen_1</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Intervals.widen_2">widen_2</a></span>: <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">N1</span> <span class="id">N2</span>, (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.measure">measure</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.widen">widen</a></span> <span class="id">N1</span> <span class="id">N2</span>) &lt;= (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.measure">measure</a></span> <span class="id">N1</span>))%<span class="id">nat</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof62')">Proof.</span></div>
<div class="proofscript" id="proof62">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.measure">measure</a></span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty">isempty</a></span> <span class="id">N1</span>) <span class="id">eqn</span>:<span class="id">E1</span>. <span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.widen">widen</a></span>; <span class="id">rewrite</span> <span class="id">E1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.measure_1">Zinf.measure_1</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> <span class="id">N2</span>)) (<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.measure_1">Zinf.measure_1</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">N2</span>)); <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty">isempty</a></span> <span class="id">N2</span>); <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty">isempty</a></span> <span class="id">N2</span>) <span class="id">eqn</span>:<span class="id">E2</span>. <span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.widen">widen</a></span>; <span class="id">rewrite</span> <span class="id">E1</span>, <span class="id">E2</span>, <span class="id">E1</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty_widen">isempty_widen</a></span> <span class="kwd">by</span> <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.widen">widen</a></span>; <span class="id">rewrite</span> <span class="id">E1</span>, <span class="id">E2</span>; <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.widen_2">Zinf.widen_2</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> <span class="id">N1</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> <span class="id">N2</span>)) (<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.widen_2">Zinf.widen_2</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">N1</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">N2</span>)). <span class="id">lia</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Intervals.widen_3">widen_3</a></span>: <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">N1</span> <span class="id">N2</span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.ble">ble</a></span> <span class="id">N2</span> <span class="id">N1</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt; (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.measure">measure</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.widen">widen</a></span> <span class="id">N1</span> <span class="id">N2</span>) &lt; <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.measure">measure</a></span> <span class="id">N1</span>)%<span class="id">nat</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof63')">Proof.</span></div>
<div class="proofscript" id="proof63">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.ble">ble</a></span>, <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.measure">measure</a></span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty">isempty</a></span> <span class="id">N2</span>) <span class="id">eqn</span>:<span class="id">E2</span>. <span class="id">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty">isempty</a></span> <span class="id">N1</span>) <span class="id">eqn</span>:<span class="id">E1</span>.<br/>
&nbsp;&nbsp;- <span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.widen">widen</a></span>; <span class="id">rewrite</span> <span class="id">E1</span>, <span class="id">E2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.measure_1">Zinf.measure_1</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> <span class="id">N2</span>)) (<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.measure_1">Zinf.measure_1</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">N2</span>)). <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.isempty_widen">isempty_widen</a></span> <span class="kwd">by</span> <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals.widen">widen</a></span>; <span class="id">rewrite</span> <span class="id">E1</span>, <span class="id">E2</span>. <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.widen_2">Zinf.widen_2</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> <span class="id">N1</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.low">low</a></span> <span class="id">N2</span>)) (<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.widen_2">Zinf.widen_2</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">N1</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">N2</span>)); <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.AbstrInterp2.html#Zinf.ble">Zinf.ble</a></span> (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">N2</span>) (<span class="id"><a href="CDF.AbstrInterp2.html#Intervals.high">high</a></span> <span class="id">N1</span>)) <span class="id">eqn</span>:<span class="id">LE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">cbn</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.widen_3">Zinf.widen_3</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="CDF.AbstrInterp2.html#Zinf.widen_3">Zinf.widen_3</a></span> <span class="kwd">in</span> <span class="id">LE</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.AbstrInterp2.html#Intervals">Intervals</a></span>.<br/>
<br/>
<h2> 5.9.  Application: an interval analysis for IMP </h2>
<br/>
<div class="doc">We instantiate the generic analyzer with the domain of intervals. </div>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="SIntervals">SIntervals</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#StoreAbstr">StoreAbstr</a></span>(<span class="id"><a href="CDF.AbstrInterp2.html#Intervals">Intervals</a></span>).<br/>
<span class="kwd">Module</span> <span class="id"><a name="AIntervals">AIntervals</a></span> := <span class="id"><a href="CDF.AbstrInterp2.html#Analysis">Analysis</a></span>(<span class="id"><a href="CDF.AbstrInterp2.html#SIntervals">SIntervals</a></span>).<br/>
<br/>
<div class="doc">First program:
<pre>
    x := 0; y := 100; z := x + y;
    while x &lt;= 10 do x := x + 1; y := y - 1 end</pre>
</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="prog1">prog1</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> "<span class="id">x</span>" (<span class="id"><a href="CDF.IMP.html#CONST">CONST</a></span> 0) ;;<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> "<span class="id">y</span>" (<span class="id"><a href="CDF.IMP.html#CONST">CONST</a></span> 100) ;;<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> "<span class="id">z</span>" (<span class="id"><a href="CDF.IMP.html#PLUS">PLUS</a></span> (<span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> "<span class="id">x</span>") (<span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> "<span class="id">y</span>")) ;;<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> (<span class="id"><a href="CDF.IMP.html#LESSEQUAL">LESSEQUAL</a></span> (<span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> "<span class="id">x</span>") (<span class="id"><a href="CDF.IMP.html#CONST">CONST</a></span> 10))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> "<span class="id">x</span>" (<span class="id"><a href="CDF.IMP.html#PLUS">PLUS</a></span> (<span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> "<span class="id">x</span>") (<span class="id"><a href="CDF.IMP.html#CONST">CONST</a></span> 1)) ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> "<span class="id">y</span>" (<span class="id"><a href="CDF.IMP.html#MINUS">MINUS</a></span> (<span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> "<span class="id">y</span>") (<span class="id"><a href="CDF.IMP.html#CONST">CONST</a></span> 1))).<br/>
<br/>
<span class="kwd">Compute</span> (<span class="kwd">let</span> <span class="id">S</span> := <span class="id"><a href="CDF.AbstrInterp2.html#Cexec">AIntervals.Cexec</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#prog1">prog1</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#top">SIntervals.top</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CDF.AbstrInterp2.html#get">SIntervals.get</a></span> "<span class="id">x</span>" <span class="id">S</span>, <span class="id"><a href="CDF.AbstrInterp2.html#get">SIntervals.get</a></span> "<span class="id">y</span>" <span class="id">S</span>, <span class="id"><a href="CDF.AbstrInterp2.html#get">SIntervals.get</a></span> "<span class="id">z</span>" <span class="id">S</span>)).<br/>
<br/>
<div class="doc">Analysis result:
<pre>
      ({| Intervals.low := -11; Intervals.high := 11 |},
       {| Intervals.low := Inf; Intervals.high := 100 |},
       {| Intervals.low := -100; Intervals.high := 100 |})</pre>
In other words: <span class="bracket"><span class="id">x</span></span> is in <span class="bracket">[11,11]</span>, <span class="bracket"><span class="id">y</span></span> in <span class="bracket">[-<span class="id">inf</span>,100]</span>, and <span class="bracket"><span class="id">z</span></span> in <span class="bracket">[100,100]</span>.
</div>
<br/>
<div class="doc">Second program:
<pre>
    x := 0; y := 0;
    while x &lt;= 1000 do y := x; x := x + 1 end</pre>
</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="prog2">prog2</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> "<span class="id">x</span>" (<span class="id"><a href="CDF.IMP.html#CONST">CONST</a></span> 0) ;;<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> "<span class="id">y</span>" (<span class="id"><a href="CDF.IMP.html#CONST">CONST</a></span> 0) ;;<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> (<span class="id"><a href="CDF.IMP.html#LESSEQUAL">LESSEQUAL</a></span> (<span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> "<span class="id">x</span>") (<span class="id"><a href="CDF.IMP.html#CONST">CONST</a></span> 1000))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> "<span class="id">y</span>" (<span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> "<span class="id">x</span>") ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> "<span class="id">x</span>" (<span class="id"><a href="CDF.IMP.html#PLUS">PLUS</a></span> (<span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> "<span class="id">x</span>") (<span class="id"><a href="CDF.IMP.html#CONST">CONST</a></span> 1))).<br/>
<br/>
<span class="kwd">Compute</span> (<span class="kwd">let</span> <span class="id">S</span> := <span class="id"><a href="CDF.AbstrInterp2.html#Cexec">AIntervals.Cexec</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#prog2">prog2</a></span> <span class="id"><a href="CDF.AbstrInterp2.html#top">SIntervals.top</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CDF.AbstrInterp2.html#get">SIntervals.get</a></span> "<span class="id">x</span>" <span class="id">S</span>, <span class="id"><a href="CDF.AbstrInterp2.html#get">SIntervals.get</a></span> "<span class="id">y</span>" <span class="id">S</span>)).<br/>
<br/>
<div class="doc">Analysis result:
<pre>
      ({| Intervals.low := -1001; Intervals.high := 1001 |},
       {| Intervals.low := 0; Intervals.high := 1000 |})</pre>
In other words: <span class="bracket"><span class="id">x</span></span> is in <span class="bracket">[1001,1001]</span>, and <span class="bracket"><span class="id">y</span></span> in <span class="bracket">[0,1000]</span>.
</div>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
