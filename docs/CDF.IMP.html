
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module IMP</title>
<meta name="description" content="Documentation of Coq module IMP" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module IMP</h1>
<div class="coq">
<span class="kwd">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Arith.html">Arith</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.ZArith.html">ZArith</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.micromega.Psatz.html">Psatz</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html">Bool</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html">String</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html">List</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Program.Equality.html">Program.Equality</a></span>.<br/>
<span class="kwd">From</span> <span class="id">CDF</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="CDF.Sequences.html">Sequences</a></span> <span class="id"><a href="CDF.Simulation.html">Simulation</a></span>.<br/>
<br/>
<span class="id">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">string_scope</span>.<br/>
<span class="id">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">Z_scope</span>.<br/>
<span class="id">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">list_scope</span>.<br/>
<br/>
<h1> 1.  The IMP language </h1>
<br/>
<h2> 1.1 Arithmetic expressions </h2>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="ident">ident</a></span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string">string</a></span>.<br/>
<br/>
<div class="doc">The abstract syntax: an arithmetic expression is either... </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="aexp">aexp</a></span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="CONST">CONST</a></span> (<span class="id">n</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>)                       <span class="docright">(* a constant, or  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="VAR">VAR</a></span> (<span class="id">x</span>: <span class="id"><a href="CDF.IMP.html#ident">ident</a></span>)                     <span class="docright">(* a variable, or  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="PLUS">PLUS</a></span> (<span class="id">a1</span>: <span class="id">aexp</span>) (<span class="id">a2</span>: <span class="id">aexp</span>)         <span class="docright">(* a sum of two expressions, or  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="MINUS">MINUS</a></span> (<span class="id">a1</span>: <span class="id">aexp</span>) (<span class="id">a2</span>: <span class="id">aexp</span>).       <span class="docright">(* a difference of two expressions  *)</span><br/>
<br/>
<div class="doc">The denotational semantics: an evaluation function that computes
  the integer value denoted by an expression.  This function is
  parameterized by a store <span class="bracket"><span class="id">s</span></span> that associates values to variables. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="store">store</a></span> : <span class="kwd">Type</span> := <span class="id"><a href="CDF.IMP.html#ident">ident</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="aeval">aeval</a></span> (<span class="id">a</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>) (<span class="id">s</span>: <span class="id"><a href="CDF.IMP.html#store">store</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">a</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#CONST">CONST</a></span> <span class="id">n</span> =&gt; <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> <span class="id">x</span> =&gt; <span class="id">s</span> <span class="id">x</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#PLUS">PLUS</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt; <span class="id">aeval</span> <span class="id">a1</span> <span class="id">s</span> + <span class="id">aeval</span> <span class="id">a2</span> <span class="id">s</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#MINUS">MINUS</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt; <span class="id">aeval</span> <span class="id">a1</span> <span class="id">s</span> - <span class="id">aeval</span> <span class="id">a2</span> <span class="id">s</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Such evaluation functions / denotational semantics have many uses.
    First, we can use <span class="bracket"><span class="id">aeval</span></span> to evaluate a given expression in a given store. </div>
<br/>
<span class="kwd">Eval</span> <span class="id">compute</span> <span class="kwd">in</span> (<span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> (<span class="id"><a href="CDF.IMP.html#PLUS">PLUS</a></span> (<span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> "<span class="id">x</span>") (<span class="id"><a href="CDF.IMP.html#MINUS">MINUS</a></span> (<span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> "<span class="id">x</span>") (<span class="id"><a href="CDF.IMP.html#CONST">CONST</a></span> 1)))  (<span class="kwd">fun</span> <span class="id">x</span> =&gt; 2)).<br/>
<br/>
<div class="doc">Result: <span class="bracket"> = 3 : <span class="id">Z</span> </span>. </div>
<br/>
<div class="doc">We can also do partial evaluation with respect to an unknown store </div>
<br/>
<span class="kwd">Eval</span> <span class="id">cbn</span> <span class="kwd">in</span> (<span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> (<span class="id"><a href="CDF.IMP.html#PLUS">PLUS</a></span> (<span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> "<span class="id">x</span>") (<span class="id"><a href="CDF.IMP.html#MINUS">MINUS</a></span> (<span class="id"><a href="CDF.IMP.html#CONST">CONST</a></span> 10) (<span class="id"><a href="CDF.IMP.html#CONST">CONST</a></span> 1)))).<br/>
<br/>
<div class="doc">Result: <span class="bracket"> = <span class="kwd">fun</span> <span class="id">s</span> : <span class="id">store</span> =&gt; <span class="id">s</span> "<span class="id">x</span>" + 9 </span>. </div>
<br/>
<div class="doc">We can prove mathematical properties of a given expression. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="aeval_xplus1">aeval_xplus1</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">x</span>, <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> (<span class="id"><a href="CDF.IMP.html#PLUS">PLUS</a></span> (<span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> <span class="id">x</span>) (<span class="id"><a href="CDF.IMP.html#CONST">CONST</a></span> 1)) <span class="id">s</span> &gt; <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> (<span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> <span class="id">x</span>) <span class="id">s</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof1')">Proof.</span></div>
<div class="proofscript" id="proof1">
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">cbn</span>. <span class="id">lia</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Finally, we can prove "meta-properties" that hold for all expressions.
  For example: the value of an expression depends only on the values of its
  free variables.
  Free variables are defined by this recursive predicate:
</div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="free_in_aexp">free_in_aexp</a></span> (<span class="id">x</span>: <span class="id"><a href="CDF.IMP.html#ident">ident</a></span>) (<span class="id">a</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">a</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#CONST">CONST</a></span> <span class="id">n</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> <span class="id">y</span> =&gt; <span class="id">y</span> = <span class="id">x</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#PLUS">PLUS</a></span> <span class="id">a1</span> <span class="id">a2</span> | <span class="id"><a href="CDF.IMP.html#MINUS">MINUS</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt; <span class="id">free_in_aexp</span> <span class="id">x</span> <span class="id">a1</span> \/ <span class="id">free_in_aexp</span> <span class="id">x</span> <span class="id">a2</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="aeval_free">aeval_free</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="CDF.IMP.html#free_in_aexp">free_in_aexp</a></span> <span class="id">x</span> <span class="id">a</span> -&gt; <span class="id">s1</span> <span class="id">x</span> = <span class="id">s2</span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a</span> <span class="id">s1</span> = <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a</span> <span class="id">s2</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof2')">Proof.</span></div>
<div class="proofscript" id="proof2">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">a</span>; <span class="id">cbn</span>; <span class="id">intros</span> <span class="id">SAMEFREE</span>.<br/>
- <span class="comment">(*&nbsp;Case&nbsp;a&nbsp;=&nbsp;CONST&nbsp;n&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;Case&nbsp;a&nbsp;=&nbsp;VAR&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">SAMEFREE</span>. <span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;Case&nbsp;a&nbsp;=&nbsp;PLUS&nbsp;a1&nbsp;a2&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">IHa1</span>, <span class="id">IHa2</span>; <span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;Case&nbsp;a&nbsp;=&nbsp;MINUS&nbsp;a1&nbsp;a2&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">IHa1</span>, <span class="id">IHa2</span>; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<h2> 1.2.  Growing the language of arithmetic expressions </h2>
<br/>
<div class="doc">We can enrich the language with new operators in several ways.
    The simplest way is to define derived forms in terms of existing operators.
    For example, the "opposite" operator is: </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="OPP">OPP</a></span> (<span class="id">a</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>) : <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span> := <span class="id"><a href="CDF.IMP.html#MINUS">MINUS</a></span> (<span class="id"><a href="CDF.IMP.html#CONST">CONST</a></span> 0) <span class="id">a</span>.<br/>
<br/>
<div class="doc">Its semantics is the one we expect. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="aeval_OPP">aeval_OPP</a></span>: <span class="kwd">forall</span> <span class="id">s</span> <span class="id">a</span>, <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> (<span class="id"><a href="CDF.IMP.html#OPP">OPP</a></span> <span class="id">a</span>) <span class="id">s</span> = - (<span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a</span> <span class="id">s</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof3')">Proof.</span></div>
<div class="proofscript" id="proof3">
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">cbn</span>. <span class="id">lia</span>.<br/>
Qed.</div>
<br/>
<div class="doc">In other cases, we must add constructors to the <span class="bracket"><span class="id">aexp</span></span> type
    and cases to the <span class="bracket"><span class="id">aeval</span></span> function.  For example, let's add multiplication.
</div>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="AExp_mul">AExp_mul</a></span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="AExp_mul.aexp">aexp</a></span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="AExp_mul.CONST">CONST</a></span> (<span class="id">n</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="AExp_mul.VAR">VAR</a></span> (<span class="id">x</span>: <span class="id"><a href="CDF.IMP.html#ident">ident</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="AExp_mul.PLUS">PLUS</a></span> (<span class="id">a1</span>: <span class="id">aexp</span>) (<span class="id">a2</span>: <span class="id">aexp</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="AExp_mul.MINUS">MINUS</a></span> (<span class="id">a1</span>: <span class="id">aexp</span>) (<span class="id">a2</span>: <span class="id">aexp</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="AExp_mul.TIMES">TIMES</a></span> (<span class="id">a1</span>: <span class="id">aexp</span>) (<span class="id">a2</span>: <span class="id">aexp</span>).      <span class="docright">(* NEW!  *)</span><br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="AExp_mul.aeval">aeval</a></span> (<span class="id">a</span>: <span class="id"><a href="CDF.IMP.html#AExp_mul.aexp">aexp</a></span>) (<span class="id">s</span>: <span class="id"><a href="CDF.IMP.html#store">store</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">a</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#AExp_mul.CONST">CONST</a></span> <span class="id">n</span> =&gt; <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#AExp_mul.VAR">VAR</a></span> <span class="id">x</span> =&gt; <span class="id">s</span> <span class="id">x</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#AExp_mul.PLUS">PLUS</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt; <span class="id">aeval</span> <span class="id">a1</span> <span class="id">s</span> + <span class="id">aeval</span> <span class="id">a2</span> <span class="id">s</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#AExp_mul.MINUS">MINUS</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt; <span class="id">aeval</span> <span class="id">a1</span> <span class="id">s</span> - <span class="id">aeval</span> <span class="id">a2</span> <span class="id">s</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#AExp_mul.TIMES">TIMES</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt; <span class="id">aeval</span> <span class="id">a1</span> <span class="id">s</span> * <span class="id">aeval</span> <span class="id">a2</span> <span class="id">s</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.IMP.html#AExp_mul">AExp_mul</a></span>.<br/>
<br/>
<div class="doc">Why not add division as well? </div>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="AExp_div">AExp_div</a></span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="AExp_div.aexp">aexp</a></span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="AExp_div.CONST">CONST</a></span> (<span class="id">n</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="AExp_div.VAR">VAR</a></span> (<span class="id">x</span>: <span class="id"><a href="CDF.IMP.html#ident">ident</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="AExp_div.PLUS">PLUS</a></span> (<span class="id">a1</span>: <span class="id">aexp</span>) (<span class="id">a2</span>: <span class="id">aexp</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="AExp_div.MINUS">MINUS</a></span> (<span class="id">a1</span>: <span class="id">aexp</span>) (<span class="id">a2</span>: <span class="id">aexp</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="AExp_div.TIMES">TIMES</a></span> (<span class="id">a1</span>: <span class="id">aexp</span>) (<span class="id">a2</span>: <span class="id">aexp</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="AExp_div.QUOT">QUOT</a></span> (<span class="id">a1</span>: <span class="id">aexp</span>) (<span class="id">a2</span>: <span class="id">aexp</span>).    <span class="docright">(* NEW!  *)</span><br/>
<br/>
<div class="doc">We have a problem!  The evaluation of an expression can now fail,
  in case of a division by zero.  We must change the type of <span class="bracket"><span class="id">aeval</span></span>
  to reflect this error case: <span class="bracket"><span class="id">aeval</span></span> now returns an option type <span class="bracket"><span class="id">option</span> <span class="id">Z</span></span>.
  The result <span class="bracket"><span class="id">Some</span> <span class="id">n</span></span> means "no errors, and the value is <span class="bracket"><span class="id">n</span></span>".
  The result <span class="bracket"><span class="id">None</span></span> means "error during evaluation".
  Now that we know how to handle errors, we can make our semantics more
  realistic in other places:
  - variables can be uninitialized; using such a variable in an expression
    is a run-time error;
  - arithmetic operations can overflow the range of integers representable
    by a machine (e.g. 64-bit integers); this is a run-time error as well.
</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="AExp_div.min_int">min_int</a></span> := - (2 ^ 63).  <span class="docright">(* the smallest representable integer  *)</span><br/>
<span class="kwd">Definition</span> <span class="id"><a name="AExp_div.max_int">max_int</a></span> := 2 ^ 63 - 1.  <span class="docright">(* the greatest representable integer  *)</span><br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="AExp_div.check_for_overflow">check_for_overflow</a></span> (<span class="id">n</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>): <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> (<span class="id"><a href="CDF.IMP.html#AExp_div.min_int">min_int</a></span> &lt;=? <span class="id">n</span>) &amp;&amp; (<span class="id">n</span> &lt;=? <span class="id"><a href="CDF.IMP.html#AExp_div.max_int">max_int</a></span>) <span class="kwd">then</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">n</span> <span class="kwd">else</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="AExp_div.aeval">aeval</a></span> (<span class="id">s</span>: <span class="id"><a href="CDF.IMP.html#ident">ident</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">a</span>: <span class="id"><a href="CDF.IMP.html#AExp_div.aexp">aexp</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">a</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#AExp_div.CONST">CONST</a></span> <span class="id">n</span> =&gt; <span class="id"><a href="CDF.IMP.html#AExp_div.check_for_overflow">check_for_overflow</a></span> <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#AExp_div.VAR">VAR</a></span> <span class="id">x</span> =&gt; <span class="id">s</span> <span class="id">x</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#AExp_div.PLUS">PLUS</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">aeval</span> <span class="id">s</span> <span class="id">a1</span>, <span class="id">aeval</span> <span class="id">s</span> <span class="id">a2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">n1</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">n2</span> =&gt; <span class="id"><a href="CDF.IMP.html#AExp_div.check_for_overflow">check_for_overflow</a></span> (<span class="id">n1</span> + <span class="id">n2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#AExp_div.MINUS">MINUS</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">aeval</span> <span class="id">s</span> <span class="id">a1</span>, <span class="id">aeval</span> <span class="id">s</span> <span class="id">a2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">n1</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">n2</span> =&gt; <span class="id"><a href="CDF.IMP.html#AExp_div.check_for_overflow">check_for_overflow</a></span> (<span class="id">n1</span> - <span class="id">n2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#AExp_div.TIMES">TIMES</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">aeval</span> <span class="id">s</span> <span class="id">a1</span>, <span class="id">aeval</span> <span class="id">s</span> <span class="id">a2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">n1</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">n2</span> =&gt; <span class="id"><a href="CDF.IMP.html#AExp_div.check_for_overflow">check_for_overflow</a></span> (<span class="id">n1</span> * <span class="id">n2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#AExp_div.QUOT">QUOT</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">aeval</span> <span class="id">s</span> <span class="id">a1</span>, <span class="id">aeval</span> <span class="id">s</span> <span class="id">a2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">n1</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">n2</span> =&gt; <span class="kwd">if</span> <span class="id">n2</span> =? 0 <span class="kwd">then</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="kwd">else</span> <span class="id"><a href="CDF.IMP.html#AExp_div.check_for_overflow">check_for_overflow</a></span> (<span class="id">n1</span> / <span class="id">n2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.IMP.html#AExp_div">AExp_div</a></span>.<br/>
<br/>
<h2> 1.3 Boolean expressions </h2>
<br/>
<div class="doc">The IMP language has conditional statements (if/then/else) and
  loops.  They are controlled by expressions that evaluate to Boolean
  values.  Here is the abstract syntax of Boolean expressions. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="bexp">bexp</a></span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="TRUE">TRUE</a></span>                              <span class="docright">(* always true  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="FALSE">FALSE</a></span>                             <span class="docright">(* always false  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="EQUAL">EQUAL</a></span> (<span class="id">a1</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>) (<span class="id">a2</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>)       <span class="docright">(* whether <span class="bracket"><span class="id">a1</span> = <span class="id">a2</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="LESSEQUAL">LESSEQUAL</a></span> (<span class="id">a1</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>) (<span class="id">a2</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>)   <span class="docright">(* whether <span class="bracket"><span class="id">a1</span> &lt;= <span class="id">a2</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="NOT">NOT</a></span> (<span class="id">b1</span>: <span class="id">bexp</span>)                    <span class="docright">(* Boolean negation  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="AND">AND</a></span> (<span class="id">b1</span>: <span class="id">bexp</span>) (<span class="id">b2</span>: <span class="id">bexp</span>).        <span class="docright">(* Boolean conjunction  *)</span><br/>
<br/>
<div class="doc">Just like arithmetic expressions evaluate to integers,
  Boolean expressions evaluate to Boolean values <span class="bracket"><span class="id">true</span></span> or <span class="bracket"><span class="id">false</span></span>. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="beval">beval</a></span> (<span class="id">b</span>: <span class="id"><a href="CDF.IMP.html#bexp">bexp</a></span>) (<span class="id">s</span>: <span class="id"><a href="CDF.IMP.html#store">store</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">b</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#TRUE">TRUE</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#FALSE">FALSE</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#EQUAL">EQUAL</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt; <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a1</span> <span class="id">s</span> =? <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a2</span> <span class="id">s</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#LESSEQUAL">LESSEQUAL</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt; <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a1</span> <span class="id">s</span> &lt;=? <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a2</span> <span class="id">s</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#NOT">NOT</a></span> <span class="id">b1</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#negb">negb</a></span> (<span class="id">beval</span> <span class="id">b1</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#AND">AND</a></span> <span class="id">b1</span> <span class="id">b2</span> =&gt; <span class="id">beval</span> <span class="id">b1</span> <span class="id">s</span> &amp;&amp; <span class="id">beval</span> <span class="id">b2</span> <span class="id">s</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">There are many useful derived forms. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="NOTEQUAL">NOTEQUAL</a></span> (<span class="id">a1</span> <span class="id">a2</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>) : <span class="id"><a href="CDF.IMP.html#bexp">bexp</a></span> := <span class="id"><a href="CDF.IMP.html#NOT">NOT</a></span> (<span class="id"><a href="CDF.IMP.html#EQUAL">EQUAL</a></span> <span class="id">a1</span> <span class="id">a2</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="GREATEREQUAL">GREATEREQUAL</a></span> (<span class="id">a1</span> <span class="id">a2</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>) : <span class="id"><a href="CDF.IMP.html#bexp">bexp</a></span> := <span class="id"><a href="CDF.IMP.html#LESSEQUAL">LESSEQUAL</a></span> <span class="id">a2</span> <span class="id">a1</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="GREATER">GREATER</a></span> (<span class="id">a1</span> <span class="id">a2</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>) : <span class="id"><a href="CDF.IMP.html#bexp">bexp</a></span> := <span class="id"><a href="CDF.IMP.html#NOT">NOT</a></span> (<span class="id"><a href="CDF.IMP.html#LESSEQUAL">LESSEQUAL</a></span> <span class="id">a1</span> <span class="id">a2</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="LESS">LESS</a></span> (<span class="id">a1</span> <span class="id">a2</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>) : <span class="id"><a href="CDF.IMP.html#bexp">bexp</a></span> := <span class="id"><a href="CDF.IMP.html#GREATER">GREATER</a></span> <span class="id">a2</span> <span class="id">a1</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="OR">OR</a></span> (<span class="id">b1</span> <span class="id">b2</span>: <span class="id"><a href="CDF.IMP.html#bexp">bexp</a></span>) : <span class="id"><a href="CDF.IMP.html#bexp">bexp</a></span> := <span class="id"><a href="CDF.IMP.html#NOT">NOT</a></span> (<span class="id"><a href="CDF.IMP.html#AND">AND</a></span> (<span class="id"><a href="CDF.IMP.html#NOT">NOT</a></span> <span class="id">b1</span>) (<span class="id"><a href="CDF.IMP.html#NOT">NOT</a></span> <span class="id">b2</span>)).<br/>
<br/>
<h3> Exercise (1 star) </h3>
<div class="doc">Prove that the <span class="bracket"><span class="id">OR</span></span> derived form has the expected semantics. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="beval_OR">beval_OR</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">b1</span> <span class="id">b2</span>, <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> (<span class="id"><a href="CDF.IMP.html#OR">OR</a></span> <span class="id">b1</span> <span class="id">b2</span>) <span class="id">s</span> = <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b1</span> <span class="id">s</span> || <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b2</span> <span class="id">s</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof4')">Proof.</span></div>
<div class="proofscript" id="proof4">
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Hint:&nbsp;use&nbsp;"SearchAbout&nbsp;negb"&nbsp;to&nbsp;see&nbsp;the&nbsp;available&nbsp;lemmas<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;deal&nbsp;with&nbsp;Boolean&nbsp;negation.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Hint:&nbsp;or&nbsp;just&nbsp;do&nbsp;a&nbsp;case&nbsp;analysis&nbsp;on&nbsp;[beval&nbsp;b1&nbsp;s]&nbsp;and&nbsp;[beval&nbsp;b2&nbsp;s],<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;there&nbsp;are&nbsp;only&nbsp;4&nbsp;cases&nbsp;to&nbsp;consider.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/>
Abort.</div>
<br/>
<h2> 1.4 Commands </h2>
<br/>
<div class="doc">To complete the definition of the IMP language, here is the
  abstract syntax of commands, also known as statements. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="com">com</a></span>: <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="SKIP">SKIP</a></span>                                     <span class="docright">(* do nothing  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="ASSIGN">ASSIGN</a></span> (<span class="id">x</span>: <span class="id"><a href="CDF.IMP.html#ident">ident</a></span>) (<span class="id">a</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>)              <span class="docright">(* assignment: <span class="bracket"><span class="id">v</span> := <span class="id">a</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="SEQ">SEQ</a></span> (<span class="id">c1</span>: <span class="id">com</span>) (<span class="id">c2</span>: <span class="id">com</span>)                  <span class="docright">(* sequence: <span class="bracket"><span class="id">c1</span>; <span class="id">c2</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="IFTHENELSE">IFTHENELSE</a></span> (<span class="id">b</span>: <span class="id"><a href="CDF.IMP.html#bexp">bexp</a></span>) (<span class="id">c1</span>: <span class="id">com</span>) (<span class="id">c2</span>: <span class="id">com</span>) <span class="docright">(* conditional: <span class="bracket"><span class="kwd">if</span> <span class="id">b</span> <span class="kwd">then</span> <span class="id">c1</span> <span class="kwd">else</span> <span class="id">c2</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="WHILE">WHILE</a></span> (<span class="id">b</span>: <span class="id"><a href="CDF.IMP.html#bexp">bexp</a></span>) (<span class="id">c1</span>: <span class="id">com</span>).               <span class="docright">(* loop: <span class="bracket"><span class="id">while</span> <span class="id">b</span> <span class="id">do</span> <span class="id">c1</span> <span class="id">done</span></span>  *)</span><br/>
<br/>
<div class="doc">We can write <span class="bracket"><span class="id">c1</span> ;; <span class="id">c2</span></span> instead of <span class="bracket"><span class="id">SEQ</span> <span class="id">c1</span> <span class="id">c2</span></span>, it is easier on the eyes. </div>
<br/>
<span class="kwd">Infix</span> ";;" := <span class="id"><a href="CDF.IMP.html#SEQ">SEQ</a></span> (<span class="kwd">at</span> <span class="id">level</span> 80, <span class="id">right</span> <span class="id">associativity</span>).<br/>
<br/>
<div class="doc">Here is an IMP program that performs Euclidean division by
  repeated subtraction.  At the end of the program, "q" contains
  the quotient of "a" by "b", and "r" contains the remainder.
  In pseudocode:
<pre>
       r := a; q := 0;
       while b &lt;= r do r := r - b; q := q + 1 done</pre>
  In abstract syntax:
</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Euclidean_division">Euclidean_division</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> "<span class="id">r</span>" (<span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> "<span class="id">a</span>") ;;<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> "<span class="id">q</span>" (<span class="id"><a href="CDF.IMP.html#CONST">CONST</a></span> 0) ;;<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> (<span class="id"><a href="CDF.IMP.html#LESSEQUAL">LESSEQUAL</a></span> (<span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> "<span class="id">b</span>") (<span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> "<span class="id">r</span>"))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> "<span class="id">r</span>" (<span class="id"><a href="CDF.IMP.html#MINUS">MINUS</a></span> (<span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> "<span class="id">r</span>") (<span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> "<span class="id">b</span>")) ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> "<span class="id">q</span>" (<span class="id"><a href="CDF.IMP.html#PLUS">PLUS</a></span> (<span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> "<span class="id">q</span>") (<span class="id"><a href="CDF.IMP.html#CONST">CONST</a></span> 1))).<br/>
<br/>
<div class="doc">A useful operation over stores:
    <span class="bracket"><span class="id">update</span> <span class="id">x</span> <span class="id">v</span> <span class="id">s</span></span> is the store that maps <span class="bracket"><span class="id">x</span></span> to <span class="bracket"><span class="id">v</span></span> and is equal to <span class="bracket"><span class="id">s</span></span> for
    all variables other than <span class="bracket"><span class="id">x</span></span>. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="update">update</a></span> (<span class="id">x</span>: <span class="id"><a href="CDF.IMP.html#ident">ident</a></span>) (<span class="id">v</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">s</span>: <span class="id"><a href="CDF.IMP.html#store">store</a></span>) : <span class="id"><a href="CDF.IMP.html#store">store</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">y</span> =&gt; <span class="kwd">if</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x</span> <span class="id">y</span> <span class="kwd">then</span> <span class="id">v</span> <span class="kwd">else</span> <span class="id">s</span> <span class="id">y</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="update_same">update_same</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">v</span> <span class="id">s</span>, (<span class="id"><a href="CDF.IMP.html#update">update</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">s</span>) <span class="id">x</span> = <span class="id">v</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof5')">Proof.</span></div>
<div class="proofscript" id="proof5">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.IMP.html#update">update</a></span>; <span class="id">intros</span>. <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x</span> <span class="id">x</span>); <span class="id">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="update_other">update_other</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">v</span> <span class="id">s</span> <span class="id">y</span>, <span class="id">x</span> &lt;&gt; <span class="id">y</span> -&gt; (<span class="id"><a href="CDF.IMP.html#update">update</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">s</span>) <span class="id">y</span> = <span class="id">s</span> <span class="id">y</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof6')">Proof.</span></div>
<div class="proofscript" id="proof6">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.IMP.html#update">update</a></span>; <span class="id">intros</span>. <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x</span> <span class="id">y</span>); <span class="id">congruence</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Naively, we would like to define the semantics of a command with
    an execution function <span class="bracket"><span class="id">cexec</span> <span class="id">s</span> <span class="id">c</span></span> that runs the command <span class="bracket"><span class="id">c</span></span>
    in initial store <span class="bracket"><span class="id">s</span></span> and returns the final store when <span class="bracket"><span class="id">c</span></span> terminates. </div>
<br/>
<span class="kwd">Fail</span> <span class="kwd">Fixpoint</span> <span class="id"><a name="cexec">cexec</a></span> (<span class="id">c</span>: <span class="id"><a href="CDF.IMP.html#com">com</a></span>) (<span class="id">s</span>: <span class="id"><a href="CDF.IMP.html#store">store</a></span>) : <span class="id"><a href="CDF.IMP.html#store">store</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span> =&gt; <span class="id">s</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span> =&gt; <span class="id"><a href="CDF.IMP.html#update">update</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a</span> <span class="id">s</span>) <span class="id">s</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#SEQ">SEQ</a></span> <span class="id">c1</span> <span class="id">c2</span> =&gt; <span class="kwd">let</span> <span class="id">s</span>' := <span class="id">cexec</span> <span class="id">c1</span> <span class="id">s</span> <span class="kwd">in</span> <span class="id">cexec</span> <span class="id">c2</span> <span class="id">s</span>'<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> =&gt; <span class="kwd">if</span> <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> <span class="kwd">then</span> <span class="id">cexec</span> <span class="id">c1</span> <span class="id">s</span> <span class="kwd">else</span> <span class="id">cexec</span> <span class="id">c2</span> <span class="id">s</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> (<span class="kwd">let</span> <span class="id">s</span>' := <span class="id">cexec</span> <span class="id">c1</span> <span class="id">s</span> <span class="kwd">in</span> <span class="id">cexec</span> (<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c1</span>) <span class="id">s</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">s</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">The definition above is rejected by Coq, and rightly so, because
  all Coq functions must terminate, yet the <span class="bracket"><span class="id">WHILE</span></span> case may not
  terminate.  Consider for example the infinite loop
  <span class="bracket"><span class="id">WHILE</span> <span class="id">TRUE</span> <span class="id">SKIP</span></span>.
  Let's attempt a different style of semantics, based on sequences
  of reductions.
</div>
<br/>
<h2> 1.5.  Reduction semantics </h2>
<br/>
<div class="doc">The relation <span class="bracket"> <span class="id">red</span> (<span class="id">c</span>, <span class="id">s</span>) (<span class="id">c</span>', <span class="id">s</span>') </span> defines a basic reduction,
    that is, the first computation step when executing command <span class="bracket"><span class="id">c</span></span>
    in initial memory state <span class="bracket"><span class="id">s</span></span>.
    <span class="bracket"><span class="id">s</span>'</span> is the memory state "after" this computation step.
    <span class="bracket"><span class="id">c</span>'</span> is a command that represent all the computations that remain
    to be performed later.
    The reduction relation is presented as a Coq inductive predicate,
    with one case (one "constructor") for each reduction rule.
</div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="red">red</a></span>: <span class="id"><a href="CDF.IMP.html#com">com</a></span> * <span class="id"><a href="CDF.IMP.html#store">store</a></span> -&gt; <span class="id"><a href="CDF.IMP.html#com">com</a></span> * <span class="id"><a href="CDF.IMP.html#store">store</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_assign">red_assign</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">a</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> (<span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span>, <span class="id">s</span>) (<span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span>, <span class="id"><a href="CDF.IMP.html#update">update</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a</span> <span class="id">s</span>) <span class="id">s</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_seq_done">red_seq_done</a></span>: <span class="kwd">forall</span> <span class="id">c</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> (<span class="id"><a href="CDF.IMP.html#SEQ">SEQ</a></span> <span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span> <span class="id">c</span>, <span class="id">s</span>) (<span class="id">c</span>, <span class="id">s</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_seq_step">red_seq_step</a></span>: <span class="kwd">forall</span> <span class="id">c1</span> <span class="id">c</span> <span class="id">s1</span> <span class="id">c2</span> <span class="id">s2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> (<span class="id">c1</span>, <span class="id">s1</span>) (<span class="id">c2</span>, <span class="id">s2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> (<span class="id"><a href="CDF.IMP.html#SEQ">SEQ</a></span> <span class="id">c1</span> <span class="id">c</span>, <span class="id">s1</span>) (<span class="id"><a href="CDF.IMP.html#SEQ">SEQ</a></span> <span class="id">c2</span> <span class="id">c</span>, <span class="id">s2</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_ifthenelse">red_ifthenelse</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> (<span class="id"><a href="CDF.IMP.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span>, <span class="id">s</span>) ((<span class="kwd">if</span> <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> <span class="kwd">then</span> <span class="id">c1</span> <span class="kwd">else</span> <span class="id">c2</span>), <span class="id">s</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_while_done">red_while_done</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">c</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> (<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>, <span class="id">s</span>) (<span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span>, <span class="id">s</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_while_loop">red_while_loop</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">c</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> (<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>, <span class="id">s</span>) (<span class="id"><a href="CDF.IMP.html#SEQ">SEQ</a></span> <span class="id">c</span> (<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>), <span class="id">s</span>).<br/>
<br/>
<div class="doc">An interesting property of this reduction relation is that it is
    functional: a configuration <span class="bracket">(<span class="id">c</span>,<span class="id">s</span>)</span> reduces to at most one configuration.
    This corresponds to the fact that IMP is a deterministic language. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="red_determ">red_determ</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">cs</span> <span class="id">cs1</span>, <span class="id"><a href="CDF.IMP.html#red">red</a></span> <span class="id">cs</span> <span class="id">cs1</span> -&gt; <span class="kwd">forall</span> <span class="id">cs2</span>, <span class="id"><a href="CDF.IMP.html#red">red</a></span> <span class="id">cs</span> <span class="id">cs2</span> -&gt; <span class="id">cs1</span> = <span class="id">cs2</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof7')">Proof.</span></div>
<div class="proofscript" id="proof7">
&nbsp;&nbsp;<span class="id">induction</span> 1; <span class="id">intros</span> <span class="id">cs2</span> <span class="id">R2</span>; <span class="id">inversion</span> <span class="id">R2</span>; <span class="id">subst</span>; <span class="id">eauto</span>.<br/>
- <span class="id">inversion</span> <span class="id">H3</span>.<br/>
- <span class="id">inversion</span> <span class="id">H</span>.<br/>
- <span class="id">assert</span> (<span class="id">EQ</span>: (<span class="id">c2</span>, <span class="id">s2</span>) = (<span class="id">c4</span>, <span class="id">s3</span>)) <span class="kwd">by</span> <span class="id">auto</span>. <span class="id">congruence</span>.<br/>
- <span class="id">congruence</span>.<br/>
- <span class="id">congruence</span>.<br/>
Qed.</div>
<br/>
<div class="doc">We define the semantics of a command by chaining successive reductions.
    The command <span class="bracket"><span class="id">c</span></span> in initial state <span class="bracket"><span class="id">s</span></span> terminates with final state <span class="bracket"><span class="id">s</span>'</span>
    if we can go from <span class="bracket">(<span class="id">c</span>, <span class="id">s</span>)</span> to <span class="bracket">(<span class="id">skip</span>, <span class="id">s</span>')</span> in a finite number of reductions.
</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="terminates">terminates</a></span> (<span class="id">s</span>: <span class="id"><a href="CDF.IMP.html#store">store</a></span>) (<span class="id">c</span>: <span class="id"><a href="CDF.IMP.html#com">com</a></span>) (<span class="id">s</span>': <span class="id"><a href="CDF.IMP.html#store">store</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Sequences.html#star">star</a></span> <span class="id"><a href="CDF.IMP.html#red">red</a></span> (<span class="id">c</span>, <span class="id">s</span>) (<span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span>, <span class="id">s</span>').<br/>
<br/>
<div class="doc">The <span class="bracket"><span class="id">star</span></span> operator is defined in library <span class="bracket"><span class="id">Sequences</span></span>.
    <span class="bracket"><span class="id">star</span> <span class="id">R</span></span> is the reflexive transitive closure of relation <span class="bracket"><span class="id">R</span></span>.
    On paper it is often written <span class="bracket"><span class="id">R</span>*</span>.
    The <span class="bracket"><span class="id">star</span> <span class="id">red</span></span> relation therefore represents zero, one or several
    reduction steps. </div>
<br/>
<div class="doc">Likewise, command <span class="bracket"><span class="id">c</span></span> diverges (fails to terminate) in initial state <span class="bracket"><span class="id">s</span></span>
    if there exists an infinite sequence of reductions starting with <span class="bracket">(<span class="id">c</span>, <span class="id">s</span>)</span>.
    The <span class="bracket"><span class="id">infseq</span></span> relation operator is defined in library <span class="bracket"><span class="id">Sequences</span></span>.
</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="diverges">diverges</a></span> (<span class="id">s</span>: <span class="id"><a href="CDF.IMP.html#store">store</a></span>) (<span class="id">c</span>: <span class="id"><a href="CDF.IMP.html#com">com</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Sequences.html#infseq">infseq</a></span> <span class="id"><a href="CDF.IMP.html#red">red</a></span> (<span class="id">c</span>, <span class="id">s</span>).<br/>
<br/>
<div class="doc">Generally speaking, a third kind of executions is possible:
    "going wrong" after a finite number of reductions.
   A configuration <span class="bracket">(<span class="id">c</span>', <span class="id">s</span>')</span> "goes wrong" if it cannot reduce and is
   not a final configuration, that is, <span class="bracket"><span class="id">c</span>' &lt;&gt; <span class="id">SKIP</span></span>. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="goes_wrong">goes_wrong</a></span> (<span class="id">s</span>: <span class="id"><a href="CDF.IMP.html#store">store</a></span>) (<span class="id">c</span>: <span class="id"><a href="CDF.IMP.html#com">com</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">c</span>', <span class="kwd">exists</span> <span class="id">s</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Sequences.html#star">star</a></span> <span class="id"><a href="CDF.IMP.html#red">red</a></span> (<span class="id">c</span>, <span class="id">s</span>) (<span class="id">c</span>', <span class="id">s</span>') /\ <span class="id"><a href="CDF.Sequences.html#irred">irred</a></span> <span class="id"><a href="CDF.IMP.html#red">red</a></span> (<span class="id">c</span>', <span class="id">s</span>') /\ <span class="id">c</span>' &lt;&gt; <span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span>.<br/>
<br/>
<h3> Exercise (2 stars) </h3>
<div class="doc">Prove that IMP command never go wrong.
    Hint: first show the following "progress" property, showing that
    a command other than <span class="bracket"><span class="id">SKIP</span></span> can always reduce. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="red_progress">red_progress</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">s</span>, <span class="id">c</span> = <span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span> \/ <span class="kwd">exists</span> <span class="id">c</span>', <span class="kwd">exists</span> <span class="id">s</span>', <span class="id"><a href="CDF.IMP.html#red">red</a></span> (<span class="id">c</span>, <span class="id">s</span>) (<span class="id">c</span>', <span class="id">s</span>').<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof8')">Proof.</span></div>
<div class="proofscript" id="proof8">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">c</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/>
Abort.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="not_goes_wrong">not_goes_wrong</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">s</span>, ~(<span class="id"><a href="CDF.IMP.html#goes_wrong">goes_wrong</a></span> <span class="id">s</span> <span class="id">c</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof9')">Proof.</span></div>
<div class="proofscript" id="proof9">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">c</span> <span class="id">s</span> (<span class="id">c</span>' &amp; <span class="id">s</span>' &amp; <span class="id">STAR</span> &amp; <span class="id">IRRED</span> &amp; <span class="id">NOTSKIP</span>).<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/>
Abort.</div>
<br/>
<div class="doc">A technical lemma: a sequence of reductions can take place to the left
    of a <span class="bracket"><span class="id">SEQ</span></span> constructor.  This generalizes rule <span class="bracket"><span class="id">red_seq_step</span></span>. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="red_seq_steps">red_seq_steps</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c2</span> <span class="id">s</span> <span class="id">c</span> <span class="id">s</span>' <span class="id">c</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Sequences.html#star">star</a></span> <span class="id"><a href="CDF.IMP.html#red">red</a></span> (<span class="id">c</span>, <span class="id">s</span>) (<span class="id">c</span>', <span class="id">s</span>') -&gt; <span class="id"><a href="CDF.Sequences.html#star">star</a></span> <span class="id"><a href="CDF.IMP.html#red">red</a></span> ((<span class="id">c</span>;;<span class="id">c2</span>), <span class="id">s</span>) ((<span class="id">c</span>';;<span class="id">c2</span>), <span class="id">s</span>').<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof10')">Proof.</span></div>
<div class="proofscript" id="proof10">
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">dependent</span> <span class="id">induction</span> <span class="id">H</span>.<br/>
- <span class="id">apply</span> <span class="id"><a href="CDF.Sequences.html#star_refl">star_refl</a></span>.<br/>
- <span class="id">destruct</span> <span class="id">b</span> <span class="kwd">as</span> [<span class="id">c1</span> <span class="id">st1</span>].<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.Sequences.html#star_step">star_step</a></span> <span class="kwd">with</span> (<span class="id">c1</span>;;<span class="id">c2</span>, <span class="id">st1</span>). <span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#red_seq_step">red_seq_step</a></span>. <span class="id">auto</span>. <span class="id">auto</span>.  <br/>
Qed.</div>
<br/>
<h2> 1.6.  Natural semantics </h2>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="cexec">cexec</a></span>: <span class="id"><a href="CDF.IMP.html#store">store</a></span> -&gt; <span class="id"><a href="CDF.IMP.html#com">com</a></span> -&gt; <span class="id"><a href="CDF.IMP.html#store">store</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="cexec_skip">cexec_skip</a></span>: <span class="kwd">forall</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cexec</span> <span class="id">s</span> <span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span> <span class="id">s</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="cexec_assign">cexec_assign</a></span>: <span class="kwd">forall</span> <span class="id">s</span> <span class="id">x</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cexec</span> <span class="id">s</span> (<span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span>) (<span class="id"><a href="CDF.IMP.html#update">update</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a</span> <span class="id">s</span>) <span class="id">s</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="cexec_seq">cexec_seq</a></span>: <span class="kwd">forall</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">s</span> <span class="id">s</span>' <span class="id">s</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cexec</span> <span class="id">s</span> <span class="id">c1</span> <span class="id">s</span>' -&gt; <span class="id">cexec</span> <span class="id">s</span>' <span class="id">c2</span> <span class="id">s</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cexec</span> <span class="id">s</span> (<span class="id"><a href="CDF.IMP.html#SEQ">SEQ</a></span> <span class="id">c1</span> <span class="id">c2</span>) <span class="id">s</span>''<br/>
&nbsp;&nbsp;| <span class="id"><a name="cexec_ifthenelse">cexec_ifthenelse</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">s</span> <span class="id">s</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cexec</span> <span class="id">s</span> (<span class="kwd">if</span> <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> <span class="kwd">then</span> <span class="id">c1</span> <span class="kwd">else</span> <span class="id">c2</span>) <span class="id">s</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cexec</span> <span class="id">s</span> (<span class="id"><a href="CDF.IMP.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span>) <span class="id">s</span>'<br/>
&nbsp;&nbsp;| <span class="id"><a name="cexec_while_done">cexec_while_done</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">c</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cexec</span> <span class="id">s</span> (<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>) <span class="id">s</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="cexec_while_loop">cexec_while_loop</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">c</span> <span class="id">s</span> <span class="id">s</span>' <span class="id">s</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id">cexec</span> <span class="id">s</span> <span class="id">c</span> <span class="id">s</span>' -&gt; <span class="id">cexec</span> <span class="id">s</span>' (<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>) <span class="id">s</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cexec</span> <span class="id">s</span> (<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>) <span class="id">s</span>''.<br/>
<br/>
<div class="doc">The predicate <span class="bracket"><span class="id">cexec</span> <span class="id">s</span> <span class="id">c</span> <span class="id">s</span>'</span> holds iff there exists a finite derivation
    for this conclusion, using the axioms and inference rules above.
    The structure of this derivation represents the computations performed
    by <span class="bracket"><span class="id">c</span></span> as a tree --- not as a sequence of reductions.
    The finiteness of the derivation guarantees that only terminating executions
    satisfy <span class="bracket"><span class="id">cexec</span></span>.  As an example, <span class="bracket"><span class="id">WHILE</span> <span class="id">TRUE</span> <span class="id">SKIP</span></span> does not satisfy <span class="bracket"><span class="id">cexec</span></span>.
</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="cexec_infinite_loop">cexec_infinite_loop</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span>, ~ <span class="kwd">exists</span> <span class="id">s</span>', <span class="id"><a href="CDF.IMP.html#cexec">cexec</a></span> <span class="id">s</span> (<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id"><a href="CDF.IMP.html#TRUE">TRUE</a></span> <span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span>) <span class="id">s</span>'.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof11')">Proof.</span></div>
<div class="proofscript" id="proof11">
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">A</span>: <span class="kwd">forall</span> <span class="id">s</span> <span class="id">c</span> <span class="id">s</span>', <span class="id"><a href="CDF.IMP.html#cexec">cexec</a></span> <span class="id">s</span> <span class="id">c</span> <span class="id">s</span>' -&gt; <span class="id">c</span> = <span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id"><a href="CDF.IMP.html#TRUE">TRUE</a></span> <span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span>).<br/>
&nbsp;&nbsp;{ <span class="id">induction</span> 1; <span class="id">intros</span> <span class="id">EQ</span>; <span class="id">inversion</span> <span class="id">EQ</span>.<br/>
&nbsp;&nbsp;- <span class="id">subst</span> <span class="id">b</span> <span class="id">c</span>. <span class="id">cbn</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">discriminate</span>.<br/>
&nbsp;&nbsp;- <span class="id">subst</span> <span class="id">b</span> <span class="id">c</span>. <span class="id">apply</span> <span class="id">IHcexec2</span>. <span class="id">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">s</span> (<span class="id">s</span>' &amp; <span class="id">EXEC</span>). <span class="id">apply</span> <span class="id">A</span> <span class="kwd">with</span> (<span class="id">s</span> := <span class="id">s</span>) (<span class="id">c</span> := <span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id"><a href="CDF.IMP.html#TRUE">TRUE</a></span> <span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span>) (<span class="id">s</span>' := <span class="id">s</span>'); <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">We now show an equivalence between evaluations that terminate according
    to the natural semantics
        (existence of a derivation of <span class="bracket"><span class="id">cexec</span> <span class="id">s</span> <span class="id">c</span> <span class="id">s</span>'</span>)
    and to the reduction semantics
        (existence of a reduction sequence from <span class="bracket">(<span class="id">c</span>,<span class="id">s</span>)</span> to <span class="bracket">(<span class="id">SKIP</span>, <span class="id">s</span>')</span>.
    We start with the natural semantics =&gt; reduction sequence direction,
    which is proved by an elegant induction on the derivation of <span class="bracket"><span class="id">cexec</span></span>. </div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="cexec_to_reds">cexec_to_reds</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">c</span> <span class="id">s</span>', <span class="id"><a href="CDF.IMP.html#cexec">cexec</a></span> <span class="id">s</span> <span class="id">c</span> <span class="id">s</span>' -&gt; <span class="id"><a href="CDF.Sequences.html#star">star</a></span> <span class="id"><a href="CDF.IMP.html#red">red</a></span> (<span class="id">c</span>, <span class="id">s</span>) (<span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span>, <span class="id">s</span>').<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof12')">Proof.</span></div>
<div class="proofscript" id="proof12">
&nbsp;&nbsp;<span class="id">induction</span> 1.<br/>
- <span class="comment">(*&nbsp;SKIP&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.Sequences.html#star_refl">star_refl</a></span>.<br/>
- <span class="comment">(*&nbsp;ASSIGN&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.Sequences.html#star_one">star_one</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#red_assign">red_assign</a></span>. <br/>
- <span class="comment">(*&nbsp;SEQ&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="CDF.Sequences.html#star_trans">star_trans</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#red_seq_steps">red_seq_steps</a></span>. <span class="id">apply</span> <span class="id">IHcexec1</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="CDF.Sequences.html#star_step">star_step</a></span>.  <span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#red_seq_done">red_seq_done</a></span>.  <span class="id">apply</span> <span class="id">IHcexec2</span>.<br/>
- <span class="comment">(*&nbsp;IFTHENELSE&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="CDF.Sequences.html#star_step">star_step</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#red_ifthenelse">red_ifthenelse</a></span>. <span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;WHILE&nbsp;stop&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.Sequences.html#star_one">star_one</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#red_while_done">red_while_done</a></span>. <span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;WHILE&nbsp;loop&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="CDF.Sequences.html#star_step">star_step</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#red_while_loop">red_while_loop</a></span>. <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="CDF.Sequences.html#star_trans">star_trans</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#red_seq_steps">red_seq_steps</a></span>. <span class="id">apply</span> <span class="id">IHcexec1</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="CDF.Sequences.html#star_step">star_step</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#red_seq_done">red_seq_done</a></span>. <span class="id">apply</span> <span class="id">IHcexec2</span>.<br/>
Qed.</div>
<br/>
<div class="doc">The other direction, from a reduction sequence to a <span class="bracket"><span class="id">cexec</span></span>
    derivation, is more subtle.  Here is the key lemma, showing how a
    reduction step followed by a <span class="bracket"><span class="id">cexec</span></span> execution can combine into a
    <span class="bracket"><span class="id">cexec</span></span> execution. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="red_append_cexec">red_append_cexec</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c1</span> <span class="id">s1</span> <span class="id">c2</span> <span class="id">s2</span>, <span class="id"><a href="CDF.IMP.html#red">red</a></span> (<span class="id">c1</span>, <span class="id">s1</span>) (<span class="id">c2</span>, <span class="id">s2</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span>', <span class="id"><a href="CDF.IMP.html#cexec">cexec</a></span> <span class="id">s2</span> <span class="id">c2</span> <span class="id">s</span>' -&gt; <span class="id"><a href="CDF.IMP.html#cexec">cexec</a></span> <span class="id">s1</span> <span class="id">c1</span> <span class="id">s</span>'.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof13')">Proof.</span></div>
<div class="proofscript" id="proof13">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">until</span> <span class="id">s2</span>; <span class="id">intros</span> <span class="id">STEP</span>. <span class="id">dependent</span> <span class="id">induction</span> <span class="id">STEP</span>; <span class="id">intros</span>.<br/>
- <span class="comment">(*&nbsp;red_assign&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H</span>; <span class="id">subst</span>. <span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#cexec_assign">cexec_assign</a></span>. <br/>
- <span class="comment">(*&nbsp;red_seq_done&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#cexec_seq">cexec_seq</a></span> <span class="kwd">with</span> <span class="id">s2</span>. <span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#cexec_skip">cexec_skip</a></span>. <span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;red&nbsp;seq&nbsp;step&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H</span>; <span class="id">subst</span>. <span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#cexec_seq">cexec_seq</a></span> <span class="kwd">with</span> <span class="id">s</span>'0.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">IHSTEP</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;red_ifthenelse&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#cexec_ifthenelse">cexec_ifthenelse</a></span>. <span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;red_while_done&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H0</span>; <span class="id">subst</span>. <span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#cexec_while_done">cexec_while_done</a></span>. <span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;red&nbsp;while&nbsp;loop&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H0</span>; <span class="id">subst</span>. <span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#cexec_while_loop">cexec_while_loop</a></span> <span class="kwd">with</span> <span class="id">s</span>'0; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">By induction on the reduction sequence, it follows that a command
    that reduces to <span class="bracket"><span class="id">SKIP</span></span> executes according to the natural semantics,
    with the same final state. </div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="reds_to_cexec">reds_to_cexec</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">c</span> <span class="id">s</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Sequences.html#star">star</a></span> <span class="id"><a href="CDF.IMP.html#red">red</a></span> (<span class="id">c</span>, <span class="id">s</span>) (<span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span>, <span class="id">s</span>') -&gt; <span class="id"><a href="CDF.IMP.html#cexec">cexec</a></span> <span class="id">s</span> <span class="id">c</span> <span class="id">s</span>'.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof14')">Proof.</span></div>
<div class="proofscript" id="proof14">
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">dependent</span> <span class="id">induction</span> <span class="id">H</span>.<br/>
- <span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#cexec_skip">cexec_skip</a></span>.<br/>
- <span class="id">destruct</span> <span class="id">b</span> <span class="kwd">as</span> [<span class="id">c1</span> <span class="id">s1</span>]. <span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#red_append_cexec">red_append_cexec</a></span> <span class="kwd">with</span> <span class="id">c1</span> <span class="id">s1</span>; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<h2> 1.7.  Bounded interpreter </h2>
<br/>
<div class="doc">We found it impossible to define the semantics of commands as
    a Coq execution function.  However, we can define an approximation
    of such a function by bounding a priori the recursion depth,
    using an extra parameter <span class="bracket"><span class="id">fuel</span></span> of type <span class="bracket"><span class="id">nat</span></span>.
    The "fuel" is decremented by 1 at each recursive call.  If it drops
    to 0, execution returns <span class="bracket"><span class="id">None</span></span>, meaning that the final state at
    the end of the command execution could not be determined:
    either the command diverges, or more fuel is needed to execute it. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="cexec_f">cexec_f</a></span> (<span class="id">fuel</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) (<span class="id">s</span>: <span class="id"><a href="CDF.IMP.html#store">store</a></span>) (<span class="id">c</span>: <span class="id"><a href="CDF.IMP.html#com">com</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CDF.IMP.html#store">store</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">fuel</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#O">O</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">fuel</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="CDF.IMP.html#update">update</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a</span> <span class="id">s</span>) <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#SEQ">SEQ</a></span> <span class="id">c1</span> <span class="id">c2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">cexec_f</span> <span class="id">fuel</span>' <span class="id">s</span> <span class="id">c1</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>  =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">s</span>' =&gt; <span class="id">cexec_f</span> <span class="id">fuel</span>' <span class="id">s</span>' <span class="id">c2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cexec_f</span> <span class="id">fuel</span>' <span class="id">s</span> (<span class="kwd">if</span> <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> <span class="kwd">then</span> <span class="id">c1</span> <span class="kwd">else</span> <span class="id">c2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">cexec_f</span> <span class="id">fuel</span>' <span class="id">s</span> <span class="id">c1</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>  =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">s</span>' =&gt; <span class="id">cexec_f</span> <span class="id">fuel</span>' <span class="id">s</span>' (<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">This bounded execution function is very useful to compute the semantics
    of test programs.  For example, let's compute the quotient and the remainder
    of 14 divided by 3 using the IMP program for Euclidean division shown
    above. </div>
<br/>
<span class="kwd">Eval</span> <span class="id">compute</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;(<span class="kwd">let</span> <span class="id">s</span> := <span class="id"><a href="CDF.IMP.html#update">update</a></span> "<span class="id">a</span>" 14 (<span class="id"><a href="CDF.IMP.html#update">update</a></span> "<span class="id">b</span>" 3 (<span class="kwd">fun</span> <span class="id">_</span> =&gt; 0)) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="CDF.IMP.html#cexec_f">cexec_f</a></span> 100 <span class="id">s</span> <span class="id"><a href="CDF.IMP.html#Euclidean_division">Euclidean_division</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">s</span>' =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">s</span>' "<span class="id">q</span>", <span class="id">s</span>' "<span class="id">r</span>")<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>).<br/>
<br/>
<h3> Exercise (3 stars) </h3>
<br/>
<div class="doc">Show that function <span class="bracket"><span class="id">cexec_f</span></span> is sound with respect to the natural semantics
    <span class="bracket"><span class="id">cexec</span></span>, by proving the two following lemmas. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="cexec_f_sound">cexec_f_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fuel</span> <span class="id">s</span> <span class="id">c</span> <span class="id">s</span>', <span class="id"><a href="CDF.IMP.html#cexec_f">cexec_f</a></span> <span class="id">fuel</span> <span class="id">s</span> <span class="id">c</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">s</span>' -&gt; <span class="id"><a href="CDF.IMP.html#cexec">cexec</a></span> <span class="id">s</span> <span class="id">c</span> <span class="id">s</span>'.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof15')">Proof.</span></div>
<div class="proofscript" id="proof15">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">fuel</span> <span class="kwd">as</span> [ | <span class="id">fuel</span> ]; <span class="id">cbn</span>; <span class="id">intros</span>.<br/>
- <span class="id">discriminate</span>.<br/>
- <span class="id">destruct</span> <span class="id">c</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/>
Abort.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="cexec_f_complete">cexec_f_complete</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">c</span> <span class="id">s</span>', <span class="id"><a href="CDF.IMP.html#cexec">cexec</a></span> <span class="id">s</span> <span class="id">c</span> <span class="id">s</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">fuel1</span>, <span class="kwd">forall</span> <span class="id">fuel</span>, (<span class="id">fuel</span> &gt;= <span class="id">fuel1</span>)%<span class="id">nat</span> -&gt; <span class="id"><a href="CDF.IMP.html#cexec_f">cexec_f</a></span> <span class="id">fuel</span> <span class="id">s</span> <span class="id">c</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">s</span>'.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof16')">Proof.</span></div>
<div class="proofscript" id="proof16">
&nbsp;&nbsp;<span class="id">induction</span> 1.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/>
Abort.</div>
<br/>
<h2> 1.8.  Transition semantics with continuations </h2>
<br/>
<div class="doc">To help with the verification of a compiler (module <span class="bracket"><span class="id">Compil</span></span>),
    we now introduce another form of "small-step" semantics
    as an alternative to the reduction semantics.  In the new semantics,
    the command to be executed is explicitly decomposed into
    - a sub-command under focus, where computation takes place;
    - a context that describes the position of the sub-command in the
      whole command; or, equivalently, a continuation that describes
      the parts of the whole command that remain to execute once
      the sub-command terminates.
    Consequently, the semantics is presented as a transition relation
    between triples (sub-command under focus, continuation, state).
    Here is the syntax of continuations:
</div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="cont">cont</a></span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="Kstop">Kstop</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a name="Kseq">Kseq</a></span> (<span class="id">c</span>: <span class="id"><a href="CDF.IMP.html#com">com</a></span>) (<span class="id">k</span>: <span class="id">cont</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="Kwhile">Kwhile</a></span> (<span class="id">b</span>: <span class="id"><a href="CDF.IMP.html#bexp">bexp</a></span>) (<span class="id">c</span>: <span class="id"><a href="CDF.IMP.html#com">com</a></span>) (<span class="id">k</span>: <span class="id">cont</span>).<br/>
<br/>
<div class="doc">Intuitive meaning of these three constructors:
  - <span class="bracket"><span class="id">Kstop</span></span> means that nothing remains to be done once the sub-command
    terminates.  In other words, the sub-command under focus is the whole
    command.
  - <span class="bracket"><span class="id">Kseq</span> <span class="id">c</span> <span class="id">k</span></span> means that when the sub-command terminates, we will then
    execute the command <span class="bracket"><span class="id">c</span></span>, then continue as described by <span class="bracket"><span class="id">k</span></span>.
  - <span class="bracket"><span class="id">Kwhile</span> <span class="id">b</span> <span class="id">c</span> <span class="id">k</span></span> means that when the sub-command terminates, we will then
    execute the loop <span class="bracket"><span class="id">WHILE</span> <span class="id">b</span> <span class="id">DO</span> <span class="id">c</span> <span class="id">END</span></span>.  When this loop terminates,
    we will continue as described by <span class="bracket"><span class="id">k</span></span>.
</div>
<br/>
<div class="doc">Another way to form intuitions about continuations is to ponder
    the <span class="bracket"><span class="id">apply_cont</span> <span class="id">k</span> <span class="id">c</span></span> function below.  It takes the sub-command <span class="bracket"><span class="id">c</span></span>
    and the continuation <span class="bracket"><span class="id">k</span></span>, and rebuilds the whole command.  This is
    achieved quite simpl by inserting <span class="bracket"><span class="id">c</span></span> to the left of the nested
    <span class="bracket"><span class="id">SEQ</span></span> constructors described by <span class="bracket"><span class="id">k</span></span>. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="apply_cont">apply_cont</a></span> (<span class="id">k</span>: <span class="id"><a href="CDF.IMP.html#cont">cont</a></span>) (<span class="id">c</span>: <span class="id"><a href="CDF.IMP.html#com">com</a></span>) : <span class="id"><a href="CDF.IMP.html#com">com</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">k</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#Kstop">Kstop</a></span> =&gt; <span class="id">c</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#Kseq">Kseq</a></span> <span class="id">c1</span> <span class="id">k1</span> =&gt; <span class="id">apply_cont</span> <span class="id">k1</span> (<span class="id"><a href="CDF.IMP.html#SEQ">SEQ</a></span> <span class="id">c</span> <span class="id">c1</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#Kwhile">Kwhile</a></span> <span class="id">b1</span> <span class="id">c1</span> <span class="id">k1</span> =&gt; <span class="id">apply_cont</span> <span class="id">k1</span> (<span class="id"><a href="CDF.IMP.html#SEQ">SEQ</a></span> <span class="id">c</span> (<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b1</span> <span class="id">c1</span>))<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">The transitions between triples (sub-command, continuation, state)
    can be classified in three groups:
    - Computation steps: evaluate an arithmetic or Boolean expression,
      and modify the triple accordingly.
    - Focusing: replace the sub-command by a sub-sub-command that must
      be executed first, enriching the continuation accordingly.
    - Resumption: when the sub-command under focus is <span class="bracket"><span class="id">SKIP</span></span>, and therefore
      has terminated, examine the head of the continuation to find
      the next sub-command to focus on.
    Here are the transition rules, annotated by the groups to which they
    belong.
</div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="step">step</a></span>: <span class="id"><a href="CDF.IMP.html#com">com</a></span> * <span class="id"><a href="CDF.IMP.html#cont">cont</a></span> * <span class="id"><a href="CDF.IMP.html#store">store</a></span> -&gt; <span class="id"><a href="CDF.IMP.html#com">com</a></span> * <span class="id"><a href="CDF.IMP.html#cont">cont</a></span> * <span class="id"><a href="CDF.IMP.html#store">store</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
<br/>
&nbsp;&nbsp;| <span class="id"><a name="step_assign">step_assign</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">a</span> <span class="id">k</span> <span class="id">s</span>,              <span class="docright">(* computation  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">step</span> (<span class="id"><a href="CDF.IMP.html#ASSIGN">ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span>, <span class="id">k</span>, <span class="id">s</span>) (<span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span>, <span class="id">k</span>, <span class="id"><a href="CDF.IMP.html#update">update</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a</span> <span class="id">s</span>) <span class="id">s</span>)<br/>
<br/>
&nbsp;&nbsp;| <span class="id"><a name="step_seq">step_seq</a></span>: <span class="kwd">forall</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">s</span> <span class="id">k</span>,               <span class="docright">(* focusing  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">step</span> (<span class="id"><a href="CDF.IMP.html#SEQ">SEQ</a></span> <span class="id">c1</span> <span class="id">c2</span>, <span class="id">k</span>, <span class="id">s</span>) (<span class="id">c1</span>, <span class="id"><a href="CDF.IMP.html#Kseq">Kseq</a></span> <span class="id">c2</span> <span class="id">k</span>, <span class="id">s</span>)<br/>
<br/>
&nbsp;&nbsp;| <span class="id"><a name="step_ifthenelse">step_ifthenelse</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">k</span> <span class="id">s</span>,      <span class="docright">(* computation  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">step</span> (<span class="id"><a href="CDF.IMP.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span>, <span class="id">k</span>, <span class="id">s</span>) ((<span class="kwd">if</span> <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> <span class="kwd">then</span> <span class="id">c1</span> <span class="kwd">else</span> <span class="id">c2</span>), <span class="id">k</span>, <span class="id">s</span>)<br/>
<br/>
&nbsp;&nbsp;| <span class="id"><a name="step_while_done">step_while_done</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">c</span> <span class="id">k</span> <span class="id">s</span>,          <span class="docright">(* computation  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">step</span> (<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>, <span class="id">k</span>, <span class="id">s</span>) (<span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span>, <span class="id">k</span>, <span class="id">s</span>)<br/>
<br/>
&nbsp;&nbsp;| <span class="id"><a name="step_while_loop">step_while_loop</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">c</span> <span class="id">k</span> <span class="id">s</span>,          <span class="docright">(* computation + focusing  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">step</span> (<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>, <span class="id">k</span>, <span class="id">s</span>) (<span class="id">c</span>, <span class="id"><a href="CDF.IMP.html#Kwhile">Kwhile</a></span> <span class="id">b</span> <span class="id">c</span> <span class="id">k</span>, <span class="id">s</span>)<br/>
<br/>
&nbsp;&nbsp;| <span class="id"><a name="step_skip_seq">step_skip_seq</a></span>: <span class="kwd">forall</span> <span class="id">c</span> <span class="id">k</span> <span class="id">s</span>,              <span class="docright">(* resumption  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">step</span> (<span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span>, <span class="id"><a href="CDF.IMP.html#Kseq">Kseq</a></span> <span class="id">c</span> <span class="id">k</span>, <span class="id">s</span>) (<span class="id">c</span>, <span class="id">k</span>, <span class="id">s</span>)<br/>
<br/>
&nbsp;&nbsp;| <span class="id"><a name="step_skip_while">step_skip_while</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">c</span> <span class="id">k</span> <span class="id">s</span>,          <span class="docright">(* resumption  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">step</span> (<span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span>, <span class="id"><a href="CDF.IMP.html#Kwhile">Kwhile</a></span> <span class="id">b</span> <span class="id">c</span> <span class="id">k</span>, <span class="id">s</span>) (<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>, <span class="id">k</span>, <span class="id">s</span>).<br/>
<br/>
<div class="doc">As with every small-step semantics, we define termination and
    divergence in terms of transition sequences.
    Initial states are of the shape <span class="bracket">(<span class="id">c</span>, <span class="id">Kstop</span>, <span class="id">s_initial</span>)</span>
    and final states <span class="bracket">(<span class="id">SKIP</span>, <span class="id">Kstop</span>, <span class="id">s_final</span>)</span>.
</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="kterminates">kterminates</a></span> (<span class="id">s</span>: <span class="id"><a href="CDF.IMP.html#store">store</a></span>) (<span class="id">c</span>: <span class="id"><a href="CDF.IMP.html#com">com</a></span>) (<span class="id">s</span>': <span class="id"><a href="CDF.IMP.html#store">store</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Sequences.html#star">star</a></span> <span class="id"><a href="CDF.IMP.html#step">step</a></span> (<span class="id">c</span>, <span class="id"><a href="CDF.IMP.html#Kstop">Kstop</a></span>, <span class="id">s</span>) (<span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span>, <span class="id"><a href="CDF.IMP.html#Kstop">Kstop</a></span>, <span class="id">s</span>').<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="kdiverges">kdiverges</a></span> (<span class="id">s</span>: <span class="id"><a href="CDF.IMP.html#store">store</a></span>) (<span class="id">c</span>: <span class="id"><a href="CDF.IMP.html#com">com</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Sequences.html#infseq">infseq</a></span> <span class="id"><a href="CDF.IMP.html#step">step</a></span> (<span class="id">c</span>, <span class="id"><a href="CDF.IMP.html#Kstop">Kstop</a></span>, <span class="id">s</span>).<br/>
<br/>
<h3> Correspondence between continuation semantics and reduction semantics </h3>
<br/>
<div class="doc">To build confidence, we can prove that the two small-step semantics
    for IMP are equivalent: they agree on which commands terminate
    and which commands diverge.
    To prove this claim, we follow the approach based on simulation
    diagrams that we also use to prove the correctness of the IMP compiler
    (module <span class="bracket"><span class="id">Compil</span></span>).  This proof is fairly technical and can be skipped
    on first reading.
    
    Here is the relation between a configuration of the continuation semantics
    and a configuration of the reduction semantics.
</div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="match_conf">match_conf</a></span> : <span class="id"><a href="CDF.IMP.html#com">com</a></span> * <span class="id"><a href="CDF.IMP.html#cont">cont</a></span> * <span class="id"><a href="CDF.IMP.html#store">store</a></span> -&gt; <span class="id"><a href="CDF.IMP.html#com">com</a></span> * <span class="id"><a href="CDF.IMP.html#store">store</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="match_conf_intro">match_conf_intro</a></span>: <span class="kwd">forall</span> <span class="id">c</span> <span class="id">k</span> <span class="id">s</span> <span class="id">c</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">c</span>' = <span class="id"><a href="CDF.IMP.html#apply_cont">apply_cont</a></span> <span class="id">k</span> <span class="id">c</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_conf</span> (<span class="id">c</span>, <span class="id">k</span>, <span class="id">s</span>) (<span class="id">c</span>', <span class="id">s</span>).<br/>
<br/>
<div class="doc">We show that every transition of the continuation semantics
    is simulated by zero, one or several reduction steps.
    The anti-stuttering measure counts the nesting of <span class="bracket"><span class="id">SEQ</span></span> constructs
    in the command. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="num_seq">num_seq</a></span> (<span class="id">c</span>: <span class="id"><a href="CDF.IMP.html#com">com</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.IMP.html#SEQ">SEQ</a></span> <span class="id">c1</span> <span class="id">c2</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id">num_seq</span> <span class="id">c1</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#O">O</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="kmeasure">kmeasure</a></span> (<span class="id">C</span>: <span class="id"><a href="CDF.IMP.html#com">com</a></span> * <span class="id"><a href="CDF.IMP.html#cont">cont</a></span> * <span class="id"><a href="CDF.IMP.html#store">store</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> '(<span class="id">c</span>, <span class="id">k</span>, <span class="id">s</span>) := <span class="id">C</span> <span class="kwd">in</span> <span class="id"><a href="CDF.IMP.html#num_seq">num_seq</a></span> <span class="id">c</span>.<br/>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="red_apply_cont">red_apply_cont</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">k</span> <span class="id">c1</span> <span class="id">s1</span> <span class="id">c2</span> <span class="id">s2</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#red">red</a></span> (<span class="id">c1</span>, <span class="id">s1</span>) (<span class="id">c2</span>, <span class="id">s2</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#red">red</a></span> (<span class="id"><a href="CDF.IMP.html#apply_cont">apply_cont</a></span> <span class="id">k</span> <span class="id">c1</span>, <span class="id">s1</span>) (<span class="id"><a href="CDF.IMP.html#apply_cont">apply_cont</a></span> <span class="id">k</span> <span class="id">c2</span>, <span class="id">s2</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof17')">Proof.</span></div>
<div class="proofscript" id="proof17">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">k</span>; <span class="id">intros</span>; <span class="id">simpl</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.IMP.html#red_seq_step">red_seq_step</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="simulation_cont_red">simulation_cont_red</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">C1</span> <span class="id">C1</span>', <span class="id"><a href="CDF.IMP.html#step">step</a></span> <span class="id">C1</span> <span class="id">C1</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">C2</span>, <span class="id"><a href="CDF.IMP.html#match_conf">match_conf</a></span> <span class="id">C1</span> <span class="id">C2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">C2</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CDF.Sequences.html#plus">plus</a></span> <span class="id"><a href="CDF.IMP.html#red">red</a></span> <span class="id">C2</span> <span class="id">C2</span>' \/ (<span class="id"><a href="CDF.Sequences.html#star">star</a></span> <span class="id"><a href="CDF.IMP.html#red">red</a></span> <span class="id">C2</span> <span class="id">C2</span>' /\ <span class="id"><a href="CDF.IMP.html#kmeasure">kmeasure</a></span> <span class="id">C1</span>' &lt; <span class="id"><a href="CDF.IMP.html#kmeasure">kmeasure</a></span> <span class="id">C1</span>))%<span class="id">nat</span><br/>
&nbsp;&nbsp;/\ <span class="id"><a href="CDF.IMP.html#match_conf">match_conf</a></span> <span class="id">C1</span>' <span class="id">C2</span>'.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof18')">Proof.</span></div>
<div class="proofscript" id="proof18">
&nbsp;&nbsp;<span class="id">destruct</span> 1; <span class="id">intros</span> <span class="id">C2</span> <span class="id">MC</span>; <span class="id">inversion</span> <span class="id">MC</span>; <span class="id">subst</span>; <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;2: <span class="id">econstructor</span>; <span class="id">split</span>; [<span class="id">right</span>; <span class="id">split</span>; [<span class="id">apply</span> <span class="id"><a href="CDF.Sequences.html#star_refl">star_refl</a></span> | <span class="id">lia</span>] | <span class="id">constructor</span>; <span class="id">auto</span> ].<br/>
&nbsp;&nbsp;1-6: <span class="id">econstructor</span>; <span class="id">split</span>; [<span class="id">left</span>; <span class="id">apply</span> <span class="id"><a href="CDF.Sequences.html#plus_one">plus_one</a></span>; <span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#red_apply_cont">red_apply_cont</a></span>; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.IMP.html#red">red</a></span> | <span class="id">constructor</span>; <span class="id">auto</span>].<br/>
Qed.</div>
<br/>
<div class="doc">It follows that termination according to the continuation semantics
    implies termination according to the reduction semantics,
    and likewise for divergence. </div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="kterminates_terminates">kterminates_terminates</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">c</span> <span class="id">s</span>', <span class="id"><a href="CDF.IMP.html#kterminates">kterminates</a></span> <span class="id">s</span> <span class="id">c</span> <span class="id">s</span>' -&gt; <span class="id"><a href="CDF.IMP.html#terminates">terminates</a></span> <span class="id">s</span> <span class="id">c</span> <span class="id">s</span>'.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof19')">Proof.</span></div>
<div class="proofscript" id="proof19">
&nbsp;&nbsp;<span class="id">intros</span>. <br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.Simulation.html#simulation_star">simulation_star</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="CDF.IMP.html#simulation_cont_red">simulation_cont_red</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span> (<span class="id">c</span>, <span class="id">s</span>)) <span class="kwd">as</span> ((<span class="id">c</span>' &amp; <span class="id">s</span>'') &amp; <span class="id">STAR</span> &amp; <span class="id">INV</span>).<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">INV</span>; <span class="id">subst</span>. <span class="id">apply</span> <span class="id">STAR</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="kdiverges_diverges">kdiverges_diverges</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">c</span>, <span class="id"><a href="CDF.IMP.html#kdiverges">kdiverges</a></span> <span class="id">s</span> <span class="id">c</span> -&gt;  <span class="id"><a href="CDF.IMP.html#diverges">diverges</a></span> <span class="id">s</span> <span class="id">c</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof20')">Proof.</span></div>
<div class="proofscript" id="proof20">
&nbsp;&nbsp;<span class="id">intros</span>. <br/>
&nbsp;&nbsp;<span class="id">apply</span> (<span class="id"><a href="CDF.Simulation.html#simulation_infseq">simulation_infseq</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="CDF.IMP.html#simulation_cont_red">simulation_cont_red</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">The reverse implications follow from the symmetrical simulation diagram.
    First, we need a technical lemma on reductions of commands of the
    shape <span class="bracket"><span class="id">apply_cont</span> <span class="id">k</span> <span class="id">c</span></span>. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="red_apply_cont_cases">red_apply_cont_cases</a></span>: <span class="id"><a href="CDF.IMP.html#cont">cont</a></span> -&gt; <span class="id"><a href="CDF.IMP.html#com">com</a></span> -&gt; <span class="id"><a href="CDF.IMP.html#store">store</a></span> -&gt; <span class="id"><a href="CDF.IMP.html#com">com</a></span> -&gt; <span class="id"><a href="CDF.IMP.html#store">store</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="racc_base">racc_base</a></span>: <span class="kwd">forall</span> <span class="id">c1</span> <span class="id">s1</span> <span class="id">c2</span> <span class="id">s2</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#red">red</a></span> (<span class="id">c1</span>, <span class="id">s1</span>) (<span class="id">c2</span>, <span class="id">s2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red_apply_cont_cases</span> <span class="id">k</span> <span class="id">c1</span> <span class="id">s1</span> (<span class="id"><a href="CDF.IMP.html#apply_cont">apply_cont</a></span> <span class="id">k</span> <span class="id">c2</span>) <span class="id">s2</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="racc_skip_seq">racc_skip_seq</a></span>: <span class="kwd">forall</span> <span class="id">c</span> <span class="id">k</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red_apply_cont_cases</span> (<span class="id"><a href="CDF.IMP.html#Kseq">Kseq</a></span> <span class="id">c</span> <span class="id">k</span>) <span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span> <span class="id">s</span> (<span class="id"><a href="CDF.IMP.html#apply_cont">apply_cont</a></span> <span class="id">k</span> <span class="id">c</span>) <span class="id">s</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="racc_skip_while">racc_skip_while</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">c</span> <span class="id">k</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red_apply_cont_cases</span> (<span class="id"><a href="CDF.IMP.html#Kwhile">Kwhile</a></span> <span class="id">b</span> <span class="id">c</span> <span class="id">k</span>) <span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span> <span class="id">s</span> (<span class="id"><a href="CDF.IMP.html#apply_cont">apply_cont</a></span> <span class="id">k</span> (<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>)) <span class="id">s</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="invert_red_apply_cont">invert_red_apply_cont</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">k</span> <span class="id">c</span> <span class="id">s</span> <span class="id">c</span>' <span class="id">s</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#red">red</a></span> (<span class="id"><a href="CDF.IMP.html#apply_cont">apply_cont</a></span> <span class="id">k</span> <span class="id">c</span>, <span class="id">s</span>) (<span class="id">c</span>', <span class="id">s</span>') -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#red_apply_cont_cases">red_apply_cont_cases</a></span> <span class="id">k</span> <span class="id">c</span> <span class="id">s</span> <span class="id">c</span>' <span class="id">s</span>'.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof21')">Proof.</span></div>
<div class="proofscript" id="proof21">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">k</span>; <span class="id">simpl</span>; <span class="id">intros</span>. <br/>
- <span class="comment">(*&nbsp;Kstop&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">change</span> <span class="id">c</span>' <span class="kwd">with</span> (<span class="id"><a href="CDF.IMP.html#apply_cont">apply_cont</a></span> <span class="id"><a href="CDF.IMP.html#Kstop">Kstop</a></span> <span class="id">c</span>'). <span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#racc_base">racc_base</a></span>; <span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;Kseq&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHk</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>). <span class="id">inversion</span> <span class="id">IHk</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;base&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H0</span>; <span class="id">clear</span> <span class="id">H0</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;seq&nbsp;finish&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#racc_skip_seq">racc_skip_seq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;seq&nbsp;step&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="CDF.IMP.html#apply_cont">apply_cont</a></span> <span class="id">k</span> (<span class="id">c4</span>;;<span class="id">c</span>)) <span class="kwd">with</span> (<span class="id"><a href="CDF.IMP.html#apply_cont">apply_cont</a></span> (<span class="id"><a href="CDF.IMP.html#Kseq">Kseq</a></span> <span class="id">c</span> <span class="id">k</span>) <span class="id">c4</span>). <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#racc_base">racc_base</a></span>; <span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;Kwhile&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHk</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>). <span class="id">inversion</span> <span class="id">IHk</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H0</span>; <span class="id">clear</span> <span class="id">H0</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;seq&nbsp;finish&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#racc_skip_while">racc_skip_while</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;seq&nbsp;step&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="CDF.IMP.html#apply_cont">apply_cont</a></span> <span class="id">k</span> (<span class="id">c4</span>;;<span class="id"><a href="CDF.IMP.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>)) <span class="kwd">with</span> (<span class="id"><a href="CDF.IMP.html#apply_cont">apply_cont</a></span> (<span class="id"><a href="CDF.IMP.html#Kwhile">Kwhile</a></span> <span class="id">b</span> <span class="id">c</span> <span class="id">k</span>) <span class="id">c4</span>). <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#racc_base">racc_base</a></span>; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="rmeasure">rmeasure</a></span> (<span class="id">C</span>: <span class="id"><a href="CDF.IMP.html#com">com</a></span> * <span class="id"><a href="CDF.IMP.html#store">store</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#O">O</a></span>.   <span class="docright">(* there is no stuttering  *)</span><br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="simulation_red_cont">simulation_red_cont</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">C1</span> <span class="id">C1</span>', <span class="id"><a href="CDF.IMP.html#red">red</a></span> <span class="id">C1</span> <span class="id">C1</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">C2</span>, <span class="id"><a href="CDF.IMP.html#match_conf">match_conf</a></span> <span class="id">C2</span> <span class="id">C1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">C2</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CDF.Sequences.html#plus">plus</a></span> <span class="id"><a href="CDF.IMP.html#step">step</a></span> <span class="id">C2</span> <span class="id">C2</span>' \/ (<span class="id"><a href="CDF.Sequences.html#star">star</a></span> <span class="id"><a href="CDF.IMP.html#step">step</a></span> <span class="id">C2</span> <span class="id">C2</span>' /\ <span class="id"><a href="CDF.IMP.html#rmeasure">rmeasure</a></span> <span class="id">C1</span>' &lt; <span class="id"><a href="CDF.IMP.html#rmeasure">rmeasure</a></span> <span class="id">C1</span>))%<span class="id">nat</span><br/>
&nbsp;&nbsp;/\ <span class="id"><a href="CDF.IMP.html#match_conf">match_conf</a></span> <span class="id">C2</span>' <span class="id">C1</span>'.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof22')">Proof.</span></div>
<div class="proofscript" id="proof22">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">C1</span> <span class="id">C1</span>' <span class="id">R</span> <span class="id">C2</span> <span class="id">MC</span>. <span class="id">inversion</span> <span class="id">MC</span>; <span class="id">subst</span>. <span class="id">destruct</span> <span class="id">C1</span>' <span class="kwd">as</span> (<span class="id">c</span>' &amp; <span class="id">s</span>').<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">A</span>: <span class="id"><a href="CDF.IMP.html#red_apply_cont_cases">red_apply_cont_cases</a></span> <span class="id">k</span> <span class="id">c</span> <span class="id">s</span> <span class="id">c</span>' <span class="id">s</span>') <span class="kwd">by</span> (<span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#invert_red_apply_cont">invert_red_apply_cont</a></span>; <span class="id">auto</span>).<br/>
&nbsp;&nbsp;<span class="id">clear</span> <span class="id">MC</span> <span class="id">R</span>. <span class="id">inversion</span> <span class="id">A</span>; <span class="id">subst</span>; <span class="id">clear</span> <span class="id">A</span>.<br/>
- <span class="id">cut</span> (<span class="kwd">exists</span> <span class="id">C2</span>', <span class="id"><a href="CDF.Sequences.html#plus">plus</a></span> <span class="id"><a href="CDF.IMP.html#step">step</a></span> (<span class="id">c</span>, <span class="id">k</span>, <span class="id">s</span>) <span class="id">C2</span>' /\ <span class="id"><a href="CDF.IMP.html#match_conf">match_conf</a></span> <span class="id">C2</span>' (<span class="id"><a href="CDF.IMP.html#apply_cont">apply_cont</a></span> <span class="id">k</span> <span class="id">c2</span>, <span class="id">s</span>')).<br/>
&nbsp;&nbsp;<span class="id">intros</span> (<span class="id">C2</span>' &amp; <span class="id">A</span> &amp; <span class="id">B</span>). <span class="kwd">exists</span> <span class="id">C2</span>'; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">k</span>. <span class="id">dependent</span> <span class="id">induction</span> <span class="id">H</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;+ <span class="id">econstructor</span>; <span class="id">split</span>. <span class="id">apply</span> <span class="id"><a href="CDF.Sequences.html#plus_one">plus_one</a></span>; <span class="id">constructor</span>. <span class="id">constructor</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="id">econstructor</span>; <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="CDF.Sequences.html#plus_left">plus_left</a></span>. <span class="id">constructor</span>. <span class="id">eapply</span> <span class="id"><a href="CDF.Sequences.html#star_one">star_one</a></span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="id">edestruct</span> <span class="id">IHred</span> <span class="kwd">as</span> (((<span class="id">cx</span> &amp; <span class="id">kx</span>) &amp; <span class="id">sx</span>) &amp; <span class="id">A</span> &amp; <span class="id">B</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="CDF.Sequences.html#plus_left">plus_left</a></span>. <span class="id">constructor</span>. <span class="id">apply</span> <span class="id"><a href="CDF.Sequences.html#plus_star">plus_star</a></span>. <span class="id">eexact</span> <span class="id">A</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact</span> <span class="id">B</span>.<br/>
&nbsp;&nbsp;+ <span class="id">econstructor</span>; <span class="id">split</span>. <span class="id">apply</span> <span class="id"><a href="CDF.Sequences.html#plus_one">plus_one</a></span>; <span class="id">constructor</span>. <span class="id">constructor</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="id">econstructor</span>; <span class="id">split</span>. <span class="id">apply</span> <span class="id"><a href="CDF.Sequences.html#plus_one">plus_one</a></span>; <span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#step_while_done">step_while_done</a></span>; <span class="id">auto</span>. <span class="id">constructor</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="id">econstructor</span>; <span class="id">split</span>. <span class="id">apply</span> <span class="id"><a href="CDF.Sequences.html#plus_one">plus_one</a></span>; <span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#step_while_loop">step_while_loop</a></span>; <span class="id">auto</span>. <span class="id">constructor</span>; <span class="id">auto</span>.<br/>
- <span class="id">econstructor</span>; <span class="id">split</span>. <br/>
&nbsp;&nbsp;<span class="id">left</span>; <span class="id">apply</span> <span class="id"><a href="CDF.Sequences.html#plus_one">plus_one</a></span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">auto</span>.<br/>
- <span class="id">econstructor</span>; <span class="id">split</span>. <br/>
&nbsp;&nbsp;<span class="id">left</span>; <span class="id">apply</span> <span class="id"><a href="CDF.Sequences.html#plus_one">plus_one</a></span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_cont_is_skip">apply_cont_is_skip</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">k</span> <span class="id">c</span>, <span class="id"><a href="CDF.IMP.html#apply_cont">apply_cont</a></span> <span class="id">k</span> <span class="id">c</span> = <span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span> -&gt; <span class="id">k</span> = <span class="id"><a href="CDF.IMP.html#Kstop">Kstop</a></span> /\ <span class="id">c</span> = <span class="id"><a href="CDF.IMP.html#SKIP">SKIP</a></span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof23')">Proof.</span></div>
<div class="proofscript" id="proof23">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">k</span>; <span class="id">cbn</span>; <span class="id">intros</span>.<br/>
- <span class="id">auto</span>.<br/>
- <span class="id">apply</span> <span class="id">IHk</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">intuition</span> <span class="id">discriminate</span>.<br/>
- <span class="id">apply</span> <span class="id">IHk</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">intuition</span> <span class="id">discriminate</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="terminates_kterminates">terminates_kterminates</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">c</span> <span class="id">s</span>', <span class="id"><a href="CDF.IMP.html#terminates">terminates</a></span> <span class="id">s</span> <span class="id">c</span> <span class="id">s</span>' -&gt; <span class="id"><a href="CDF.IMP.html#kterminates">kterminates</a></span> <span class="id">s</span> <span class="id">c</span> <span class="id">s</span>'.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof24')">Proof.</span></div>
<div class="proofscript" id="proof24">
&nbsp;&nbsp;<span class="id">intros</span>. <br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.Simulation.html#simulation_star">simulation_star</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="CDF.IMP.html#simulation_red_cont">simulation_red_cont</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span> (<span class="id">c</span>, <span class="id"><a href="CDF.IMP.html#Kstop">Kstop</a></span>, <span class="id">s</span>)) <span class="kwd">as</span> ((<span class="id">c</span>' &amp; <span class="id">s</span>'') &amp; <span class="id">STAR</span> &amp; <span class="id">INV</span>).<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">INV</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id"><a href="CDF.IMP.html#apply_cont_is_skip">apply_cont_is_skip</a></span>; <span class="id">eauto</span>. <span class="id">subst</span> <span class="id">k</span> <span class="id">c0</span>. <span class="id">apply</span> <span class="id">STAR</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="diverges_kdiverges">diverges_kdiverges</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">c</span>, <span class="id"><a href="CDF.IMP.html#diverges">diverges</a></span> <span class="id">s</span> <span class="id">c</span> -&gt;  <span class="id"><a href="CDF.IMP.html#kdiverges">kdiverges</a></span> <span class="id">s</span> <span class="id">c</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof25')">Proof.</span></div>
<div class="proofscript" id="proof25">
&nbsp;&nbsp;<span class="id">intros</span>. <br/>
&nbsp;&nbsp;<span class="id">apply</span> (<span class="id"><a href="CDF.Simulation.html#simulation_infseq">simulation_infseq</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="CDF.IMP.html#simulation_red_cont">simulation_red_cont</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">auto</span>.<br/>
Qed.</div>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
