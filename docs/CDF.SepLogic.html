
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module SepLogic</title>
<meta name="description" content="Documentation of Coq module SepLogic" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module SepLogic</h1>
<div class="coq">
<span class="kwd">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.ZArith.html">ZArith</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.micromega.Psatz.html">Psatz</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html">Bool</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html">String</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html">List</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Wellfounded.Wellfounded.html">Wellfounded</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Program.Equality.html">Program.Equality</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Logic.FunctionalExtensionality.html">FunctionalExtensionality</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Logic.PropExtensionality.html">PropExtensionality</a></span>.<br/>
<span class="kwd">From</span> <span class="id">CDF</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="CDF.IMP.html">IMP</a></span> <span class="id"><a href="CDF.Sequences.html">Sequences</a></span>.<br/>
<br/>
<span class="id">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">string_scope</span>.<br/>
<span class="id">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">Z_scope</span>.<br/>
<br/>
<h1> 4.  Program logics: separation logic </h1>
<br/>
<h2> 4.9.  Memory heaps </h2>
<br/>
<div class="doc">A memory heap is a partial function from addresses (memory locations) 
    to values, with a finite domain. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="addr">addr</a></span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>.<br/>
<br/>
<span class="kwd">Record</span> <span class="id"><a name="heap">heap</a></span> : <span class="kwd">Type</span> := {<br/>
&nbsp;&nbsp;<span class="id"><a name="contents">contents</a></span> :&gt; <span class="id"><a href="CDF.SepLogic.html#addr">addr</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>;<br/>
&nbsp;&nbsp;<span class="id"><a name="isfinite">isfinite</a></span> :  <span class="kwd">exists</span> <span class="id">i</span>, <span class="kwd">forall</span> <span class="id">j</span>, <span class="id">i</span> &lt;= <span class="id">j</span> -&gt; <span class="id">contents</span> <span class="id">j</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
}.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="heap_extensionality">heap_extensionality</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">h1</span> <span class="id">h2</span>: <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span>),<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">l</span>, <span class="id">h1</span> <span class="id">l</span> = <span class="id">h2</span> <span class="id">l</span>) -&gt; <span class="id">h1</span> = <span class="id">h2</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof1')">Proof.</span></div>
<div class="proofscript" id="proof1">
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">destruct</span> <span class="id">h1</span> <span class="kwd">as</span> [<span class="id">c1</span> <span class="id">fin1</span>], <span class="id">h2</span> <span class="kwd">as</span> [<span class="id">c2</span> <span class="id">fin2</span>].<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">c1</span> = <span class="id">c2</span>) <span class="kwd">by</span> (<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Logic.FunctionalExtensionality.html#functional_extensionality">functional_extensionality</a></span>; <span class="id">auto</span>).<br/>
&nbsp;&nbsp;<span class="id">subst</span> <span class="id">c2</span>. <span class="id">f_equal</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Logic.PropExtensionality.html#proof_irrelevance">proof_irrelevance</a></span>.<br/>
Qed.</div>
<br/>
<div class="doc">The empty heap. </div>
<br/>
<span class="id">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="hempty">hempty</a></span> : <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span> :=<br/>
&nbsp;&nbsp;{| <span class="id"><a href="CDF.SepLogic.html#contents">contents</a></span> := <span class="kwd">fun</span> <span class="id">l</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> |}.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof2')">Next Obligation.</span></div>
<div class="proofscript" id="proof2">
&nbsp;&nbsp;<span class="kwd">exists</span> 0; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">The heap that contains <span class="bracket"><span class="id">v</span></span> at address <span class="bracket"><span class="id">l</span></span> and is equal to <span class="bracket"><span class="id">h</span></span> on
    all other addresses. </div>
<br/>
<span class="id">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="hupdate">hupdate</a></span> (<span class="id">l</span>: <span class="id"><a href="CDF.SepLogic.html#addr">addr</a></span>) (<span class="id">v</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">h</span>: <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span>) : <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span> :=<br/>
&nbsp;&nbsp;{| <span class="id"><a href="CDF.SepLogic.html#contents">contents</a></span> := <span class="kwd">fun</span> <span class="id">l</span>' =&gt; <span class="kwd">if</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">l</span>' <span class="kwd">then</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span> <span class="kwd">else</span> <span class="id">h</span> <span class="id">l</span>' |}.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof3')">Next Obligation.</span></div>
<div class="proofscript" id="proof3">
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.SepLogic.html#isfinite">isfinite</a></span> <span class="id">h</span>) <span class="kwd">as</span> (<span class="id">i</span> &amp; <span class="id">fin</span>).<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.max">Z.max</a></span> <span class="id">i</span> (<span class="id">l</span> + 1)); <span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">j</span>). <span class="id">lia</span>. <span class="id">apply</span> <span class="id">fin</span>; <span class="id">lia</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hupdate_same">hupdate_same</a></span>: <span class="kwd">forall</span> <span class="id">l</span> <span class="id">v</span> <span class="id">h</span>, (<span class="id"><a href="CDF.SepLogic.html#hupdate">hupdate</a></span> <span class="id">l</span> <span class="id">v</span> <span class="id">h</span>) <span class="id">l</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof4')">Proof.</span></div>
<div class="proofscript" id="proof4">
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">cbn</span>. <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">l</span>); <span class="id">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hupdate_other">hupdate_other</a></span>: <span class="kwd">forall</span> <span class="id">l</span> <span class="id">v</span> <span class="id">h</span> <span class="id">l</span>', <span class="id">l</span> &lt;&gt; <span class="id">l</span>' -&gt; (<span class="id"><a href="CDF.SepLogic.html#hupdate">hupdate</a></span> <span class="id">l</span> <span class="id">v</span> <span class="id">h</span>) <span class="id">l</span>' = <span class="id">h</span> <span class="id">l</span>'.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof5')">Proof.</span></div>
<div class="proofscript" id="proof5">
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">cbn</span>. <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">l</span>'); <span class="id">congruence</span>.<br/>
Qed.</div>
<br/>
<div class="doc">The heap <span class="bracket"><span class="id">h</span></span> after deallocating address <span class="bracket"><span class="id">l</span></span>. </div>
<br/>
<span class="id">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="hfree">hfree</a></span> (<span class="id">l</span>: <span class="id"><a href="CDF.SepLogic.html#addr">addr</a></span>) (<span class="id">h</span>: <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span>) : <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span> :=<br/>
&nbsp;&nbsp;{| <span class="id"><a href="CDF.SepLogic.html#contents">contents</a></span> := <span class="kwd">fun</span> <span class="id">l</span>' =&gt; <span class="kwd">if</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">l</span>' <span class="kwd">then</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="kwd">else</span> <span class="id">h</span> <span class="id">l</span>' |}.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof6')">Next Obligation.</span></div>
<div class="proofscript" id="proof6">
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.SepLogic.html#isfinite">isfinite</a></span> <span class="id">h</span>) <span class="kwd">as</span> (<span class="id">i</span> &amp; <span class="id">fin</span>).<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">i</span>; <span class="id">intros</span>. <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">j</span>); <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">The heap <span class="bracket"><span class="id">h</span></span> where addresses <span class="bracket"><span class="id">l</span>, ..., <span class="id">l</span> + <span class="id">sz</span> - 1</span> are initialized to 0. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="hinit">hinit</a></span> (<span class="id">l</span>: <span class="id"><a href="CDF.SepLogic.html#addr">addr</a></span>) (<span class="id">sz</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) (<span class="id">h</span>: <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span>) : <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">sz</span> <span class="kwd">with</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#O">O</a></span> =&gt; <span class="id">h</span> | <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">sz</span> =&gt; <span class="id"><a href="CDF.SepLogic.html#hupdate">hupdate</a></span> <span class="id">l</span> 0 (<span class="id">hinit</span> (<span class="id">l</span> + 1) <span class="id">sz</span> <span class="id">h</span>) <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hinit_inside">hinit_inside</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h</span> <span class="id">sz</span> <span class="id">l</span> <span class="id">l</span>', <span class="id">l</span> &lt;= <span class="id">l</span>' &lt; <span class="id">l</span> + <span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.of_nat">Z.of_nat</a></span> <span class="id">sz</span> -&gt; <span class="id"><a href="CDF.SepLogic.html#hinit">hinit</a></span> <span class="id">l</span> <span class="id">sz</span> <span class="id">h</span> <span class="id">l</span>' = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> 0.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof7')">Proof.</span></div>
<div class="proofscript" id="proof7">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">sz</span>; <span class="id">intros</span>; <span class="id">cbn</span>.<br/>
- <span class="id">lia</span>.<br/>
- <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">l</span>'); <span class="id">auto</span>. <span class="id">apply</span> <span class="id">IHsz</span>. <span class="id">lia</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hinit_outside">hinit_outside</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h</span> <span class="id">sz</span> <span class="id">l</span> <span class="id">l</span>', <span class="id">l</span>' &lt; <span class="id">l</span> \/ <span class="id">l</span> + <span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.of_nat">Z.of_nat</a></span> <span class="id">sz</span> &lt;= <span class="id">l</span>' -&gt; <span class="id"><a href="CDF.SepLogic.html#hinit">hinit</a></span> <span class="id">l</span> <span class="id">sz</span> <span class="id">h</span> <span class="id">l</span>' = <span class="id">h</span> <span class="id">l</span>'.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof8')">Proof.</span></div>
<div class="proofscript" id="proof8">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">sz</span>; <span class="id">intros</span>; <span class="id">cbn</span>.<br/>
- <span class="id">auto</span>.<br/>
- <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">l</span>'). <span class="id">lia</span>. <span class="id">apply</span> <span class="id">IHsz</span>; <span class="id">lia</span>.<br/>
Qed.</div>
<br/>
<div class="doc">The disjoint union of two heaps. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="hdisjoint">hdisjoint</a></span> (<span class="id">h1</span> <span class="id">h2</span>: <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span>, <span class="id">h1</span> <span class="id">l</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> \/ <span class="id">h2</span> <span class="id">l</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hdisjoint_sym">hdisjoint_sym</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h1</span> <span class="id">h2</span>, <span class="id"><a href="CDF.SepLogic.html#hdisjoint">hdisjoint</a></span> <span class="id">h1</span> <span class="id">h2</span> -&gt; <span class="id"><a href="CDF.SepLogic.html#hdisjoint">hdisjoint</a></span> <span class="id">h2</span> <span class="id">h1</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof9')">Proof.</span></div>
<div class="proofscript" id="proof9">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="CDF.SepLogic.html#hdisjoint">hdisjoint</a></span>; <span class="id">intros</span>. <span class="id">specialize</span> (<span class="id">H</span> <span class="id">l</span>); <span class="id">tauto</span>.<br/>
Qed.</div>
<br/>
<span class="id">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="hunion">hunion</a></span> (<span class="id">h1</span> <span class="id">h2</span>: <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span>) : <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span> :=<br/>
&nbsp;&nbsp;{| <span class="id"><a href="CDF.SepLogic.html#contents">contents</a></span> := <span class="kwd">fun</span> <span class="id">l</span> =&gt; <span class="kwd">if</span> <span class="id">h1</span> <span class="id">l</span> <span class="kwd">then</span> <span class="id">h1</span> <span class="id">l</span> <span class="kwd">else</span> <span class="id">h2</span> <span class="id">l</span> |}.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof10')">Next Obligation.</span></div>
<div class="proofscript" id="proof10">
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.SepLogic.html#isfinite">isfinite</a></span> <span class="id">h1</span>) <span class="kwd">as</span> (<span class="id">i1</span> &amp; <span class="id">fin1</span>), (<span class="id"><a href="CDF.SepLogic.html#isfinite">isfinite</a></span> <span class="id">h2</span>) <span class="kwd">as</span> (<span class="id">i2</span> &amp; <span class="id">fin2</span>).<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.max">Z.max</a></span> <span class="id">i1</span> <span class="id">i2</span>); <span class="id">intros</span>. <span class="id">rewrite</span> <span class="id">fin1</span>, <span class="id">fin2</span> <span class="kwd">by</span> <span class="id">lia</span>. <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hunion_comm">hunion_comm</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h1</span> <span class="id">h2</span>, <span class="id"><a href="CDF.SepLogic.html#hdisjoint">hdisjoint</a></span> <span class="id">h1</span> <span class="id">h2</span> -&gt; <span class="id"><a href="CDF.SepLogic.html#hunion">hunion</a></span> <span class="id">h2</span> <span class="id">h1</span> = <span class="id"><a href="CDF.SepLogic.html#hunion">hunion</a></span> <span class="id">h1</span> <span class="id">h2</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof11')">Proof.</span></div>
<div class="proofscript" id="proof11">
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#heap_extensionality">heap_extensionality</a></span>; <span class="id">intros</span>; <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> <span class="id">l</span>). <span class="id">destruct</span> (<span class="id">h1</span> <span class="id">l</span>), (<span class="id">h2</span> <span class="id">l</span>); <span class="id">intuition</span> <span class="id">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hunion_assoc">hunion_assoc</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">h3</span>, <span class="id"><a href="CDF.SepLogic.html#hunion">hunion</a></span> (<span class="id"><a href="CDF.SepLogic.html#hunion">hunion</a></span> <span class="id">h1</span> <span class="id">h2</span>) <span class="id">h3</span> = <span class="id"><a href="CDF.SepLogic.html#hunion">hunion</a></span> <span class="id">h1</span> (<span class="id"><a href="CDF.SepLogic.html#hunion">hunion</a></span> <span class="id">h2</span> <span class="id">h3</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof12')">Proof.</span></div>
<div class="proofscript" id="proof12">
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#heap_extensionality">heap_extensionality</a></span>; <span class="id">intros</span>; <span class="id">cbn</span>. <span class="id">destruct</span> (<span class="id">h1</span> <span class="id">l</span>); <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hunion_empty">hunion_empty</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h</span>, <span class="id"><a href="CDF.SepLogic.html#hunion">hunion</a></span> <span class="id"><a href="CDF.SepLogic.html#hempty">hempty</a></span> <span class="id">h</span> = <span class="id">h</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof13')">Proof.</span></div>
<div class="proofscript" id="proof13">
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#heap_extensionality">heap_extensionality</a></span>; <span class="id">intros</span>; <span class="id">cbn</span>. <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<h2> 4.10.  The IMP language with pointers and dynamic allocation </h2>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="com">com</a></span>: <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="SKIP">SKIP</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a name="ASSIGN">ASSIGN</a></span> (<span class="id">x</span>: <span class="id"><a href="CDF.IMP.html#ident">ident</a></span>) (<span class="id">a</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="SEQ">SEQ</a></span> (<span class="id">c1</span>: <span class="id">com</span>) (<span class="id">c2</span>: <span class="id">com</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="IFTHENELSE">IFTHENELSE</a></span> (<span class="id">b</span>: <span class="id"><a href="CDF.IMP.html#bexp">bexp</a></span>) (<span class="id">c1</span>: <span class="id">com</span>) (<span class="id">c2</span>: <span class="id">com</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="WHILE">WHILE</a></span> (<span class="id">b</span>: <span class="id"><a href="CDF.IMP.html#bexp">bexp</a></span>) (<span class="id">c1</span>: <span class="id">com</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="ALLOC">ALLOC</a></span> (<span class="id">x</span>: <span class="id"><a href="CDF.IMP.html#ident">ident</a></span>) (<span class="id">sz</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)  <span class="docright">(* allocate <span class="bracket"><span class="id">sz</span></span> consecutive words  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="GET">GET</a></span> (<span class="id">x</span>: <span class="id"><a href="CDF.IMP.html#ident">ident</a></span>) (<span class="id">a</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>)    <span class="docright">(* read from address <span class="bracket"><span class="id">a</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="SET">SET</a></span> (<span class="id">a1</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>) (<span class="id">a2</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>)   <span class="docright">(* write <span class="bracket"><span class="id">a2</span></span> at address <span class="bracket"><span class="id">a1</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="FREE">FREE</a></span> (<span class="id">a</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>).             <span class="docright">(* deallocation of address <span class="bracket"><span class="id">a</span></span>  *)</span><br/>
<br/>
<div class="doc">The reduction semantics operates on configurations <span class="bracket">(<span class="id">c</span>, <span class="id">s</span>, <span class="id">h</span>)</span>,
    where <span class="bracket"><span class="id">c</span></span> is a command, <span class="bracket"><span class="id">s</span></span> the current store (associating values
    to variables), and <span class="bracket"><span class="id">h</span></span> the current heap (associating values to
    addresses). </div>
<br/>
<div class="doc">The first 6 rules are those of IMP.  The heap <span class="bracket"><span class="id">h</span></span> is unchanged.
    The last 4 rules give semantics to heap operations
    <span class="bracket"><span class="id">ALLOC</span></span>, <span class="bracket"><span class="id">GET</span></span>, <span class="bracket"><span class="id">SET</span></span>, <span class="bracket"><span class="id">FREE</span></span>.
</div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="red">red</a></span>: <span class="id"><a href="CDF.SepLogic.html#com">com</a></span> * <span class="id"><a href="CDF.IMP.html#store">store</a></span> * <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span> -&gt; <span class="id"><a href="CDF.SepLogic.html#com">com</a></span> * <span class="id"><a href="CDF.IMP.html#store">store</a></span> * <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_assign">red_assign</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">a</span> <span class="id">s</span> <span class="id">h</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> (<span class="id"><a href="CDF.SepLogic.html#ASSIGN">ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span>, <span class="id">s</span>, <span class="id">h</span>) (<span class="id"><a href="CDF.SepLogic.html#SKIP">SKIP</a></span>, <span class="id"><a href="CDF.IMP.html#update">update</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a</span> <span class="id">s</span>) <span class="id">s</span>, <span class="id">h</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_seq_done">red_seq_done</a></span>: <span class="kwd">forall</span> <span class="id">c</span> <span class="id">s</span> <span class="id">h</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> (<span class="id"><a href="CDF.SepLogic.html#SEQ">SEQ</a></span> <span class="id"><a href="CDF.SepLogic.html#SKIP">SKIP</a></span> <span class="id">c</span>, <span class="id">s</span>, <span class="id">h</span>) (<span class="id">c</span>, <span class="id">s</span>, <span class="id">h</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_seq_step">red_seq_step</a></span>: <span class="kwd">forall</span> <span class="id">c1</span> <span class="id">c</span> <span class="id">s1</span> <span class="id">h1</span> <span class="id">c2</span> <span class="id">s2</span> <span class="id">h2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> (<span class="id">c1</span>, <span class="id">s1</span>, <span class="id">h1</span>) (<span class="id">c2</span>, <span class="id">s2</span>, <span class="id">h2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> (<span class="id"><a href="CDF.SepLogic.html#SEQ">SEQ</a></span> <span class="id">c1</span> <span class="id">c</span>, <span class="id">s1</span>, <span class="id">h1</span>) (<span class="id"><a href="CDF.SepLogic.html#SEQ">SEQ</a></span> <span class="id">c2</span> <span class="id">c</span>, <span class="id">s2</span>, <span class="id">h2</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_ifthenelse">red_ifthenelse</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">s</span> <span class="id">h</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> (<span class="id"><a href="CDF.SepLogic.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span>, <span class="id">s</span>, <span class="id">h</span>) ((<span class="kwd">if</span> <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> <span class="kwd">then</span> <span class="id">c1</span> <span class="kwd">else</span> <span class="id">c2</span>), <span class="id">s</span>, <span class="id">h</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_while_done">red_while_done</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">c</span> <span class="id">s</span> <span class="id">h</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> (<span class="id"><a href="CDF.SepLogic.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>, <span class="id">s</span>, <span class="id">h</span>) (<span class="id"><a href="CDF.SepLogic.html#SKIP">SKIP</a></span>, <span class="id">s</span>, <span class="id">h</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_while_loop">red_while_loop</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">c</span> <span class="id">s</span> <span class="id">h</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> (<span class="id"><a href="CDF.SepLogic.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>, <span class="id">s</span>, <span class="id">h</span>) (<span class="id"><a href="CDF.SepLogic.html#SEQ">SEQ</a></span> <span class="id">c</span> (<span class="id"><a href="CDF.SepLogic.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>), <span class="id">s</span>, <span class="id">h</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_alloc">red_alloc</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">sz</span> <span class="id">s</span> (<span class="id">h</span>: <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span>) <span class="id">l</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">i</span>, <span class="id">l</span> &lt;= <span class="id">i</span> &lt; <span class="id">l</span> + <span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.of_nat">Z.of_nat</a></span> <span class="id">sz</span> -&gt; <span class="id">h</span> <span class="id">i</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> (<span class="id"><a href="CDF.SepLogic.html#ALLOC">ALLOC</a></span> <span class="id">x</span> <span class="id">sz</span>, <span class="id">s</span>, <span class="id">h</span>) (<span class="id"><a href="CDF.SepLogic.html#SKIP">SKIP</a></span>, <span class="id"><a href="CDF.IMP.html#update">update</a></span> <span class="id">x</span> <span class="id">l</span> <span class="id">s</span>, <span class="id"><a href="CDF.SepLogic.html#hinit">hinit</a></span> <span class="id">l</span> <span class="id">sz</span> <span class="id">h</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_get">red_get</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">a</span> <span class="id">s</span> (<span class="id">h</span>: <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span>) <span class="id">l</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l</span> = <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a</span> <span class="id">s</span> -&gt; <span class="id">h</span> <span class="id">l</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> (<span class="id"><a href="CDF.SepLogic.html#GET">GET</a></span> <span class="id">x</span> <span class="id">a</span>, <span class="id">s</span>, <span class="id">h</span>) (<span class="id"><a href="CDF.SepLogic.html#SKIP">SKIP</a></span>, <span class="id"><a href="CDF.IMP.html#update">update</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">s</span>, <span class="id">h</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_set">red_set</a></span>: <span class="kwd">forall</span> <span class="id">a1</span> <span class="id">a2</span> <span class="id">s</span> (<span class="id">h</span>: <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span>) <span class="id">l</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l</span> = <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a1</span> <span class="id">s</span> -&gt; <span class="id">h</span> <span class="id">l</span> &lt;&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt; <span class="id">v</span> = <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a2</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> (<span class="id"><a href="CDF.SepLogic.html#SET">SET</a></span> <span class="id">a1</span> <span class="id">a2</span>, <span class="id">s</span>, <span class="id">h</span>) (<span class="id"><a href="CDF.SepLogic.html#SKIP">SKIP</a></span>, <span class="id">s</span>, <span class="id"><a href="CDF.SepLogic.html#hupdate">hupdate</a></span> <span class="id">l</span> <span class="id">v</span> <span class="id">h</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_free">red_free</a></span>: <span class="kwd">forall</span> <span class="id">a</span> <span class="id">s</span> (<span class="id">h</span>: <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span>) <span class="id">l</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l</span> = <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a</span> <span class="id">s</span> -&gt; <span class="id">h</span> <span class="id">l</span> &lt;&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> (<span class="id"><a href="CDF.SepLogic.html#FREE">FREE</a></span> <span class="id">a</span>, <span class="id">s</span>, <span class="id">h</span>) (<span class="id"><a href="CDF.SepLogic.html#SKIP">SKIP</a></span>, <span class="id">s</span>, <span class="id"><a href="CDF.SepLogic.html#hfree">hfree</a></span> <span class="id">l</span> <span class="id">h</span>).<br/>
<br/>
<div class="doc">The variables possibly modified by the execution of a command. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="modified_by">modified_by</a></span> (<span class="id">c</span>: <span class="id"><a href="CDF.SepLogic.html#com">com</a></span>) (<span class="id">x</span>: <span class="id"><a href="CDF.IMP.html#ident">ident</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.SepLogic.html#SKIP">SKIP</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.SepLogic.html#ASSIGN">ASSIGN</a></span> <span class="id">y</span> <span class="id">a</span> =&gt; <span class="id">x</span> = <span class="id">y</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.SepLogic.html#SEQ">SEQ</a></span> <span class="id">c1</span> <span class="id">c2</span> =&gt; <span class="id">modified_by</span> <span class="id">c1</span> <span class="id">x</span> \/ <span class="id">modified_by</span> <span class="id">c2</span> <span class="id">x</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.SepLogic.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> =&gt; <span class="id">modified_by</span> <span class="id">c1</span> <span class="id">x</span> \/ <span class="id">modified_by</span> <span class="id">c2</span> <span class="id">x</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.SepLogic.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c1</span> =&gt; <span class="id">modified_by</span> <span class="id">c1</span> <span class="id">x</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.SepLogic.html#ALLOC">ALLOC</a></span> <span class="id">y</span> <span class="id">sz</span> =&gt; <span class="id">x</span> = <span class="id">y</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.SepLogic.html#GET">GET</a></span> <span class="id">y</span> <span class="id">a</span> =&gt; <span class="id">x</span> = <span class="id">y</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.SepLogic.html#SET">SET</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.SepLogic.html#FREE">FREE</a></span> <span class="id">a</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<h2> 4.11.  Assertions for separation logic </h2>
<br/>
<div class="doc">Assertions are predicates over the two components of the memory state. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="assertion">assertion</a></span> : <span class="kwd">Type</span> := <span class="id"><a href="CDF.IMP.html#store">store</a></span> -&gt; <span class="id"><a href="CDF.SepLogic.html#heap">heap</a></span> -&gt; <span class="kwd">Prop</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="aexists">aexists</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">P</span>: <span class="id">A</span> -&gt; <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span>) : <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">s</span> <span class="id">h</span> =&gt; <span class="kwd">exists</span> <span class="id">a</span>: <span class="id">A</span>, <span class="id">P</span> <span class="id">a</span> <span class="id">s</span> <span class="id">h</span>.<br/>
<br/>
<div class="doc">The assertion "the heap is empty" </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="emp">emp</a></span> : <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">s</span> <span class="id">h</span> =&gt; <span class="id">h</span> = <span class="id"><a href="CDF.SepLogic.html#hempty">hempty</a></span>.<br/>
<br/>
<div class="doc">The assertion "address <span class="bracket"><span class="id">l</span></span> contains value <span class="bracket"><span class="id">v</span></span>". 
    The domain of the heap must be the singleton <span class="bracket">{<span class="id">l</span>}</span>. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="contains">contains</a></span> (<span class="id">l</span>: <span class="id"><a href="CDF.SepLogic.html#addr">addr</a></span>) (<span class="id">v</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">s</span> <span class="id">h</span> =&gt; <span class="id">h</span> = <span class="id"><a href="CDF.SepLogic.html#hupdate">hupdate</a></span> <span class="id">l</span> <span class="id">v</span> <span class="id"><a href="CDF.SepLogic.html#hempty">hempty</a></span>.<br/>
<br/>
<div class="doc">The assertion "address <span class="bracket"><span class="id">l</span></span> is valid" (i.e. in the domain of the heap). </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="valid">valid</a></span> (<span class="id">l</span>: <span class="id"><a href="CDF.SepLogic.html#addr">addr</a></span>) : <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span> := <span class="id"><a href="CDF.SepLogic.html#aexists">aexists</a></span> (<span class="id"><a href="CDF.SepLogic.html#contains">contains</a></span> <span class="id">l</span>).<br/>
<br/>
<div class="doc">The separating conjunction. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="sepconj">sepconj</a></span> (<span class="id">P</span> <span class="id">Q</span>: <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span>) : <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">s</span> <span class="id">h</span> =&gt; <span class="kwd">exists</span> <span class="id">h1</span> <span class="id">h2</span>, <span class="id">P</span> <span class="id">s</span> <span class="id">h1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">Q</span> <span class="id">s</span> <span class="id">h2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="CDF.SepLogic.html#hdisjoint">hdisjoint</a></span> <span class="id">h1</span> <span class="id">h2</span>  /\ <span class="id">h</span> = <span class="id"><a href="CDF.SepLogic.html#hunion">hunion</a></span> <span class="id">h1</span> <span class="id">h2</span>.<br/>
<br/>
<span class="kwd">Notation</span> "<span class="id">P</span> ** <span class="id">Q</span>" := (<span class="id"><a href="CDF.SepLogic.html#sepconj">sepconj</a></span> <span class="id">P</span> <span class="id">Q</span>) (<span class="kwd">at</span> <span class="id">level</span> 60, <span class="id">right</span> <span class="id">associativity</span>).<br/>
<br/>
<div class="doc">We also use simple assertions that do not depend on the heap but
    only depend on the store.  These are similar to the assertions
    used in Hoare logic. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="simple_assertion">simple_assertion</a></span> : <span class="kwd">Type</span> := <span class="id"><a href="CDF.IMP.html#store">store</a></span> -&gt; <span class="kwd">Prop</span>.<br/>
<br/>
<div class="doc">The assertion "arithmetic expression <span class="bracket"><span class="id">a</span></span> evaluates to value <span class="bracket"><span class="id">v</span></span>". </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="aequal">aequal</a></span> (<span class="id">a</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>) (<span class="id">v</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="id"><a href="CDF.SepLogic.html#simple_assertion">simple_assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">s</span> =&gt; <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a</span> <span class="id">s</span> = <span class="id">v</span>.<br/>
<br/>
<div class="doc">The assertions "Boolean expression <span class="bracket"><span class="id">b</span></span> evaluates to true / to false". </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="atrue">atrue</a></span> (<span class="id">b</span>: <span class="id"><a href="CDF.IMP.html#bexp">bexp</a></span>) : <span class="id"><a href="CDF.SepLogic.html#simple_assertion">simple_assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">s</span> =&gt; <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="afalse">afalse</a></span> (<span class="id">b</span>: <span class="id"><a href="CDF.IMP.html#bexp">bexp</a></span>) : <span class="id"><a href="CDF.SepLogic.html#simple_assertion">simple_assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">s</span> =&gt; <span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<br/>
<div class="doc">The conjunction of a simple assertion and a general assertion. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="pureconj">pureconj</a></span> (<span class="id">P</span>: <span class="id"><a href="CDF.SepLogic.html#simple_assertion">simple_assertion</a></span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span>) : <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">s</span> <span class="id">h</span> =&gt; <span class="id">P</span> <span class="id">s</span> /\ <span class="id">Q</span> <span class="id">s</span> <span class="id">h</span>.<br/>
<br/>
<span class="kwd">Notation</span> "<span class="id">P</span> //\\ <span class="id">Q</span>" := (<span class="id"><a href="CDF.SepLogic.html#pureconj">pureconj</a></span> <span class="id">P</span> <span class="id">Q</span>) (<span class="kwd">at</span> <span class="id">level</span> 60, <span class="id">right</span> <span class="id">associativity</span>).<br/>
<br/>
<div class="doc">Extensional equality between assertions. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="assertion_extensionality">assertion_extensionality</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">P</span> <span class="id">Q</span>: <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span>),<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">s</span> <span class="id">h</span>, <span class="id">P</span> <span class="id">s</span> <span class="id">h</span> &lt;-&gt; <span class="id">Q</span> <span class="id">s</span> <span class="id">h</span>) -&gt; <span class="id">P</span> = <span class="id">Q</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof14')">Proof.</span></div>
<div class="proofscript" id="proof14">
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Logic.FunctionalExtensionality.html#functional_extensionality">functional_extensionality</a></span>; <span class="id">intros</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Logic.FunctionalExtensionality.html#functional_extensionality">functional_extensionality</a></span>; <span class="id">intros</span> <span class="id">h</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Logic.PropExtensionality.html#propositional_extensionality">propositional_extensionality</a></span>. <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Important properties of separating conjunction: commutativity,
    associativity, <span class="bracket"><span class="id">emp</span></span> as neutral element. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sepconj_comm">sepconj_comm</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span>, <span class="id">P</span> ** <span class="id">Q</span> = <span class="id">Q</span> ** <span class="id">P</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof15')">Proof.</span></div>
<div class="proofscript" id="proof15">
&nbsp;&nbsp;<span class="id">assert</span> (<span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">s</span> <span class="id">h</span>, (<span class="id">P</span> ** <span class="id">Q</span>) <span class="id">s</span> <span class="id">h</span> -&gt; (<span class="id">Q</span> ** <span class="id">P</span>) <span class="id">s</span> <span class="id">h</span>).<br/>
&nbsp;&nbsp;{ <span class="id">intros</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">s</span> <span class="id">h</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">P1</span> &amp; <span class="id">Q2</span> &amp; <span class="id">EQ</span> &amp; <span class="id">DISJ</span>); <span class="id">subst</span> <span class="id">h</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">h2</span>, <span class="id">h1</span>; <span class="id">intuition</span> <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#hdisjoint_sym">hdisjoint_sym</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">symmetry</span>; <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#hunion_comm">hunion_comm</a></span>; <span class="id">auto</span>. } <br/>
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#assertion_extensionality">assertion_extensionality</a></span>; <span class="id">intros</span>; <span class="id">split</span>; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sepconj_assoc">sepconj_assoc</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">R</span>, (<span class="id">P</span> ** <span class="id">Q</span>) ** <span class="id">R</span> = <span class="id">P</span> ** (<span class="id">Q</span> ** <span class="id">R</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof16')">Proof.</span></div>
<div class="proofscript" id="proof16">
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#assertion_extensionality">assertion_extensionality</a></span>; <span class="id">intros</span>; <span class="id">split</span>.<br/>
- <span class="id">intros</span> (<span class="id">hx</span> &amp; <span class="id">h3</span> &amp; (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">P1</span> &amp; <span class="id">Q2</span> &amp; <span class="id">EQ</span> &amp; <span class="id">DISJ</span>) &amp; <span class="id">R3</span> &amp; <span class="id">EQ</span>' &amp; <span class="id">DISJ</span>'). <span class="id">subst</span> <span class="id">hx</span> <span class="id">h</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="CDF.SepLogic.html#hunion_assoc">hunion_assoc</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">h1</span>, (<span class="id"><a href="CDF.SepLogic.html#hunion">hunion</a></span> <span class="id">h2</span> <span class="id">h3</span>); <span class="id">intuition</span> <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">h2</span>, <span class="id">h3</span>; <span class="id">intuition</span> <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">l</span>. <span class="id">specialize</span> (<span class="id">EQ</span> <span class="id">l</span>); <span class="id">specialize</span> (<span class="id">EQ</span>' <span class="id">l</span>). <span class="id">cbn</span> <span class="kwd">in</span> <span class="id">EQ</span>'.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">EQ</span> <span class="kwd">as</span> [<span class="id">EQ</span>|<span class="id">EQ</span>]. <span class="id">rewrite</span> <span class="id">EQ</span> <span class="kwd">in</span> <span class="id">EQ</span>'; <span class="id">auto</span>. <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">l</span>. <span class="id">specialize</span> (<span class="id">EQ</span> <span class="id">l</span>); <span class="id">specialize</span> (<span class="id">EQ</span>' <span class="id">l</span>). <span class="id">cbn</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">EQ</span> <span class="kwd">as</span> [<span class="id">EQ</span>|<span class="id">EQ</span>]. <span class="id">auto</span>. <span class="id">rewrite</span> <span class="id">EQ</span> <span class="kwd">in</span> *. <span class="id">destruct</span> (<span class="id">h1</span> <span class="id">l</span>); <span class="id">auto</span>.<br/>
- <span class="id">intros</span> (<span class="id">h1</span> &amp; <span class="id">hx</span> &amp; <span class="id">P1</span> &amp; (<span class="id">h2</span> &amp; <span class="id">h3</span> &amp; <span class="id">Q2</span> &amp; <span class="id">R3</span> &amp; <span class="id">EQ</span> &amp; <span class="id">DISJ</span>) &amp; <span class="id">EQ</span>' &amp; <span class="id">DISJ</span>'). <span class="id">subst</span> <span class="id">hx</span> <span class="id">h</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id"><a href="CDF.SepLogic.html#hunion_assoc">hunion_assoc</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="CDF.SepLogic.html#hunion">hunion</a></span> <span class="id">h1</span> <span class="id">h2</span>), <span class="id">h3</span>; <span class="id">intuition</span> <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">h1</span>, <span class="id">h2</span>; <span class="id">intuition</span> <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">l</span>. <span class="id">specialize</span> (<span class="id">EQ</span> <span class="id">l</span>); <span class="id">specialize</span> (<span class="id">EQ</span>' <span class="id">l</span>). <span class="id">cbn</span> <span class="kwd">in</span> <span class="id">EQ</span>'.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">EQ</span>' <span class="kwd">as</span> [<span class="id">EQ</span>'|<span class="id">EQ</span>']. <span class="id">auto</span>. <span class="id">destruct</span> (<span class="id">h2</span> <span class="id">l</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">l</span>. <span class="id">specialize</span> (<span class="id">EQ</span> <span class="id">l</span>); <span class="id">specialize</span> (<span class="id">EQ</span>' <span class="id">l</span>). <span class="id">cbn</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">EQ</span> <span class="kwd">as</span> [<span class="id">EQ</span>|<span class="id">EQ</span>]. <span class="id">rewrite</span> <span class="id">EQ</span> <span class="kwd">in</span> *. <span class="id">destruct</span> (<span class="id">h1</span> <span class="id">l</span>); <span class="id">auto</span>. <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sepconj_emp">sepconj_emp</a></span>: <span class="kwd">forall</span> <span class="id">P</span>, <span class="id"><a href="CDF.SepLogic.html#emp">emp</a></span> ** <span class="id">P</span> = <span class="id">P</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof17')">Proof.</span></div>
<div class="proofscript" id="proof17">
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#assertion_extensionality">assertion_extensionality</a></span>; <span class="id">intros</span>; <span class="id">split</span>.<br/>
- <span class="id">intros</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">EMP1</span> &amp; <span class="id">P2</span> &amp; <span class="id">EQ</span> &amp; <span class="id">DISJ</span>). <span class="id">red</span> <span class="kwd">in</span> <span class="id">EMP1</span>. <span class="id">subst</span> <span class="id">h</span> <span class="id">h1</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="CDF.SepLogic.html#hunion_empty">hunion_empty</a></span>; <span class="id">auto</span>.<br/>
- <span class="id">intros</span>. <span class="kwd">exists</span> <span class="id"><a href="CDF.SepLogic.html#hempty">hempty</a></span>, <span class="id">h</span>; <span class="id">intuition</span> <span class="id">auto</span>. <br/>
&nbsp;&nbsp;<span class="id">red</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">red</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="CDF.SepLogic.html#hunion_empty">hunion_empty</a></span>; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="lift_aexists">lift_aexists</a></span>: <span class="kwd">forall</span> (<span class="id">A</span>: <span class="kwd">Type</span>) (<span class="id">P</span>: <span class="id">A</span> -&gt; <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span>) <span class="id">Q</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#aexists">aexists</a></span> <span class="id">P</span> ** <span class="id">Q</span> = <span class="id"><a href="CDF.SepLogic.html#aexists">aexists</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">P</span> <span class="id">x</span> ** <span class="id">Q</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof18')">Proof.</span></div>
<div class="proofscript" id="proof18">
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#assertion_extensionality">assertion_extensionality</a></span>; <span class="id">intros</span>; <span class="id">split</span>.<br/>
- <span class="id">intros</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; (<span class="id">a</span> &amp; <span class="id">P1</span>) &amp; <span class="id">Q2</span> &amp; <span class="id">DISJ</span> &amp; <span class="id">EQ</span>).<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">a</span>, <span class="id">h1</span>, <span class="id">h2</span>; <span class="id">auto</span>.<br/>
- <span class="id">intros</span> (<span class="id">a</span> &amp; <span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">P1</span> &amp; <span class="id">Q2</span> &amp; <span class="id">DISJ</span> &amp; <span class="id">EQ</span>).<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">h1</span>, <span class="id">h2</span>; <span class="id">intuition</span> <span class="id">auto</span>. <span class="kwd">exists</span> <span class="id">a</span>; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="lift_simple_conj">lift_simple_conj</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">R</span>, (<span class="id">P</span> //\\ <span class="id">Q</span>) ** <span class="id">R</span> = <span class="id">P</span> //\\ (<span class="id">Q</span> ** <span class="id">R</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof19')">Proof.</span></div>
<div class="proofscript" id="proof19">
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#assertion_extensionality">assertion_extensionality</a></span>; <span class="id">intros</span>; <span class="id">split</span>.<br/>
- <span class="id">intros</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; (<span class="id">P1</span> &amp; <span class="id">Q1</span>) &amp; <span class="id">R2</span> &amp; <span class="id">DISJ</span> &amp; <span class="id">EQ</span>). <br/>
&nbsp;&nbsp;<span class="id">split</span>; <span class="id">auto</span>. <span class="kwd">exists</span> <span class="id">h1</span>, <span class="id">h2</span>; <span class="id">auto</span>.<br/>
- <span class="id">intros</span> (<span class="id">P1</span> &amp; (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">Q1</span> &amp; <span class="id">R2</span> &amp; <span class="id">DISJ</span> &amp; <span class="id">EQ</span>)). <br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">h1</span>, <span class="id">h2</span>; <span class="id">intuition</span> <span class="id">auto</span>. <span class="id">split</span>; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<h2> 4.12.  The rules of separation logic. </h2>
<br/>
<div class="doc">We set out to define a "strong" logic that guarantees termination
    without errors for commands.  Possible errors include reading or
    writing to an address that is not allocated, and deallocating
    an already-deallocated address.
    A natural definition of the triple <span class="bracket">[<span class="id">P</span>] <span class="id">c</span> [<span class="id">Q</span>]</span> is as follows.
</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="triple_base">triple_base</a></span> (<span class="id">P</span>: <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span>) (<span class="id">c</span>: <span class="id"><a href="CDF.SepLogic.html#com">com</a></span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">h</span>,<br/>
&nbsp;&nbsp;<span class="id">P</span> <span class="id">s</span> <span class="id">h</span> -&gt; <span class="kwd">exists</span> <span class="id">s</span>' <span class="id">h</span>', <span class="id"><a href="CDF.Sequences.html#star">star</a></span> <span class="id"><a href="CDF.SepLogic.html#red">red</a></span> (<span class="id">c</span>, <span class="id">s</span>, <span class="id">h</span>) (<span class="id"><a href="CDF.SepLogic.html#SKIP">SKIP</a></span>, <span class="id">s</span>', <span class="id">h</span>') /\ <span class="id">Q</span> <span class="id">s</span>' <span class="id">h</span>'.<br/>
<br/>
<div class="doc">This definition is not quite right because it does not validate
    the frame rule.  For example, if <span class="bracket"><span class="id">c</span></span> is an allocation <span class="bracket"><span class="id">x</span> := <span class="id">ALLOC</span>(1)</span>,
    we do have the triple
<pre>
       [ emp ]  x := ALLOC(1)  [ aexists (fun l =&gt; aequal (VAR "x") l //\\ valid l ]</pre>
    However, if we frame with another assertion <span class="bracket"><span class="id">R</span></span>, the allocated
    address <span class="bracket"><span class="id">l</span></span> could fall within the memory footprint of <span class="bracket"><span class="id">R</span></span>.
    Therefore, the postcondition <span class="bracket"><span class="id">R</span> ** <span class="id">aexists</span> ...</span> can be false. </div>
<br/>
<div class="doc">An elegant way around this problem is to quantify universally over
    all possible framings in the very definition of the triple. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="independent_of">independent_of</a></span> (<span class="id">P</span>: <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span>) (<span class="id">vars</span>: <span class="id"><a href="CDF.IMP.html#ident">ident</a></span> -&gt; <span class="kwd">Prop</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h</span> <span class="id">s1</span> <span class="id">s2</span>,<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, ~ <span class="id">vars</span> <span class="id">x</span> -&gt; <span class="id">s2</span> <span class="id">x</span> = <span class="id">s1</span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">P</span> <span class="id">s1</span> <span class="id">h</span> -&gt; <span class="id">P</span> <span class="id">s2</span> <span class="id">h</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="triple">triple</a></span> (<span class="id">P</span>: <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span>) (<span class="id">c</span>: <span class="id"><a href="CDF.SepLogic.html#com">com</a></span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">R</span>: <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#independent_of">independent_of</a></span> <span class="id">R</span> (<span class="id"><a href="CDF.SepLogic.html#modified_by">modified_by</a></span> <span class="id">c</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#triple_base">triple_base</a></span> (<span class="id">P</span> ** <span class="id">R</span>) <span class="id">c</span> (<span class="id">Q</span> ** <span class="id">R</span>).<br/>
<br/>
<div class="doc">The frame rule is, then, valid by construction.
    However, the proofs of the other rules of separation logic are
    slightly more difficult, since they must account for this systematic
    framing by an assertion <span class="bracket"><span class="id">R</span></span>. </div>
<br/>
<span class="kwd">Notation</span> "[[ <span class="id">P</span> ]] <span class="id">c</span> [[ <span class="id">Q</span> ]]" := (<span class="id"><a href="CDF.SepLogic.html#triple">triple</a></span> <span class="id">P</span> <span class="id">c</span> <span class="id">Q</span>) (<span class="kwd">at</span> <span class="id">level</span> 90, <span class="id">c</span> <span class="kwd">at</span> <span class="id">next</span> <span class="id">level</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="triple_frame">triple_frame</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">c</span> <span class="id">Q</span> <span class="id">R</span>,<br/>
&nbsp;&nbsp;[[ <span class="id">P</span> ]] <span class="id">c</span> [[ <span class="id">Q</span> ]] -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#independent_of">independent_of</a></span> <span class="id">R</span> (<span class="id"><a href="CDF.SepLogic.html#modified_by">modified_by</a></span> <span class="id">c</span>) -&gt;<br/>
&nbsp;&nbsp;[[ <span class="id">P</span> ** <span class="id">R</span> ]] <span class="id">c</span> [[ <span class="id">Q</span> ** <span class="id">R</span> ]].<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof20')">Proof.</span></div>
<div class="proofscript" id="proof20">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">P</span> <span class="id">c</span> <span class="id">Q</span> <span class="id">R</span> <span class="id">TR</span> <span class="id">INDR</span> <span class="id">S</span> <span class="id">INDS</span>. <span class="id">rewrite</span> ! <span class="id"><a href="CDF.SepLogic.html#sepconj_assoc">sepconj_assoc</a></span>. <span class="id">apply</span> <span class="id">TR</span>.<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">h</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">SAME</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">R1</span> &amp; <span class="id">S2</span> &amp; <span class="id">DISJ</span> &amp; <span class="id">EQ</span>).<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">h1</span>, <span class="id">h2</span>; <span class="id">intuition</span> <span class="id">eauto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">The "small rules" for heap operations. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="triple_get">triple_get</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">a</span> <span class="id">l</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#aequal">aequal</a></span> <span class="id">a</span> <span class="id">l</span> //\\ <span class="id"><a href="CDF.SepLogic.html#contains">contains</a></span> <span class="id">l</span> <span class="id">v</span> ]]<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#GET">GET</a></span> <span class="id">x</span> <span class="id">a</span><br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#aequal">aequal</a></span> (<span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> <span class="id">x</span>) <span class="id">v</span> //\\ <span class="id"><a href="CDF.SepLogic.html#contains">contains</a></span> <span class="id">l</span> <span class="id">v</span> ]].<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof21')">Proof.</span></div>
<div class="proofscript" id="proof21">
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">intros</span> <span class="id">R</span> <span class="id">IND</span> <span class="id">s</span> <span class="id">h</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; (<span class="id">P1</span> &amp; <span class="id">P2</span>) &amp; <span class="id">R1</span> &amp; <span class="id">DISJ</span> &amp; <span class="id">EQ</span>).<br/>
&nbsp;&nbsp;<span class="id">do</span> 2 <span class="id">econstructor</span>; <span class="id">split</span>.<br/>
- <span class="id">apply</span> <span class="id"><a href="CDF.Sequences.html#star_one">star_one</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#red_get">red_get</a></span> <span class="kwd">with</span> (<span class="id">l</span> := <span class="id">l</span>) (<span class="id">v</span> := <span class="id">v</span>); <span class="id">auto</span>. <span class="id">rewrite</span> <span class="id">EQ</span>, <span class="id">P2</span>; <span class="id">cbn</span>. <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">l</span>); <span class="id">congruence</span>. <br/>
- <span class="kwd">exists</span> <span class="id">h1</span>, <span class="id">h2</span>; <span class="id">intuition</span> <span class="id">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="id">split</span>. <span class="id">red</span>; <span class="id">cbn</span>. <span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#update_same">update_same</a></span>. <span class="id">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IND</span> <span class="kwd">with</span> <span class="id">s</span>; <span class="id">auto</span>. <span class="id">cbn</span>; <span class="id">intros</span>. <span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#update_other">update_other</a></span>; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="triple_set">triple_set</a></span>: <span class="kwd">forall</span> <span class="id">a1</span> <span class="id">a2</span> <span class="id">l</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#aequal">aequal</a></span> <span class="id">a1</span> <span class="id">l</span> //\\ <span class="id"><a href="CDF.SepLogic.html#aequal">aequal</a></span> <span class="id">a2</span> <span class="id">v</span> //\\ <span class="id"><a href="CDF.SepLogic.html#valid">valid</a></span> <span class="id">l</span> ]]<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#SET">SET</a></span> <span class="id">a1</span> <span class="id">a2</span><br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#contains">contains</a></span> <span class="id">l</span> <span class="id">v</span> ]].<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof22')">Proof.</span></div>
<div class="proofscript" id="proof22">
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">intros</span> <span class="id">R</span> <span class="id">IND</span> <span class="id">s</span> <span class="id">h</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; (<span class="id">P1</span> &amp; <span class="id">P2</span> &amp; <span class="id">P3</span>) &amp; <span class="id">R1</span> &amp; <span class="id">DISJ</span> &amp; <span class="id">EQ</span>). <span class="id">destruct</span> <span class="id">P3</span> <span class="kwd">as</span> (<span class="id">v0</span> &amp; <span class="id">P3</span>).<br/>
&nbsp;&nbsp;<span class="id">do</span> 2 <span class="id">econstructor</span>; <span class="id">split</span>.<br/>
- <span class="id">apply</span> <span class="id"><a href="CDF.Sequences.html#star_one">star_one</a></span>. <span class="id">eapply</span> <span class="id"><a href="CDF.SepLogic.html#red_set">red_set</a></span> <span class="kwd">with</span> (<span class="id">l</span> := <span class="id">l</span>) (<span class="id">v</span> := <span class="id">v</span>); <span class="id">auto</span>. <span class="id">rewrite</span> <span class="id">EQ</span>, <span class="id">P3</span>. <span class="id">cbn</span>. <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">l</span>); <span class="id">congruence</span>.<br/>
- <span class="kwd">exists</span> (<span class="id"><a href="CDF.SepLogic.html#hupdate">hupdate</a></span> <span class="id">l</span> <span class="id">v</span> <span class="id"><a href="CDF.SepLogic.html#hempty">hempty</a></span>), <span class="id">h2</span>; <span class="id">intuition</span> <span class="id">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="id">red</span>; <span class="id">auto</span>. <br/>
&nbsp;&nbsp;+ <span class="id">intros</span> <span class="id">l</span>'. <span class="id">specialize</span> (<span class="id">DISJ</span> <span class="id">l</span>'). <span class="id">rewrite</span> <span class="id">P3</span> <span class="kwd">in</span> <span class="id">DISJ</span>. <span class="id">cbn</span> <span class="kwd">in</span> *. <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">l</span>'); <span class="id">intuition</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id">EQ</span>, <span class="id">P3</span>. <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#heap_extensionality">heap_extensionality</a></span>; <span class="id">intros</span> <span class="id">l</span>'; <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">l</span>'); <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="valid_N">valid_N</a></span> (<span class="id">l</span>: <span class="id"><a href="CDF.SepLogic.html#addr">addr</a></span>) (<span class="id">sz</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) : <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">sz</span> <span class="kwd">with</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#O">O</a></span> =&gt; <span class="id"><a href="CDF.SepLogic.html#emp">emp</a></span> | <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">sz</span> =&gt; <span class="id"><a href="CDF.SepLogic.html#valid">valid</a></span> <span class="id">l</span> ** <span class="id">valid_N</span> (<span class="id">l</span> + 1) <span class="id">sz</span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="triple_alloc">triple_alloc</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">sz</span>,<br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#emp">emp</a></span> ]]<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#ALLOC">ALLOC</a></span> <span class="id">x</span> <span class="id">sz</span><br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#aexists">aexists</a></span> (<span class="kwd">fun</span> <span class="id">l</span> =&gt; <span class="id"><a href="CDF.SepLogic.html#aequal">aequal</a></span> (<span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> <span class="id">x</span>) <span class="id">l</span> //\\ <span class="id"><a href="CDF.SepLogic.html#valid_N">valid_N</a></span> <span class="id">l</span> <span class="id">sz</span>) ]].<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof23')">Proof.</span></div>
<div class="proofscript" id="proof23">
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">intros</span> <span class="id">R</span> <span class="id">IND</span> <span class="id">s</span> <span class="id">h</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">EMP</span> &amp; <span class="id">R1</span> &amp; <span class="id">DISJ</span> &amp; <span class="id">EQ</span>). <br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.SepLogic.html#isfinite">isfinite</a></span> <span class="id">h</span>) <span class="kwd">as</span> (<span class="id">l0</span> &amp; <span class="id">FIN</span>). <br/>
&nbsp;&nbsp;<span class="id">set</span> (<span class="id">l</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.max">Z.max</a></span> <span class="id">l0</span> 1).<br/>
&nbsp;&nbsp;<span class="id">do</span> 2 <span class="id">econstructor</span>; <span class="id">split</span>.<br/>
- <span class="id">apply</span> <span class="id"><a href="CDF.Sequences.html#star_one">star_one</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#red_alloc">red_alloc</a></span> <span class="kwd">with</span> (<span class="id">l</span> := <span class="id">l</span>). <span class="id">intros</span>; <span class="id">apply</span> <span class="id">FIN</span>; <span class="id">lia</span>. <span class="id">lia</span>.<br/>
- <span class="kwd">exists</span> (<span class="id"><a href="CDF.SepLogic.html#hinit">hinit</a></span> <span class="id">l</span> <span class="id">sz</span> <span class="id"><a href="CDF.SepLogic.html#hempty">hempty</a></span>), <span class="id">h2</span>; <span class="id">intuition</span> <span class="id">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="kwd">exists</span> <span class="id">l</span>; <span class="id">split</span>. <span class="id">red</span>; <span class="id">cbn</span>. <span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#update_same">update_same</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">REC</span>: <span class="kwd">forall</span> <span class="id">s1</span> <span class="id">sz1</span> <span class="id">l1</span>, <span class="id"><a href="CDF.SepLogic.html#valid_N">valid_N</a></span> <span class="id">l1</span> <span class="id">sz1</span> <span class="id">s1</span> (<span class="id"><a href="CDF.SepLogic.html#hinit">hinit</a></span> <span class="id">l1</span> <span class="id">sz1</span> <span class="id"><a href="CDF.SepLogic.html#hempty">hempty</a></span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">induction</span> <span class="id">sz1</span>; <span class="id">cbn</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">red</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="kwd">exists</span> (<span class="id"><a href="CDF.SepLogic.html#hupdate">hupdate</a></span> <span class="id">l1</span> 0 <span class="id"><a href="CDF.SepLogic.html#hempty">hempty</a></span>), (<span class="id"><a href="CDF.SepLogic.html#hinit">hinit</a></span> (<span class="id">l1</span> + 1) <span class="id">sz1</span> <span class="id"><a href="CDF.SepLogic.html#hempty">hempty</a></span>); <span class="id">intuition</span> <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="kwd">exists</span> 0; <span class="id">red</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">red</span>; <span class="id">intros</span>. <span class="id">cbn</span>. <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l1</span> <span class="id">l2</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#hinit_outside">hinit_outside</a></span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#heap_extensionality">heap_extensionality</a></span>; <span class="id">intros</span>. <span class="id">cbn</span>. <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l1</span> <span class="id">l2</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">REC</span>.<br/>
&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IND</span> <span class="kwd">with</span> <span class="id">s</span>; <span class="id">auto</span>. <span class="id">cbn</span>; <span class="id">intros</span>. <span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#update_other">update_other</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="id">intros</span> <span class="id">l</span>'. <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.lt_ge_cases">Z.lt_ge_cases</a></span> <span class="id">l</span>' <span class="id">l</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#hinit_outside">hinit_outside</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">L</span>: <span class="id">h</span> <span class="id">l</span>' = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) <span class="kwd">by</span> (<span class="id">apply</span> <span class="id">FIN</span>; <span class="id">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">EQ</span> <span class="kwd">in</span> <span class="id">L</span>; <span class="id">cbn</span> <span class="kwd">in</span> <span class="id">L</span>. <span class="id">destruct</span> (<span class="id">h1</span> <span class="id">l</span>'); <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id">EQ</span>, <span class="id">EMP</span>, <span class="id"><a href="CDF.SepLogic.html#hunion_empty">hunion_empty</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#heap_extensionality">heap_extensionality</a></span>; <span class="id">intros</span> <span class="id">l</span>'; <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.lt_ge_cases">Z.lt_ge_cases</a></span> <span class="id">l</span>' <span class="id">l</span>). <span class="id">rewrite</span> ! <span class="id"><a href="CDF.SepLogic.html#hinit_outside">hinit_outside</a></span> <span class="kwd">by</span> <span class="id">auto</span>. <span class="id">auto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.lt_ge_cases">Z.lt_ge_cases</a></span> <span class="id">l</span>' (<span class="id">l</span> + <span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.of_nat">Z.of_nat</a></span> <span class="id">sz</span>)). <span class="id">rewrite</span> ! <span class="id"><a href="CDF.SepLogic.html#hinit_inside">hinit_inside</a></span> <span class="kwd">by</span> <span class="id">auto</span>. <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> ! <span class="id"><a href="CDF.SepLogic.html#hinit_outside">hinit_outside</a></span> <span class="kwd">by</span> <span class="id">auto</span>. <span class="id">auto</span>. <br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="triple_free">triple_free</a></span>: <span class="kwd">forall</span> <span class="id">a</span> <span class="id">l</span>,<br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#aequal">aequal</a></span> <span class="id">a</span> <span class="id">l</span> //\\ <span class="id"><a href="CDF.SepLogic.html#valid">valid</a></span> <span class="id">l</span> ]]<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#FREE">FREE</a></span> <span class="id">a</span><br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#emp">emp</a></span> ]].<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof24')">Proof.</span></div>
<div class="proofscript" id="proof24">
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">intros</span> <span class="id">R</span> <span class="id">IND</span> <span class="id">s</span> <span class="id">h</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; (<span class="id">P1</span> &amp; <span class="id">P2</span>) &amp; <span class="id">R1</span> &amp; <span class="id">DISJ</span> &amp; <span class="id">EQ</span>). <span class="id">destruct</span> <span class="id">P2</span> <span class="kwd">as</span> (<span class="id">v0</span> &amp; <span class="id">P2</span>).<br/>
&nbsp;&nbsp;<span class="id">do</span> 2 <span class="id">econstructor</span>; <span class="id">split</span>.<br/>
- <span class="id">apply</span> <span class="id"><a href="CDF.Sequences.html#star_one">star_one</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#red_free">red_free</a></span> <span class="kwd">with</span> (<span class="id">l</span> := <span class="id">l</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">EQ</span>; <span class="id">cbn</span>. <span class="id">rewrite</span> ! <span class="id">P2</span>, <span class="id"><a href="CDF.SepLogic.html#hupdate_same">hupdate_same</a></span>. <span class="id">congruence</span>.<br/>
- <span class="kwd">exists</span> <span class="id"><a href="CDF.SepLogic.html#hempty">hempty</a></span>, <span class="id">h2</span>; <span class="id">intuition</span> <span class="id">auto</span>. <br/>
&nbsp;&nbsp;+ <span class="id">red</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="id">red</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id">EQ</span>, <span class="id">P2</span>. <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#heap_extensionality">heap_extensionality</a></span>; <span class="id">intros</span> <span class="id">l</span>'; <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">l</span>'); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subst</span> <span class="id">l</span>'. <span class="id">generalize</span> (<span class="id">DISJ</span> <span class="id">l</span>). <span class="id">rewrite</span> <span class="id">P2</span>, <span class="id"><a href="CDF.SepLogic.html#hupdate_same">hupdate_same</a></span>. <span class="id">intuition</span> <span class="id">congruence</span>.<br/>
Qed.</div>
<br/>
<div class="doc">The rules for the other constructs of IMP.  They resemble the rules
    for strong Hoare logic. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="triple_skip">triple_skip</a></span>:<br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#emp">emp</a></span> ]]  <span class="id"><a href="CDF.SepLogic.html#SKIP">SKIP</a></span>  [[ <span class="id"><a href="CDF.SepLogic.html#emp">emp</a></span> ]].<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof25')">Proof.</span></div>
<div class="proofscript" id="proof25">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">R</span> <span class="id">IND</span> <span class="id">s</span> <span class="id">h</span> <span class="id">PRE</span>. <span class="kwd">exists</span> <span class="id">s</span>, <span class="id">h</span>; <span class="id">split</span>; <span class="id">auto</span>. <span class="id">apply</span> <span class="id"><a href="CDF.Sequences.html#star_refl">star_refl</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="triple_assign">triple_assign</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">a</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#aequal">aequal</a></span> <span class="id">a</span> <span class="id">n</span> //\\ <span class="id"><a href="CDF.SepLogic.html#emp">emp</a></span> ]]<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#ASSIGN">ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span><br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#aequal">aequal</a></span> (<span class="id"><a href="CDF.IMP.html#VAR">VAR</a></span> <span class="id">x</span>) <span class="id">n</span> //\\ <span class="id"><a href="CDF.SepLogic.html#emp">emp</a></span> ]].<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof26')">Proof.</span></div>
<div class="proofscript" id="proof26">
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">intros</span> <span class="id">R</span> <span class="id">IND</span> <span class="id">s</span> <span class="id">h</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; (<span class="id">P1</span> &amp; <span class="id">P2</span>) &amp; <span class="id">R1</span> &amp; <span class="id">DISJ</span> &amp; <span class="id">EQ</span>).<br/>
&nbsp;&nbsp;<span class="id">do</span> 2 <span class="id">econstructor</span>; <span class="id">split</span>.<br/>
- <span class="id">apply</span> <span class="id"><a href="CDF.Sequences.html#star_one">star_one</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#red_assign">red_assign</a></span>. <br/>
- <span class="kwd">exists</span> <span class="id">h1</span>, <span class="id">h2</span>; <span class="id">intuition</span> <span class="id">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="id">split</span>; <span class="id">auto</span>. <span class="id">red</span>; <span class="id">cbn</span>. <span class="id">rewrite</span> <span class="id"><a href="CDF.IMP.html#update_same">update_same</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IND</span> <span class="kwd">with</span> <span class="id">s</span>; <span class="id">auto</span>. <span class="id">cbn</span>; <span class="id">intros</span>. <span class="id">apply</span> <span class="id"><a href="CDF.IMP.html#update_other">update_other</a></span>; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="star_red_seq_step">star_red_seq_step</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c1</span> <span class="id">s1</span> <span class="id">h1</span> <span class="id">c2</span> <span class="id">s2</span> <span class="id">h2</span>, <span class="id"><a href="CDF.Sequences.html#star">star</a></span> <span class="id"><a href="CDF.SepLogic.html#red">red</a></span> (<span class="id">c1</span>, <span class="id">s1</span>, <span class="id">h1</span>) (<span class="id">c2</span>, <span class="id">s2</span>, <span class="id">h2</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span>, <span class="id"><a href="CDF.Sequences.html#star">star</a></span> <span class="id"><a href="CDF.SepLogic.html#red">red</a></span> (<span class="id"><a href="CDF.SepLogic.html#SEQ">SEQ</a></span> <span class="id">c1</span> <span class="id">c</span>, <span class="id">s1</span>, <span class="id">h1</span>) (<span class="id"><a href="CDF.SepLogic.html#SEQ">SEQ</a></span> <span class="id">c2</span> <span class="id">c</span>, <span class="id">s2</span>, <span class="id">h2</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof27')">Proof.</span></div>
<div class="proofscript" id="proof27">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">until</span> <span class="id">h2</span>; <span class="id">intros</span> <span class="id">STAR</span>; <span class="id">dependent</span> <span class="id">induction</span> <span class="id">STAR</span>; <span class="id">intros</span>.<br/>
- <span class="id">apply</span> <span class="id"><a href="CDF.Sequences.html#star_refl">star_refl</a></span>.<br/>
- <span class="id">destruct</span> <span class="id">b</span> <span class="kwd">as</span> [ [<span class="id">c</span>' <span class="id">s</span>'] <span class="id">h</span>']. <span class="id">eapply</span> <span class="id"><a href="CDF.Sequences.html#star_step">star_step</a></span>; <span class="id">eauto</span>. <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#red_seq_step">red_seq_step</a></span>; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="triple_seq">triple_seq</a></span>: <span class="kwd">forall</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">R</span>,<br/>
&nbsp;&nbsp;[[ <span class="id">P</span> ]] <span class="id">c1</span> [[ <span class="id">Q</span> ]] -&gt; [[ <span class="id">Q</span> ]] <span class="id">c2</span> [[ <span class="id">R</span> ]] -&gt; [[ <span class="id">P</span> ]] <span class="id"><a href="CDF.SepLogic.html#SEQ">SEQ</a></span> <span class="id">c1</span> <span class="id">c2</span> [[ <span class="id">R</span> ]].<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof28')">Proof.</span></div>
<div class="proofscript" id="proof28">
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">intros</span> <span class="id">S</span> <span class="id">IND</span> <span class="id">s</span> <span class="id">h</span> <span class="id">A0</span>.<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">IND1</span>: <span class="id"><a href="CDF.SepLogic.html#independent_of">independent_of</a></span> <span class="id">S</span> (<span class="id"><a href="CDF.SepLogic.html#modified_by">modified_by</a></span> <span class="id">c1</span>)).<br/>
&nbsp;&nbsp;{ <span class="id">red</span>; <span class="id">intros</span>; <span class="id">apply</span> <span class="id">IND</span> <span class="kwd">with</span> <span class="id">s1</span>; <span class="id">auto</span>. <span class="id">cbn</span>. <span class="id">intros</span>; <span class="id">apply</span> <span class="id">H1</span>; <span class="id">tauto</span>. }<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">IND2</span>: <span class="id"><a href="CDF.SepLogic.html#independent_of">independent_of</a></span> <span class="id">S</span> (<span class="id"><a href="CDF.SepLogic.html#modified_by">modified_by</a></span> <span class="id">c2</span>)).<br/>
&nbsp;&nbsp;{ <span class="id">red</span>; <span class="id">intros</span>; <span class="id">apply</span> <span class="id">IND</span> <span class="kwd">with</span> <span class="id">s1</span>; <span class="id">auto</span>. <span class="id">cbn</span>. <span class="id">intros</span>; <span class="id">apply</span> <span class="id">H1</span>; <span class="id">tauto</span>. }<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">H</span> <span class="id">S</span> <span class="id">IND1</span> <span class="id">s</span> <span class="id">h</span> <span class="id">A0</span>) <span class="kwd">as</span> (<span class="id">s1</span> &amp; <span class="id">h1</span> &amp; <span class="id">EXEC1</span> &amp; <span class="id">A1</span>).<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">H0</span> <span class="id">S</span> <span class="id">IND2</span> <span class="id">s1</span> <span class="id">h1</span> <span class="id">A1</span>) <span class="kwd">as</span> (<span class="id">s2</span> &amp; <span class="id">h2</span> &amp; <span class="id">EXEC2</span> &amp; <span class="id">A2</span>).<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">s2</span>, <span class="id">h2</span>; <span class="id">split</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="CDF.Sequences.html#star_trans">star_trans</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#star_red_seq_step">star_red_seq_step</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="CDF.Sequences.html#star_step">star_step</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#red_seq_done">red_seq_done</a></span>. <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="triple_ifthenelse">triple_ifthenelse</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">P</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#atrue">atrue</a></span>  <span class="id">b</span> //\\ <span class="id">P</span> ]] <span class="id">c1</span> [[ <span class="id">Q</span> ]] -&gt;<br/>
&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">P</span> ]] <span class="id">c2</span> [[ <span class="id">Q</span> ]] -&gt;<br/>
&nbsp;&nbsp;[[ <span class="id">P</span> ]] <span class="id"><a href="CDF.SepLogic.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> [[ <span class="id">Q</span> ]].<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof29')">Proof.</span></div>
<div class="proofscript" id="proof29">
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">intros</span> <span class="id">R</span> <span class="id">IND</span> <span class="id">s</span> <span class="id">h</span> <span class="id">PRE</span>. <span class="id">destruct</span> (<span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span>) <span class="id">eqn</span>:<span class="id">B</span>.<br/>
- <span class="id">assert</span> (<span class="id">IND1</span>: <span class="id"><a href="CDF.SepLogic.html#independent_of">independent_of</a></span> <span class="id">R</span> (<span class="id"><a href="CDF.SepLogic.html#modified_by">modified_by</a></span> <span class="id">c1</span>)).<br/>
&nbsp;&nbsp;{ <span class="id">red</span>; <span class="id">intros</span>. <span class="id">apply</span> <span class="id">IND</span> <span class="kwd">with</span> <span class="id">s1</span>; <span class="id">auto</span>. <span class="id">cbn</span>; <span class="id">intros</span>; <span class="id">apply</span> <span class="id">H1</span>; <span class="id">tauto</span>. }<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">H</span> <span class="id">R</span> <span class="id">IND1</span> <span class="id">s</span> <span class="id">h</span>) <span class="kwd">as</span> (<span class="id">s</span>' &amp; <span class="id">h</span>' &amp; <span class="id">EXEC</span> &amp; <span class="id">POST</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="CDF.SepLogic.html#lift_simple_conj">lift_simple_conj</a></span>. <span class="id">split</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">s</span>', <span class="id">h</span>'; <span class="id">split</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="CDF.Sequences.html#star_step">star_step</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#red_ifthenelse">red_ifthenelse</a></span>. <span class="id">rewrite</span> <span class="id">B</span>. <span class="id">auto</span>.<br/>
- <span class="id">assert</span> (<span class="id">IND2</span>: <span class="id"><a href="CDF.SepLogic.html#independent_of">independent_of</a></span> <span class="id">R</span> (<span class="id"><a href="CDF.SepLogic.html#modified_by">modified_by</a></span> <span class="id">c2</span>)).<br/>
&nbsp;&nbsp;{ <span class="id">red</span>; <span class="id">intros</span>. <span class="id">apply</span> <span class="id">IND</span> <span class="kwd">with</span> <span class="id">s1</span>; <span class="id">auto</span>. <span class="id">cbn</span>; <span class="id">intros</span>; <span class="id">apply</span> <span class="id">H1</span>; <span class="id">tauto</span>. }<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">H0</span> <span class="id">R</span> <span class="id">IND2</span> <span class="id">s</span> <span class="id">h</span>) <span class="kwd">as</span> (<span class="id">s</span>' &amp; <span class="id">h</span>' &amp; <span class="id">EXEC</span> &amp; <span class="id">POST</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="CDF.SepLogic.html#lift_simple_conj">lift_simple_conj</a></span>. <span class="id">split</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">s</span>', <span class="id">h</span>'; <span class="id">split</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="CDF.Sequences.html#star_step">star_step</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#red_ifthenelse">red_ifthenelse</a></span>. <span class="id">rewrite</span> <span class="id">B</span>. <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="alessthan">alessthan</a></span> (<span class="id">a</span>: <span class="id"><a href="CDF.IMP.html#aexp">aexp</a></span>) (<span class="id">v</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="id"><a href="CDF.SepLogic.html#simple_assertion">simple_assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> (<span class="id">s</span>: <span class="id"><a href="CDF.IMP.html#store">store</a></span>) =&gt; 0 &lt;= <span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">a</span> <span class="id">s</span> &lt; <span class="id">v</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="triple_while">triple_while</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">variant</span> <span class="id">b</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id"><a href="CDF.SepLogic.html#aequal">aequal</a></span> <span class="id">variant</span> <span class="id">v</span> //\\ <span class="id">P</span>]]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">c</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#alessthan">alessthan</a></span> <span class="id">variant</span> <span class="id">v</span> //\\ <span class="id">P</span>]])<br/>
&nbsp;&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[[ <span class="id">P</span> ]] <span class="id"><a href="CDF.SepLogic.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span> [[ <span class="id"><a href="CDF.SepLogic.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">P</span> ]].<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof30')">Proof.</span></div>
<div class="proofscript" id="proof30">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">P</span> <span class="id">variant</span> <span class="id">b</span> <span class="id">c</span> <span class="id">TR</span>.<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">REC</span>: <span class="kwd">forall</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#aequal">aequal</a></span> <span class="id">variant</span> <span class="id">v</span> //\\ <span class="id">P</span> ]]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.SepLogic.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[[ <span class="id"><a href="CDF.SepLogic.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">P</span> ]]).<br/>
&nbsp;&nbsp;{ <span class="id">induction</span> <span class="id">v</span> <span class="kwd">using</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Wf.html#well_founded_induction">well_founded_induction</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.lt_wf">Z.lt_wf</a></span> 0)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">R</span> <span class="id">IND</span> <span class="id">s</span> <span class="id">h</span> <span class="id">PRE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">IND1</span>: <span class="id"><a href="CDF.SepLogic.html#independent_of">independent_of</a></span> <span class="id">R</span> (<span class="id"><a href="CDF.SepLogic.html#modified_by">modified_by</a></span> <span class="id">c</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">red</span>; <span class="id">intros</span>; <span class="id">apply</span> <span class="id">IND</span> <span class="kwd">with</span> <span class="id">s1</span>; <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.IMP.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span>) <span class="id">eqn</span>:<span class="id">B</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> (<span class="id">TR</span> <span class="id">v</span> <span class="id">R</span> <span class="id">IND1</span> <span class="id">s</span> <span class="id">h</span>) <span class="kwd">as</span> (<span class="id">s1</span> &amp; <span class="id">h1</span> &amp; <span class="id">EXEC1</span> &amp; <span class="id">POST1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="CDF.SepLogic.html#lift_simple_conj">lift_simple_conj</a></span>. <span class="id">split</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="CDF.SepLogic.html#lift_simple_conj">lift_simple_conj</a></span> <span class="kwd">in</span> <span class="id">POST1</span>. <span class="id">destruct</span> <span class="id">POST1</span> <span class="kwd">as</span> (<span class="id">LT</span> &amp; <span class="id">POST1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">H</span> (<span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">variant</span> <span class="id">s1</span>) <span class="id">LT</span> <span class="id">R</span> <span class="id">IND</span> <span class="id">s1</span> <span class="id">h1</span>) <span class="kwd">as</span> (<span class="id">s2</span> &amp; <span class="id">h2</span> &amp; <span class="id">EXEC2</span> &amp; <span class="id">POST2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="CDF.SepLogic.html#lift_simple_conj">lift_simple_conj</a></span>. <span class="id">split</span>; <span class="id">auto</span>. <span class="id">red</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">s2</span>, <span class="id">h2</span>; <span class="id">split</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="CDF.Sequences.html#star_step">star_step</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#red_while_loop">red_while_loop</a></span>. <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="CDF.Sequences.html#star_trans">star_trans</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#star_red_seq_step">star_red_seq_step</a></span>. <span class="id">eexact</span> <span class="id">EXEC1</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="CDF.Sequences.html#star_step">star_step</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#red_seq_done">red_seq_done</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact</span> <span class="id">EXEC2</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="CDF.SepLogic.html#lift_simple_conj">lift_simple_conj</a></span> <span class="kwd">in</span> <span class="id">PRE</span>. <span class="id">destruct</span> <span class="id">PRE</span> <span class="kwd">as</span> (<span class="id">EQ</span> &amp; <span class="id">POST1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">s</span>, <span class="id">h</span>; <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="CDF.Sequences.html#star_one">star_one</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#red_while_done">red_while_done</a></span>. <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="CDF.SepLogic.html#lift_simple_conj">lift_simple_conj</a></span>. <span class="id">split</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">R</span> <span class="id">IND</span> <span class="id">s</span> <span class="id">h</span> <span class="id">PRE</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> (<span class="id">REC</span> (<span class="id"><a href="CDF.IMP.html#aeval">aeval</a></span> <span class="id">variant</span> <span class="id">s</span>) <span class="id">R</span> <span class="id">IND</span> <span class="id">s</span> <span class="id">h</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="CDF.SepLogic.html#lift_simple_conj">lift_simple_conj</a></span>. <span class="id">split</span>; <span class="id">auto</span>. <span class="id">red</span>; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">The consequence rule. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="aimp">aimp</a></span> (<span class="id">P</span> <span class="id">Q</span>: <span class="id"><a href="CDF.SepLogic.html#assertion">assertion</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">h</span>, <span class="id">P</span> <span class="id">s</span> <span class="id">h</span> -&gt; <span class="id">Q</span> <span class="id">s</span> <span class="id">h</span>.<br/>
<br/>
<span class="kwd">Notation</span> "<span class="id">P</span> --&gt;&gt; <span class="id">Q</span>" := (<span class="id"><a href="CDF.SepLogic.html#aimp">aimp</a></span> <span class="id">P</span> <span class="id">Q</span>) (<span class="kwd">at</span> <span class="id">level</span> 95, <span class="id">no</span> <span class="id">associativity</span>).<br/>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="aimp_sepconj">aimp_sepconj</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">P</span>' <span class="id">Q</span>,<br/>
&nbsp;&nbsp;<span class="id">P</span> --&gt;&gt; <span class="id">P</span>' -&gt; <span class="id">P</span> ** <span class="id">Q</span> --&gt;&gt; <span class="id">P</span>' ** <span class="id">Q</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof31')">Proof.</span></div>
<div class="proofscript" id="proof31">
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">red</span>. <span class="id">intros</span> <span class="id">s</span> <span class="id">h</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">P1</span> &amp; <span class="id">Q2</span> &amp; <span class="id">DISJ</span> &amp; <span class="id">EQ</span>). <span class="kwd">exists</span> <span class="id">h1</span>, <span class="id">h2</span>; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="triple_consequence">triple_consequence</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">P</span>' <span class="id">c</span> <span class="id">Q</span>' <span class="id">Q</span>,<br/>
&nbsp;&nbsp;<span class="id">P</span> --&gt;&gt; <span class="id">P</span>'  -&gt;  [[ <span class="id">P</span>' ]] <span class="id">c</span> [[ <span class="id">Q</span>' ]]  -&gt;  <span class="id">Q</span>' --&gt;&gt; <span class="id">Q</span>  -&gt;<br/>
&nbsp;&nbsp;[[ <span class="id">P</span> ]] <span class="id">c</span> [[ <span class="id">Q</span> ]].<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof32')">Proof.</span></div>
<div class="proofscript" id="proof32">
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">intros</span> <span class="id">R</span> <span class="id">IND</span> <span class="id">s</span> <span class="id">h</span> <span class="id">PRE</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">H0</span> <span class="id">R</span> <span class="id">IND</span> <span class="id">s</span> <span class="id">h</span>) <span class="kwd">as</span> (<span class="id">s</span>' &amp; <span class="id">h</span>' &amp; <span class="id">EXEC</span> &amp; <span class="id">POST</span>).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#aimp_sepconj">aimp_sepconj</a></span> <span class="kwd">with</span> <span class="id">P</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">s</span>', <span class="id">h</span>'; <span class="id">split</span>; <span class="id">auto</span>. <span class="id">apply</span> <span class="id"><a href="CDF.SepLogic.html#aimp_sepconj">aimp_sepconj</a></span> <span class="kwd">with</span> <span class="id">Q</span>'; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
