
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module FUN</title>
<meta name="description" content="Documentation of Coq module FUN" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module FUN</h1>
<div class="coq">
<span class="kwd">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html">Bool</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html">String</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html">List</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Program.Equality.html">Program.Equality</a></span>.<br/>
<span class="kwd">From</span> <span class="id">CDF</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="CDF.Sequences.html">Sequences</a></span>.<br/>
<br/>
<span class="id">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">string_scope</span>.<br/>
<span class="id">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">list_scope</span>.<br/>
<br/>
<h1> 7.  The functional language FUN </h1>
<br/>
<h2> 7.1.  Syntax and semantics </h2>
<br/>
<div class="doc">The FUN language is lambda-calculus (variables, function abstractions,
    function applications) extended with Booleans:
    constants <span class="bracket"><span class="id">Const</span> <span class="id">true</span></span> and <span class="bracket"><span class="id">Const</span> <span class="id">false</span></span>, and a conditional
    <span class="bracket"><span class="id">Cond</span> <span class="id">a</span> <span class="id">ifso</span> <span class="id">ifnot</span></span> (that is, <span class="bracket"><span class="kwd">if</span> <span class="id">a</span> <span class="kwd">then</span> <span class="id">ifso</span> <span class="kwd">else</span> <span class="id">ifnot</span></span>).  </div>
&nbsp;<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="term">term</a></span>: <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="Var">Var</a></span> (<span class="id">x</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string">string</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="Abs">Abs</a></span> (<span class="id">x</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string">string</a></span>) (<span class="id">a</span>: <span class="id">term</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="App">App</a></span> (<span class="id">a1</span>: <span class="id">term</span>) (<span class="id">a2</span>: <span class="id">term</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="Const">Const</a></span> (<span class="id">b</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="Cond">Cond</a></span> (<span class="id">a</span>: <span class="id">term</span>) (<span class="id">ifso</span>: <span class="id">term</span>) (<span class="id">ifnot</span>: <span class="id">term</span>).<br/>
<br/>
<div class="doc">Values are function abstractions and Boolean constants. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="isvalue">isvalue</a></span>: <span class="id"><a href="CDF.FUN.html#term">term</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="V_Abs">V_Abs</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">isvalue</span> (<span class="id"><a href="CDF.FUN.html#Abs">Abs</a></span> <span class="id">x</span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="V_Const">V_Const</a></span>: <span class="kwd">forall</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">isvalue</span> (<span class="id"><a href="CDF.FUN.html#Const">Const</a></span> <span class="id">b</span>).<br/>
<br/>
<div class="doc"><span class="bracket"><span class="id">subst</span> <span class="id">a</span> <span class="id">x</span> <span class="id">c</span></span> is the term <span class="bracket"><span class="id">a</span></span> where the term <span class="bracket"><span class="id">c</span></span> is substituted
    for variable <span class="bracket"><span class="id">x</span></span>, also written <span class="bracket"><span class="id">a</span> [<span class="id">x</span> ← <span class="id">c</span>]</span> in the lecture. </div>
<br/>
<div class="doc">The substitution below is wrong in general, because it can capture
    variables that are free in <span class="bracket"><span class="id">c</span></span>.  We shall use it only when
    <span class="bracket"><span class="id">c</span></span> is a closed term, without free variables.  This corresponds
    to the reduction of whole programs, without free variables.
    The type system in section 7.2 guarantees that this is the case. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="subst">subst</a></span> (<span class="id">a</span>: <span class="id"><a href="CDF.FUN.html#term">term</a></span>) (<span class="id">x</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string">string</a></span>) (<span class="id">c</span>: <span class="id"><a href="CDF.FUN.html#term">term</a></span>) : <span class="id"><a href="CDF.FUN.html#term">term</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">a</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.FUN.html#Var">Var</a></span> <span class="id">y</span> =&gt; <span class="kwd">if</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x</span> <span class="id">y</span> <span class="kwd">then</span> <span class="id">c</span> <span class="kwd">else</span> <span class="id"><a href="CDF.FUN.html#Var">Var</a></span> <span class="id">y</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.FUN.html#Abs">Abs</a></span> <span class="id">y</span> <span class="id">a</span> =&gt; <span class="kwd">if</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x</span> <span class="id">y</span> <span class="kwd">then</span> <span class="id"><a href="CDF.FUN.html#Abs">Abs</a></span> <span class="id">y</span> <span class="id">a</span> <span class="kwd">else</span> <span class="id"><a href="CDF.FUN.html#Abs">Abs</a></span> <span class="id">y</span> (<span class="id">subst</span> <span class="id">a</span> <span class="id">x</span> <span class="id">c</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.FUN.html#App">App</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt; <span class="id"><a href="CDF.FUN.html#App">App</a></span> (<span class="id">subst</span> <span class="id">a1</span> <span class="id">x</span> <span class="id">c</span>) (<span class="id">subst</span> <span class="id">a2</span> <span class="id">x</span> <span class="id">c</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.FUN.html#Const">Const</a></span> <span class="id">b</span> =&gt; <span class="id"><a href="CDF.FUN.html#Const">Const</a></span> <span class="id">b</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.FUN.html#Cond">Cond</a></span> <span class="id">a</span> <span class="id">ifso</span> <span class="id">ifnot</span> =&gt; <span class="id"><a href="CDF.FUN.html#Cond">Cond</a></span> (<span class="id">subst</span> <span class="id">a</span> <span class="id">x</span> <span class="id">c</span>) (<span class="id">subst</span> <span class="id">ifso</span> <span class="id">x</span> <span class="id">c</span>) (<span class="id">subst</span> <span class="id">ifnot</span> <span class="id">x</span> <span class="id">c</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">The reduction semantics: <span class="bracket"><span class="id">red</span> <span class="id">a</span> <span class="id">a</span>'</span> means that <span class="bracket"><span class="id">a</span></span> reduces in one
    step to <span class="bracket"><span class="id">a</span>'</span>.  We choose a call-by-value semantics, with applications
    being evaluated from left to right. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="red">red</a></span>: <span class="id"><a href="CDF.FUN.html#term">term</a></span> -&gt; <span class="id"><a href="CDF.FUN.html#term">term</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_beta">red_beta</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">a</span> <span class="id">v</span>,                 <span class="docright">(* call-by-value beta reduction  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.FUN.html#isvalue">isvalue</a></span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> (<span class="id"><a href="CDF.FUN.html#App">App</a></span> (<span class="id"><a href="CDF.FUN.html#Abs">Abs</a></span> <span class="id">x</span> <span class="id">a</span>) <span class="id">v</span>) (<span class="id"><a href="CDF.FUN.html#subst">subst</a></span> <span class="id">a</span> <span class="id">x</span> <span class="id">v</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_cond">red_cond</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">ifso</span> <span class="id">ifnot</span>,            <span class="docright">(* reduction for conditionals  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> (<span class="id"><a href="CDF.FUN.html#Cond">Cond</a></span> (<span class="id"><a href="CDF.FUN.html#Const">Const</a></span> <span class="id">b</span>) <span class="id">ifso</span> <span class="id">ifnot</span>) (<span class="kwd">if</span> <span class="id">b</span> <span class="kwd">then</span> <span class="id">ifso</span> <span class="kwd">else</span> <span class="id">ifnot</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_app_1">red_app_1</a></span>: <span class="kwd">forall</span> <span class="id">a1</span> <span class="id">a2</span> <span class="id">a1</span>', <span class="docright">(* reduction to the left of an application  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> <span class="id">a1</span> <span class="id">a1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> (<span class="id"><a href="CDF.FUN.html#App">App</a></span> <span class="id">a1</span> <span class="id">a2</span>) (<span class="id"><a href="CDF.FUN.html#App">App</a></span> <span class="id">a1</span>' <span class="id">a2</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_app_2">red_app_2</a></span>: <span class="kwd">forall</span> <span class="id">v</span> <span class="id">a2</span> <span class="id">a2</span>', <span class="docright">(* reduction to the right of an application  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.FUN.html#isvalue">isvalue</a></span> <span class="id">v</span> -&gt; <span class="id">red</span> <span class="id">a2</span> <span class="id">a2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> (<span class="id"><a href="CDF.FUN.html#App">App</a></span> <span class="id">v</span> <span class="id">a2</span>) (<span class="id"><a href="CDF.FUN.html#App">App</a></span> <span class="id">v</span> <span class="id">a2</span>')<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_cond_1">red_cond_1</a></span>: <span class="kwd">forall</span> <span class="id">a</span> <span class="id">a</span>' <span class="id">ifso</span> <span class="id">ifnot</span>,         <span class="docright">(* reduction under a <span class="bracket"><span class="id">Cond</span></span>  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> <span class="id">a</span> <span class="id">a</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> (<span class="id"><a href="CDF.FUN.html#Cond">Cond</a></span> <span class="id">a</span> <span class="id">ifso</span> <span class="id">ifnot</span>) (<span class="id"><a href="CDF.FUN.html#Cond">Cond</a></span> <span class="id">a</span>' <span class="id">ifso</span> <span class="id">ifnot</span>).<br/>
<br/>
<h3> Exercise (1 star) </h3>
<div class="doc">Modify <span class="bracket"><span class="id">red</span></span> to obtain a call-by-name semantics.
    What is the impact of this change on the results in the remainder
    of this module? </div>
<br/>
<h3> Exercise (2 stars) </h3>
<div class="doc">Extend the syntax and the semantics of FUN with one or several
    of the features mentioned in the lecture: Peano integers,
    products, sums, fixed points. </div>
<br/>
<div class="doc">Another presentation of the reduction semantics, in the style
    popularized by Wright and Felleisen.  First we define head reductions. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="head_red">head_red</a></span>: <span class="id"><a href="CDF.FUN.html#term">term</a></span> -&gt; <span class="id"><a href="CDF.FUN.html#term">term</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="head_red_beta">head_red_beta</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">a</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.FUN.html#isvalue">isvalue</a></span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">head_red</span> (<span class="id"><a href="CDF.FUN.html#App">App</a></span> (<span class="id"><a href="CDF.FUN.html#Abs">Abs</a></span> <span class="id">x</span> <span class="id">a</span>) <span class="id">v</span>) (<span class="id"><a href="CDF.FUN.html#subst">subst</a></span> <span class="id">a</span> <span class="id">x</span> <span class="id">v</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="head_red_cond">head_red_cond</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">ifso</span> <span class="id">ifnot</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">head_red</span> (<span class="id"><a href="CDF.FUN.html#Cond">Cond</a></span> (<span class="id"><a href="CDF.FUN.html#Const">Const</a></span> <span class="id">b</span>) <span class="id">ifso</span> <span class="id">ifnot</span>) (<span class="kwd">if</span> <span class="id">b</span> <span class="kwd">then</span> <span class="id">ifso</span> <span class="kwd">else</span> <span class="id">ifnot</span>).<br/>
<br/>
<div class="doc">Then we define the reduction contexts.  Contexts are represented by
    functions <span class="bracket"><span class="id">C</span>: <span class="id">term</span> -&gt; <span class="id">term</span></span>.  The inductive predicate
    <span class="bracket"><span class="id">iscontext</span> <span class="id">C</span></span> defines which functions are valid reduction contexts. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="iscontext">iscontext</a></span>: (<span class="id"><a href="CDF.FUN.html#term">term</a></span> -&gt; <span class="id"><a href="CDF.FUN.html#term">term</a></span>) -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="iscontext_hole">iscontext_hole</a></span>:                      <span class="docright">(* at the top  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">iscontext</span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id">a</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="iscontext_app_1">iscontext_app_1</a></span>: <span class="kwd">forall</span> <span class="id">a</span> <span class="id">C</span>,         <span class="docright">(* to the left of an application  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">iscontext</span> <span class="id">C</span> -&gt; <span class="id">iscontext</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="CDF.FUN.html#App">App</a></span> (<span class="id">C</span> <span class="id">x</span>) <span class="id">a</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="iscontext_app_2">iscontext_app_2</a></span>: <span class="kwd">forall</span> <span class="id">v</span> <span class="id">C</span>,         <span class="docright">(* to the right of an application  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.FUN.html#isvalue">isvalue</a></span> <span class="id">v</span> -&gt; <span class="id">iscontext</span> <span class="id">C</span> -&gt; <span class="id">iscontext</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="CDF.FUN.html#App">App</a></span> <span class="id">v</span> (<span class="id">C</span> <span class="id">x</span>))<br/>
&nbsp;&nbsp;| <span class="id"><a name="iscontext_cond">iscontext_cond</a></span>: <span class="kwd">forall</span> <span class="id">C</span> <span class="id">ifso</span> <span class="id">ifnot</span>, <span class="docright">(* under a conditional  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">iscontext</span> <span class="id">C</span> -&gt; <span class="id">iscontext</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="CDF.FUN.html#Cond">Cond</a></span> (<span class="id">C</span> <span class="id">x</span>) <span class="id">ifso</span> <span class="id">ifnot</span>).<br/>
<br/>
<div class="doc">Finally, we define reductions under a context. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="ctx_red">ctx_red</a></span>: <span class="id"><a href="CDF.FUN.html#term">term</a></span> -&gt; <span class="id"><a href="CDF.FUN.html#term">term</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="ctx_red_intro">ctx_red_intro</a></span>: <span class="kwd">forall</span> <span class="id">a</span> <span class="id">a</span>' <span class="id">C</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.FUN.html#head_red">head_red</a></span> <span class="id">a</span> <span class="id">a</span>' -&gt; <span class="id"><a href="CDF.FUN.html#iscontext">iscontext</a></span> <span class="id">C</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ctx_red</span> (<span class="id">C</span> <span class="id">a</span>) (<span class="id">C</span> <span class="id">a</span>').<br/>
<br/>
<div class="doc">Equivalence with the previous definition <span class="bracket"><span class="id">red</span></span>. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="ctx_red_to_red">ctx_red_to_red</a></span>: <br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">a</span>', <span class="id"><a href="CDF.FUN.html#ctx_red">ctx_red</a></span> <span class="id">a</span> <span class="id">a</span>' -&gt; <span class="id"><a href="CDF.FUN.html#red">red</a></span> <span class="id">a</span> <span class="id">a</span>'.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof1')">Proof.</span></div>
<div class="proofscript" id="proof1">
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">REC</span>: <span class="kwd">forall</span> <span class="id">a</span> <span class="id">a</span>', <span class="id"><a href="CDF.FUN.html#head_red">head_red</a></span> <span class="id">a</span> <span class="id">a</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">C</span>, <span class="id"><a href="CDF.FUN.html#iscontext">iscontext</a></span> <span class="id">C</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.FUN.html#red">red</a></span> (<span class="id">C</span> <span class="id">a</span>) (<span class="id">C</span> <span class="id">a</span>')).<br/>
&nbsp;&nbsp;{ <span class="id">intros</span> <span class="id">a</span> <span class="id">a</span>' <span class="id">HR</span>; <span class="id">induction</span> 1.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">HR</span>; <span class="id">subst</span>; <span class="id">constructor</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#red_app_1">red_app_1</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#red_app_2">red_app_2</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#red_cond_1">red_cond_1</a></span>; <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;<span class="id">destruct</span> 1. <span class="id">apply</span> <span class="id">REC</span>; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="red_to_ctx_red">red_to_ctx_red</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">a</span>', <span class="id"><a href="CDF.FUN.html#red">red</a></span> <span class="id">a</span> <span class="id">a</span>' -&gt; <span class="id"><a href="CDF.FUN.html#ctx_red">ctx_red</a></span> <span class="id">a</span> <span class="id">a</span>'.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof2')">Proof.</span></div>
<div class="proofscript" id="proof2">
&nbsp;&nbsp;<span class="id">induction</span> 1.<br/>
- <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#ctx_red_intro">ctx_red_intro</a></span> <span class="kwd">with</span> (<span class="id">C</span> := <span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">x</span>).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#head_red_beta">head_red_beta</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
- <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#ctx_red_intro">ctx_red_intro</a></span> <span class="kwd">with</span> (<span class="id">C</span> := <span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">x</span>).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#head_red_cond">head_red_cond</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
- <span class="id">destruct</span> <span class="id">IHred</span>. <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#ctx_red_intro">ctx_red_intro</a></span> <span class="kwd">with</span> (<span class="id">C</span> := <span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="CDF.FUN.html#App">App</a></span> (<span class="id">C</span> <span class="id">x</span>) <span class="id">a2</span>); <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.FUN.html#iscontext">iscontext</a></span>.<br/>
- <span class="id">destruct</span> <span class="id">IHred</span>. <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#ctx_red_intro">ctx_red_intro</a></span> <span class="kwd">with</span> (<span class="id">C</span> := <span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="CDF.FUN.html#App">App</a></span> <span class="id">v</span> (<span class="id">C</span> <span class="id">x</span>)); <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.FUN.html#iscontext">iscontext</a></span>.<br/>
- <span class="id">destruct</span> <span class="id">IHred</span>. <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#ctx_red_intro">ctx_red_intro</a></span> <span class="kwd">with</span> (<span class="id">C</span> := <span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="CDF.FUN.html#Cond">Cond</a></span> (<span class="id">C</span> <span class="id">x</span>) <span class="id">ifso</span> <span class="id">ifnot</span>); <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.FUN.html#iscontext">iscontext</a></span>.<br/>
Qed.</div>
<br/>
<div class="doc">The natural semantics. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="eval">eval</a></span>: <span class="id"><a href="CDF.FUN.html#term">term</a></span> -&gt; <span class="id"><a href="CDF.FUN.html#term">term</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="eval_abs">eval_abs</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eval</span> (<span class="id"><a href="CDF.FUN.html#Abs">Abs</a></span> <span class="id">x</span> <span class="id">a</span>) (<span class="id"><a href="CDF.FUN.html#Abs">Abs</a></span> <span class="id">x</span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="eval_app">eval_app</a></span>: <span class="kwd">forall</span> <span class="id">a1</span> <span class="id">a2</span> <span class="id">x</span> <span class="id">a</span> <span class="id">v2</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eval</span> <span class="id">a1</span> (<span class="id"><a href="CDF.FUN.html#Abs">Abs</a></span> <span class="id">x</span> <span class="id">a</span>) -&gt; <span class="id">eval</span> <span class="id">a2</span> <span class="id">v2</span> -&gt; <span class="id">eval</span> (<span class="id"><a href="CDF.FUN.html#subst">subst</a></span> <span class="id">a</span> <span class="id">x</span> <span class="id">v2</span>) <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eval</span> (<span class="id"><a href="CDF.FUN.html#App">App</a></span> <span class="id">a1</span> <span class="id">a2</span>) <span class="id">v</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="eval_const">eval_const</a></span>: <span class="kwd">forall</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eval</span> (<span class="id"><a href="CDF.FUN.html#Const">Const</a></span> <span class="id">b</span>) (<span class="id"><a href="CDF.FUN.html#Const">Const</a></span> <span class="id">b</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="eval_cond">eval_cond</a></span>: <span class="kwd">forall</span> <span class="id">a</span> <span class="id">ifso</span> <span class="id">ifnot</span> <span class="id">b</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eval</span> <span class="id">a</span> (<span class="id"><a href="CDF.FUN.html#Const">Const</a></span> <span class="id">b</span>) -&gt; <span class="id">eval</span> (<span class="kwd">if</span> <span class="id">b</span> <span class="kwd">then</span> <span class="id">ifso</span> <span class="kwd">else</span> <span class="id">ifnot</span>) <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eval</span> (<span class="id"><a href="CDF.FUN.html#Cond">Cond</a></span> <span class="id">a</span> <span class="id">ifso</span> <span class="id">ifnot</span>) <span class="id">v</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eval_isvalue">eval_isvalue</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">v</span>, <span class="id"><a href="CDF.FUN.html#eval">eval</a></span> <span class="id">a</span> <span class="id">v</span> -&gt; <span class="id"><a href="CDF.FUN.html#isvalue">isvalue</a></span> <span class="id">v</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof3')">Proof.</span></div>
<div class="proofscript" id="proof3">
&nbsp;&nbsp;<span class="id">induction</span> 1; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.FUN.html#isvalue">isvalue</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="isvalue_eval">isvalue_eval</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span>, <span class="id"><a href="CDF.FUN.html#isvalue">isvalue</a></span> <span class="id">v</span> -&gt; <span class="id"><a href="CDF.FUN.html#eval">eval</a></span> <span class="id">v</span> <span class="id">v</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof4')">Proof.</span></div>
<div class="proofscript" id="proof4">
&nbsp;&nbsp;<span class="id">destruct</span> 1; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.FUN.html#eval">eval</a></span>.<br/>
Qed.</div>
<br/>
<div class="doc">Equivalence between natural semantics <span class="bracket"><span class="id">eval</span> <span class="id">a</span> <span class="id">v</span></span> and reduction semantics
    (there exists a sequence of reductions from term <span class="bracket"><span class="id">a</span></span> to value <span class="bracket"><span class="id">v</span></span>). </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eval_reds">eval_reds</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">v</span>, <span class="id"><a href="CDF.FUN.html#eval">eval</a></span> <span class="id">a</span> <span class="id">v</span> -&gt; <span class="id"><a href="CDF.Sequences.html#star">star</a></span> <span class="id"><a href="CDF.FUN.html#red">red</a></span> <span class="id">a</span> <span class="id">v</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof5')">Proof.</span></div>
<div class="proofscript" id="proof5">
&nbsp;&nbsp;<span class="id">induction</span> 1.<br/>
- <span class="id">apply</span> <span class="id"><a href="CDF.Sequences.html#star_refl">star_refl</a></span>.<br/>
- <span class="id">apply</span> <span class="id"><a href="CDF.Sequences.html#star_trans">star_trans</a></span> <span class="kwd">with</span> (<span class="id"><a href="CDF.FUN.html#App">App</a></span> (<span class="id"><a href="CDF.FUN.html#Abs">Abs</a></span> <span class="id">x</span> <span class="id">a</span>) <span class="id">a2</span>).<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">IHeval1</span>. <span class="id">generalize</span> <span class="id">a1</span>, (<span class="id"><a href="CDF.FUN.html#Abs">Abs</a></span> <span class="id">x</span> <span class="id">a</span>). <span class="id">induction</span> 1; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.Sequences.html#star">star</a></span>, <span class="id"><a href="CDF.FUN.html#red_app_1">red_app_1</a></span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.Sequences.html#star_trans">star_trans</a></span> <span class="kwd">with</span> (<span class="id"><a href="CDF.FUN.html#App">App</a></span> (<span class="id"><a href="CDF.FUN.html#Abs">Abs</a></span> <span class="id">x</span> <span class="id">a</span>) <span class="id">v2</span>).<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">IHeval2</span>. <span class="id">generalize</span> <span class="id">a2</span>, <span class="id">v2</span>. <span class="id">induction</span> 1; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.Sequences.html#star">star</a></span>, <span class="id"><a href="CDF.FUN.html#red_app_2">red_app_2</a></span>, <span class="id"><a href="CDF.FUN.html#isvalue">isvalue</a></span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="CDF.Sequences.html#star_step">star_step</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#red_beta">red_beta</a></span>. <span class="id">eapply</span> <span class="id"><a href="CDF.FUN.html#eval_isvalue">eval_isvalue</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">IHeval3</span>.<br/>
- <span class="id">apply</span> <span class="id"><a href="CDF.Sequences.html#star_refl">star_refl</a></span>.<br/>
- <span class="id">apply</span> <span class="id"><a href="CDF.Sequences.html#star_trans">star_trans</a></span> <span class="kwd">with</span> (<span class="id"><a href="CDF.FUN.html#Cond">Cond</a></span> (<span class="id"><a href="CDF.FUN.html#Const">Const</a></span> <span class="id">b</span>) <span class="id">ifso</span> <span class="id">ifnot</span>).<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">IHeval1</span>. <span class="id">generalize</span> <span class="id">a</span>, (<span class="id"><a href="CDF.FUN.html#Const">Const</a></span> <span class="id">b</span>). <span class="id">induction</span> 1; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.Sequences.html#star">star</a></span>, <span class="id"><a href="CDF.FUN.html#red_cond_1">red_cond_1</a></span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="CDF.Sequences.html#star_step">star_step</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#red_cond">red_cond</a></span>. <br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">IHeval2</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="red_eval_eval">red_eval_eval</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a1</span> <span class="id">a2</span>, <span class="id"><a href="CDF.FUN.html#red">red</a></span> <span class="id">a1</span> <span class="id">a2</span> -&gt; <span class="kwd">forall</span> <span class="id">v</span>, <span class="id"><a href="CDF.FUN.html#eval">eval</a></span> <span class="id">a2</span> <span class="id">v</span> -&gt; <span class="id"><a href="CDF.FUN.html#eval">eval</a></span> <span class="id">a1</span> <span class="id">v</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof6')">Proof.</span></div>
<div class="proofscript" id="proof6">
&nbsp;&nbsp;<span class="id">induction</span> 1; <span class="id">intros</span> <span class="id">v</span>' <span class="id">E</span>.<br/>
- <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.FUN.html#eval">eval</a></span>, <span class="id"><a href="CDF.FUN.html#isvalue_eval">isvalue_eval</a></span>.<br/>
- <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.FUN.html#eval">eval</a></span>.<br/>
- <span class="id">inversion</span> <span class="id">E</span>; <span class="id">subst</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.FUN.html#eval">eval</a></span>.<br/>
- <span class="id">inversion</span> <span class="id">E</span>; <span class="id">subst</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.FUN.html#eval">eval</a></span>, <span class="id"><a href="CDF.FUN.html#isvalue_eval">isvalue_eval</a></span>.<br/>
- <span class="id">inversion</span> <span class="id">E</span>; <span class="id">subst</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.FUN.html#eval">eval</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="reds_eval">reds_eval</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">v</span>, <span class="id"><a href="CDF.Sequences.html#star">star</a></span> <span class="id"><a href="CDF.FUN.html#red">red</a></span> <span class="id">a</span> <span class="id">v</span> -&gt; <span class="id"><a href="CDF.FUN.html#isvalue">isvalue</a></span> <span class="id">v</span> -&gt; <span class="id"><a href="CDF.FUN.html#eval">eval</a></span> <span class="id">a</span> <span class="id">v</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof7')">Proof.</span></div>
<div class="proofscript" id="proof7">
&nbsp;&nbsp;<span class="id">induction</span> 1; <span class="id">intros</span>.<br/>
- <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#isvalue_eval">isvalue_eval</a></span>; <span class="id">auto</span>.<br/>
- <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#red_eval_eval">red_eval_eval</a></span> <span class="kwd">with</span> <span class="id">b</span>; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<h2> 7.2.  Simple types </h2>
<br/>
<div class="doc">The type algebra. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="type">type</a></span>: <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="Bool">Bool</a></span>                          <span class="docright">(* the type of Booleans  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="Fun">Fun</a></span> (<span class="id">t1</span>: <span class="id">type</span>) (<span class="id">t2</span>: <span class="id">type</span>).    <span class="docright">(* the type of functions from <span class="bracket"><span class="id">t1</span></span> to <span class="bracket"><span class="id">t2</span></span>  *)</span><br/>
<br/>
<span class="kwd">Notation</span> " <span class="id">t1</span> --&gt; <span class="id">t2</span> " := (<span class="id"><a href="CDF.FUN.html#Fun">Fun</a></span> <span class="id">t1</span> <span class="id">t2</span>) (<span class="id">right</span> <span class="id">associativity</span>, <span class="kwd">at</span> <span class="id">level</span> 55).<br/>
<br/>
<div class="doc">Typing contexts associate a type to each free variable. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="context">context</a></span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string">string</a></span> * <span class="id"><a href="CDF.FUN.html#type">type</a></span>).<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="lookup">lookup</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">x</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string">string</a></span>) (<span class="id">l</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string">string</a></span> * <span class="id">A</span>)) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">A</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;| (<span class="id">y</span>, <span class="id">a</span>) :: <span class="id">l</span> =&gt; <span class="kwd">if</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x</span> <span class="id">y</span> <span class="kwd">then</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">a</span> <span class="kwd">else</span> <span class="id">lookup</span> <span class="id">x</span> <span class="id">l</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">The typing rules. </div>
<br/>
<span class="kwd">Reserved</span> <span class="kwd">Notation</span> "<span class="id">E</span> '⊢' <span class="id">a</span> '∈' <span class="id">t</span>" (<span class="kwd">at</span> <span class="id">level</span> 40).<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="has_type">has_type</a></span> : <span class="id"><a href="CDF.FUN.html#context">context</a></span> -&gt; <span class="id"><a href="CDF.FUN.html#term">term</a></span> -&gt; <span class="id"><a href="CDF.FUN.html#type">type</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="T_Var">T_Var</a></span>: <span class="kwd">forall</span> <span class="id">E</span> <span class="id">x</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.FUN.html#lookup">lookup</a></span> <span class="id">x</span> <span class="id">E</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">E</span> ⊢ <span class="id"><a href="CDF.FUN.html#Var">Var</a></span> <span class="id">x</span> ∈ <span class="id">t</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="T_Abs">T_Abs</a></span> : <span class="kwd">forall</span> <span class="id">E</span> <span class="id">x</span> <span class="id">a</span> <span class="id">t</span> <span class="id">t</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id">x</span>, <span class="id">t</span>) :: <span class="id">E</span>) ⊢ <span class="id">a</span> ∈ <span class="id">t</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">E</span> ⊢ <span class="id"><a href="CDF.FUN.html#Abs">Abs</a></span> <span class="id">x</span> <span class="id">a</span> ∈ <span class="id"><a href="CDF.FUN.html#Fun">Fun</a></span> <span class="id">t</span> <span class="id">t</span>'<br/>
&nbsp;&nbsp;| <span class="id"><a name="T_App">T_App</a></span> : <span class="kwd">forall</span> <span class="id">E</span> <span class="id">a1</span> <span class="id">a2</span> <span class="id">t</span> <span class="id">t</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">E</span> ⊢ <span class="id">a1</span> ∈ <span class="id"><a href="CDF.FUN.html#Fun">Fun</a></span> <span class="id">t</span> <span class="id">t</span>' -&gt; <span class="id">E</span> ⊢ <span class="id">a2</span> ∈ <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">E</span> ⊢ <span class="id"><a href="CDF.FUN.html#App">App</a></span> <span class="id">a1</span> <span class="id">a2</span> ∈ <span class="id">t</span>'<br/>
&nbsp;&nbsp;| <span class="id"><a name="T_Const">T_Const</a></span> : <span class="kwd">forall</span> <span class="id">E</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">E</span> ⊢ <span class="id"><a href="CDF.FUN.html#Const">Const</a></span> <span class="id">b</span> ∈ <span class="id"><a href="CDF.FUN.html#Bool">Bool</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a name="T_Cond">T_Cond</a></span> : <span class="kwd">forall</span> <span class="id">E</span> <span class="id">a</span> <span class="id">ifso</span> <span class="id">ifnot</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">E</span> ⊢ <span class="id">a</span> ∈ <span class="id"><a href="CDF.FUN.html#Bool">Bool</a></span> -&gt; <span class="id">E</span> ⊢ <span class="id">ifso</span> ∈ <span class="id">t</span> -&gt; <span class="id">E</span> ⊢ <span class="id">ifnot</span> ∈ <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">E</span> ⊢ <span class="id"><a href="CDF.FUN.html#Cond">Cond</a></span> <span class="id">a</span> <span class="id">ifso</span> <span class="id">ifnot</span> ∈ <span class="id">t</span><br/>
<br/>
<span class="kwd">where</span> "<span class="id">E</span> '⊢' <span class="id">a</span> '∈' <span class="id">t</span>" := (<span class="id"><a href="CDF.FUN.html#has_type">has_type</a></span> <span class="id">E</span> <span class="id">a</span> <span class="id">t</span>).<br/>
<br/>
<div class="doc">The main properties of the typing judgment.
    First, the weakening property. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="weakening">weakening</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">E</span> <span class="id">a</span> <span class="id">t</span>, <br/>
&nbsp;&nbsp;<span class="id">E</span> ⊢ <span class="id">a</span> ∈ <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">E</span>',<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span> <span class="id">tx</span>, <span class="id"><a href="CDF.FUN.html#lookup">lookup</a></span> <span class="id">x</span> <span class="id">E</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">tx</span> -&gt; <span class="id"><a href="CDF.FUN.html#lookup">lookup</a></span> <span class="id">x</span> <span class="id">E</span>' = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">tx</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">E</span>' ⊢ <span class="id">a</span> ∈ <span class="id">t</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof8')">Proof.</span></div>
<div class="proofscript" id="proof8">
&nbsp;&nbsp;<span class="id">induction</span> 1; <span class="id">intros</span> <span class="id">E</span>' <span class="id">W</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.FUN.html#has_type">has_type</a></span>.<br/>
- <span class="comment">(*&nbsp;Abs&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#T_Abs">T_Abs</a></span>. <span class="id">apply</span> <span class="id">IHhas_type</span>.<br/>
&nbsp;&nbsp;<span class="id">cbn</span>; <span class="id">intros</span>. <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x0</span> <span class="id">x</span>); <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Weakening is stated in an unusual manner.
    Usually, it is stated with a syntactic concatenation of contexts:
    if <span class="bracket"><span class="id">E</span> ⊢ <span class="id">a</span> ∈ <span class="id">t</span></span>, then <span class="bracket"><span class="id">E</span>' ++ <span class="id">E</span> ⊢ <span class="id">a</span> ∈ <span class="id">t</span></span>.  However, this statement
    is false if <span class="bracket"><span class="id">E</span>'</span> can bound variables that are already bound in <span class="bracket"><span class="id">E</span></span>.
    On paper, we implicitly assume that a context never binds the same
    variable twice, a constraint that can always be satisfied by
    renaming some variables.
    In our Coq development, we have no renaming nor constraints over
    contexts.  Instead, we use two arbitrary contexts <span class="bracket"><span class="id">E</span></span> and <span class="bracket"><span class="id">E</span>'</span>,
    connected by the hypothesis
    "any variable that is given a type by <span class="bracket"><span class="id">E</span></span> is given the same type in <span class="bracket"><span class="id">E</span>'</span>".
</div>
<br/>
<div class="doc">The next property is stability of typing under substitution.
    It uses the same trick to connect
<ul>
<li>
   the context <span class="bracket"><span class="id">E</span></span> in which term <span class="bracket"><span class="id">a</span></span> is typed before substitution;
</li>
<li>
   the context <span class="bracket"><span class="id">E</span>'</span> in which the term <span class="bracket"><span class="id">subst</span> <span class="id">a</span> <span class="id">x</span> <span class="id">c</span></span> is typed after
    substitution.
</li>
</ul>
    Moreover, the lemma requires that <span class="bracket"><span class="id">c</span></span> is typed in the empty
    environment, guaranteeing that <span class="bracket"><span class="id">c</span></span> is closed and that the substitution
    <span class="bracket"><span class="id">subst</span> <span class="id">a</span> <span class="id">x</span> <span class="id">c</span></span> avoids variable capture. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="substitution_preserves_typing">substitution_preserves_typing</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">E</span> <span class="id">a</span> <span class="id">t</span>, <br/>
&nbsp;&nbsp;<span class="id">E</span> ⊢ <span class="id">a</span> ∈ <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">c</span> <span class="id">t</span>' <span class="id">E</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> ⊢ <span class="id">c</span> ∈ <span class="id">t</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.FUN.html#lookup">lookup</a></span> <span class="id">x</span> <span class="id">E</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">t</span>' -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">y</span> <span class="id">ty</span>, <span class="id">y</span> &lt;&gt; <span class="id">x</span> -&gt; <span class="id"><a href="CDF.FUN.html#lookup">lookup</a></span> <span class="id">y</span> <span class="id">E</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">ty</span> -&gt; <span class="id"><a href="CDF.FUN.html#lookup">lookup</a></span> <span class="id">y</span> <span class="id">E</span>' = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">ty</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">E</span>' ⊢ <span class="id"><a href="CDF.FUN.html#subst">subst</a></span> <span class="id">a</span> <span class="id">x</span> <span class="id">c</span> ∈ <span class="id">t</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof9')">Proof.</span></div>
<div class="proofscript" id="proof9">
&nbsp;&nbsp;<span class="id">induction</span> 1; <span class="id">intros</span> <span class="id">until</span> <span class="id">E</span>'; <span class="id">intros</span> <span class="id">TYC</span> <span class="id">TYX</span> <span class="id">TYE</span>; <span class="id">cbn</span>.<br/>
- <span class="comment">(*&nbsp;Var&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x0</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Var&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">replace</span> <span class="id">t</span> <span class="kwd">with</span> <span class="id">t</span>' <span class="kwd">by</span> <span class="id">congruence</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#weakening">weakening</a></span> <span class="kwd">with</span> (<span class="id">E</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cbn</span>; <span class="id">intros</span>; <span class="id">discriminate</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Var&nbsp;y,&nbsp;y&nbsp;&lt;&gt;&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#T_Var">T_Var</a></span>. <span class="id">apply</span> <span class="id">TYE</span>; <span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;Abs&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x0</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Abs&nbsp;x&nbsp;a&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subst</span> <span class="id">x0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#T_Abs">T_Abs</a></span>. <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#weakening">weakening</a></span> <span class="kwd">with</span> (<span class="id">E</span> := (<span class="id">x</span>, <span class="id">t</span>) :: <span class="id">E</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cbn</span>; <span class="id">intros</span>. <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x0</span> <span class="id">x</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Abs&nbsp;y&nbsp;a,&nbsp;y&nbsp;&lt;&gt;&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#T_Abs">T_Abs</a></span>. <span class="id">eapply</span> <span class="id">IHhas_type</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cbn</span>. <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x0</span> <span class="id">x</span>); <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cbn</span>; <span class="id">intros</span>. <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">y</span> <span class="id">x</span>); <span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;App&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#T_App">T_App</a></span> <span class="kwd">with</span> <span class="id">t</span>; <span class="id">eauto</span>.<br/>
- <span class="comment">(*&nbsp;Const&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#T_Const">T_Const</a></span>.<br/>
- <span class="comment">(*&nbsp;Cond&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#T_Cond">T_Cond</a></span>; <span class="id">eauto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Finally, here is the "canonical forms" lemma, showing that the type
    of a closed value determines its shape. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="canonical_forms">canonical_forms</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> ⊢ <span class="id">v</span> ∈ <span class="id">t</span> -&gt; <span class="id"><a href="CDF.FUN.html#isvalue">isvalue</a></span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">t</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.FUN.html#Bool">Bool</a></span> =&gt; <span class="kwd">exists</span> <span class="id">b</span>, <span class="id">v</span> = <span class="id"><a href="CDF.FUN.html#Const">Const</a></span> <span class="id">b</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.FUN.html#Fun">Fun</a></span> <span class="id">t1</span> <span class="id">t2</span> =&gt; <span class="kwd">exists</span> <span class="id">x</span> <span class="id">a</span>, <span class="id">v</span> = <span class="id"><a href="CDF.FUN.html#Abs">Abs</a></span> <span class="id">x</span> <span class="id">a</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof10')">Proof.</span></div>
<div class="proofscript" id="proof10">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v</span> <span class="id">t</span> <span class="id">TY</span> <span class="id">VAL</span>. <span class="id">inversion</span> <span class="id">VAL</span>; <span class="id">subst</span>; <span class="id">inversion</span> <span class="id">TY</span>; <span class="id">subst</span>.<br/>
- <span class="comment">(*&nbsp;Fun&nbsp;type&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">x</span>, <span class="id">a</span>; <span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;Bool&nbsp;type&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">b</span>; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">We can, then, prove the two crucial properties that connect typing
    with reductions: preservation and progress. </div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="reduction_preserves_typing">reduction_preserves_typing</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">a</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.FUN.html#red">red</a></span> <span class="id">a</span> <span class="id">a</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> ⊢ <span class="id">a</span> ∈ <span class="id">t</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> ⊢ <span class="id">a</span>' ∈ <span class="id">t</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof11')">Proof.</span></div>
<div class="proofscript" id="proof11">
&nbsp;&nbsp;<span class="id">induction</span> 1; <span class="id">intros</span> <span class="id">t</span> <span class="id">TY</span>.<br/>
- <span class="comment">(*&nbsp;red_beta&nbsp;*)</span> <br/>
&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">TY</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">H3</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="CDF.FUN.html#substitution_preserves_typing">substitution_preserves_typing</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">cbn</span>. <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x</span> <span class="id">x</span>); <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;<span class="id">cbn</span>; <span class="id">intros</span>. <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">y</span> <span class="id">x</span>); <span class="id">congruence</span>.<br/>
- <span class="comment">(*&nbsp;red_cond&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">TY</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">b</span>; <span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;red_app_1&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">TY</span>; <span class="id">subst</span>. <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#T_App">T_App</a></span> <span class="kwd">with</span> <span class="id">t0</span>; <span class="id">eauto</span>. <br/>
- <span class="comment">(*&nbsp;red_app_2&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">TY</span>; <span class="id">subst</span>. <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#T_App">T_App</a></span> <span class="kwd">with</span> <span class="id">t0</span>; <span class="id">eauto</span>. <br/>
- <span class="comment">(*&nbsp;red_cond_1&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">TY</span>; <span class="id">subst</span>. <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#T_Cond">T_Cond</a></span>; <span class="id">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="progress">progress</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> ⊢ <span class="id">a</span> ∈ <span class="id">t</span> -&gt; <span class="id"><a href="CDF.FUN.html#isvalue">isvalue</a></span> <span class="id">a</span> \/ <span class="kwd">exists</span> <span class="id">a</span>', <span class="id"><a href="CDF.FUN.html#red">red</a></span> <span class="id">a</span> <span class="id">a</span>'.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof12')">Proof.</span></div>
<div class="proofscript" id="proof12">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">t</span> <span class="id">TY</span>; <span class="id">dependent</span> <span class="id">induction</span> <span class="id">TY</span>.<br/>
- <span class="comment">(*&nbsp;Abs&nbsp;x&nbsp;a&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">left</span>; <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#V_Abs">V_Abs</a></span>.<br/>
- <span class="comment">(*&nbsp;App&nbsp;a1&nbsp;a2&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">IHTY1</span> <span class="kwd">as</span> [<span class="id">ISVAL1</span> | (<span class="id">a1</span>' &amp; <span class="id">RED1</span>)]; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="id">destruct</span> <span class="id">IHTY2</span> <span class="kwd">as</span> [<span class="id">ISVAL2</span> | (<span class="id">a2</span>' &amp; <span class="id">RED2</span>)]; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;a1&nbsp;et&nbsp;a2&nbsp;sont&nbsp;des&nbsp;valeurs&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.FUN.html#canonical_forms">canonical_forms</a></span> <span class="id">a1</span> (<span class="id"><a href="CDF.FUN.html#Fun">Fun</a></span> <span class="id">t</span> <span class="id">t</span>')) <span class="kwd">as</span> (<span class="id">x</span> &amp; <span class="id">a</span> &amp; <span class="id">E</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subst</span> <span class="id">a1</span>. <span class="id">right</span>; <span class="kwd">exists</span> (<span class="id"><a href="CDF.FUN.html#subst">subst</a></span> <span class="id">a</span> <span class="id">x</span> <span class="id">a2</span>). <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#red_beta">red_beta</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;a1&nbsp;est&nbsp;une&nbsp;valeur,&nbsp;a2&nbsp;se&nbsp;réduit&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="kwd">exists</span> (<span class="id"><a href="CDF.FUN.html#App">App</a></span> <span class="id">a1</span> <span class="id">a2</span>'). <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#red_app_2">red_app_2</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;a1&nbsp;se&nbsp;réduit&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="kwd">exists</span> (<span class="id"><a href="CDF.FUN.html#App">App</a></span> <span class="id">a1</span>' <span class="id">a2</span>). <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#red_app_1">red_app_1</a></span>; <span class="id">auto</span>.<br/>
- <span class="comment">(*&nbsp;Const&nbsp;b&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">left</span>; <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#V_Const">V_Const</a></span>.<br/>
- <span class="comment">(*&nbsp;Cond&nbsp;a&nbsp;ifso&nbsp;ifnot&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">IHTY1</span> <span class="kwd">as</span> [<span class="id">ISVAL1</span> | (<span class="id">a</span>' &amp; <span class="id">RED1</span>)]; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;a&nbsp;est&nbsp;une&nbsp;valeur&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.FUN.html#canonical_forms">canonical_forms</a></span> <span class="id">a</span> <span class="id"><a href="CDF.FUN.html#Bool">Bool</a></span>) <span class="kwd">as</span> (<span class="id">b</span> &amp; <span class="id">E</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subst</span> <span class="id">a</span>. <span class="id">right</span>; <span class="kwd">exists</span> (<span class="kwd">if</span> <span class="id">b</span> <span class="kwd">then</span> <span class="id">ifso</span> <span class="kwd">else</span> <span class="id">ifnot</span>). <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#red_cond">red_cond</a></span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;a&nbsp;se&nbsp;réduit&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="kwd">exists</span> (<span class="id"><a href="CDF.FUN.html#Cond">Cond</a></span> <span class="id">a</span>' <span class="id">ifso</span> <span class="id">ifnot</span>). <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#red_cond_1">red_cond_1</a></span>; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Type soundness follows: a well-typed closed term does not go wrong. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="goes_wrong">goes_wrong</a></span> (<span class="id">a</span>: <span class="id"><a href="CDF.FUN.html#term">term</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">a</span>', <span class="id"><a href="CDF.Sequences.html#star">star</a></span> <span class="id"><a href="CDF.FUN.html#red">red</a></span> <span class="id">a</span> <span class="id">a</span>' /\ <span class="id"><a href="CDF.Sequences.html#irred">irred</a></span> <span class="id"><a href="CDF.FUN.html#red">red</a></span> <span class="id">a</span>' /\ ~<span class="id"><a href="CDF.FUN.html#isvalue">isvalue</a></span> <span class="id">a</span>'.<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="well_typed_programs_do_not_go_wrong">well_typed_programs_do_not_go_wrong</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> ⊢ <span class="id">a</span> ∈ <span class="id">t</span> -&gt; ~ <span class="id"><a href="CDF.FUN.html#goes_wrong">goes_wrong</a></span> <span class="id">a</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof13')">Proof.</span></div>
<div class="proofscript" id="proof13">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">t</span> <span class="id">TY</span> (<span class="id">a</span>' &amp; <span class="id">REDS</span> &amp; <span class="id">IRRED</span> &amp; <span class="id">NOTVAL</span>).<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">TY</span>': <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> ⊢ <span class="id">a</span>' ∈ <span class="id">t</span>).<br/>
&nbsp;&nbsp;{ <span class="id">clear</span> <span class="id">IRRED</span> <span class="id">NOTVAL</span>. <span class="id">revert</span> <span class="id">a</span> <span class="id">a</span>' <span class="id">REDS</span> <span class="id">TY</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> 1; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.FUN.html#reduction_preserves_typing">reduction_preserves_typing</a></span>. }<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.FUN.html#progress">progress</a></span> <span class="id">a</span>' <span class="id">t</span> <span class="id">TY</span>') <span class="kwd">as</span> [<span class="id">ISVAL</span> | (<span class="id">a</span>'' &amp; <span class="id">RED</span>)].<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id">NOTVAL</span>. <span class="id">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id">IRRED</span> <span class="kwd">with</span> <span class="id">a</span>''. <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">A more positive presentation of the type soundness  result.
    We define coinductively the predicate <span class="bracket"><span class="id">safe</span> <span class="id">a</span></span>, meaning
    "a executes without going wrong".  It covers both the case
    where the reduction of <span class="bracket"><span class="id">a</span></span> terminates on a value, and the
    case where the reduction of <span class="bracket"><span class="id">a</span></span> diverges. </div>
<br/>
<span class="kwd">CoInductive</span> <span class="id"><a name="safe">safe</a></span>: <span class="id"><a href="CDF.FUN.html#term">term</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="safe_value">safe_value</a></span>: <span class="kwd">forall</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.FUN.html#isvalue">isvalue</a></span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">safe</span> <span class="id">v</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="safe_red">safe_red</a></span>: <span class="kwd">forall</span> <span class="id">a</span> <span class="id">a</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.FUN.html#red">red</a></span> <span class="id">a</span> <span class="id">a</span>' -&gt; <span class="id">safe</span> <span class="id">a</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">safe</span> <span class="id">a</span>.<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="well_typed_programs_are_safe">well_typed_programs_are_safe</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> ⊢ <span class="id">a</span> ∈ <span class="id">t</span> -&gt; <span class="id"><a href="CDF.FUN.html#safe">safe</a></span> <span class="id">a</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof14')">Proof.</span></div>
<div class="proofscript" id="proof14">
&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">CIH</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="CDF.FUN.html#progress">progress</a></span> <span class="id">a</span> <span class="id">t</span> <span class="id">H</span>) <span class="kwd">as</span> [<span class="id">ISVAL</span> | (<span class="id">a</span>' &amp; <span class="id">RED</span>)].<br/>
- <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#safe_value">safe_value</a></span>; <span class="id">auto</span>.<br/>
- <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#safe_red">safe_red</a></span> <span class="kwd">with</span> <span class="id">a</span>'; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">CIH</span> <span class="kwd">with</span> <span class="id">t</span>. <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#reduction_preserves_typing">reduction_preserves_typing</a></span> <span class="kwd">with</span> <span class="id">a</span>; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<h3> Exercise (2 or 3 stars) </h3>
<div class="doc">Extend the type system with one or several of the features
    mentioned in the lecture: Peano integers, products, sums, fixed points.
    Update the proof of type soundness accordingly. </div>
<br/>
<h3> Exercise (3 stars) </h3>
<div class="doc">In the definition of the type algebra, replace <span class="bracket"><span class="kwd">Inductive</span> <span class="id">type</span> ...</span>
    by <span class="bracket"><span class="kwd">CoInductive</span> <span class="id">type</span> ...</span>.
    This makes it possible to work with infinite type expressions
    such as <span class="bracket"><span class="id">Bool</span> --&gt; <span class="id">Bool</span> --&gt; ... --&gt; <span class="id">Bool</span> --&gt; ...</span>.
<ul>
<li>
   Check that the proof of type soundness still works.
</li>
<li>
   Show that we can type the fixed-point combinator <span class="bracket"><span class="id">Y</span></span> shown
    in the lecture, giving it the type <span class="bracket">(<span class="id">t</span> --&gt; <span class="id">t</span>) --&gt; <span class="id">t</span></span> for any type <span class="bracket"><span class="id">t</span></span>. </li>
</ul>
</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="type_Y">type_Y</a></span>: <span class="kwd">forall</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">D</span> := <span class="id"><a href="CDF.FUN.html#Abs">Abs</a></span> "<span class="id">x</span>" (<span class="id"><a href="CDF.FUN.html#App">App</a></span> (<span class="id"><a href="CDF.FUN.html#Var">Var</a></span> "<span class="id">f</span>") (<span class="id"><a href="CDF.FUN.html#App">App</a></span> (<span class="id"><a href="CDF.FUN.html#Var">Var</a></span> "<span class="id">x</span>") (<span class="id"><a href="CDF.FUN.html#Var">Var</a></span> "<span class="id">x</span>"))) <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Y</span> := <span class="id"><a href="CDF.FUN.html#Abs">Abs</a></span> "<span class="id">f</span>" (<span class="id"><a href="CDF.FUN.html#App">App</a></span> <span class="id">D</span> <span class="id">D</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> ⊢ <span class="id">Y</span> ∈ ((<span class="id">t</span> --&gt; <span class="id">t</span>) --&gt; <span class="id">t</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof15')">Proof.</span></div>
<div class="proofscript" id="proof15">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t</span> <span class="id">D</span> <span class="id">Y</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/>
Abort.</div>
<br/>
<h3> Exercise (3 stars) </h3>
<div class="doc">Write a type-checker for our type system with simple types.
    It's a function <span class="bracket"><span class="id">context</span> -&gt; <span class="id">term</span> -&gt; <span class="id">option</span> <span class="id">type</span></span>
    that checks whether a term is well-typed in a given context.
    If yes, the type of the term is returned; if not, <span class="bracket"><span class="id">None</span></span> is returned.
    Prove that this type-checker is sound and complete with respect
    to the typing rules. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="typecheck">typecheck</a></span> (<span class="id">E</span>: <span class="id"><a href="CDF.FUN.html#context">context</a></span>) (<span class="id">a</span>: <span class="id"><a href="CDF.FUN.html#term">term</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CDF.FUN.html#type">type</a></span> :=<br/>
 <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="typecheck_sound">typecheck_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">E</span> <span class="id">a</span> <span class="id">t</span>, <span class="id"><a href="CDF.FUN.html#typecheck">typecheck</a></span> <span class="id">E</span> <span class="id">a</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">t</span> -&gt; <span class="id"><a href="CDF.FUN.html#has_type">has_type</a></span> <span class="id">E</span> <span class="id">a</span> <span class="id">t</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof16')">Proof.</span></div>
<div class="proofscript" id="proof16">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">E</span> <span class="id">a</span>; <span class="id">revert</span> <span class="id">a</span> <span class="id">E</span>; <span class="id">induction</span> <span class="id">a</span>; <span class="id">cbn</span>; <span class="id">intros</span> <span class="id">E</span> <span class="id">t</span> <span class="id">T</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/>
Abort.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="typecheck_complete">typecheck_complete</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">E</span> <span class="id">a</span> <span class="id">t</span>, <span class="id"><a href="CDF.FUN.html#has_type">has_type</a></span> <span class="id">E</span> <span class="id">a</span> <span class="id">t</span> -&gt; <span class="id"><a href="CDF.FUN.html#typecheck">typecheck</a></span> <span class="id">E</span> <span class="id">a</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">t</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof17')">Proof.</span></div>
<div class="proofscript" id="proof17">
&nbsp;&nbsp;<span class="id">induction</span> 1; <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/>
Abort.</div>
<br/>
<h2> 7.3.  Subtyping </h2>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="Subtyping">Subtyping</a></span>.<br/>
<br/>
<div class="doc">We extend the type algebra with <span class="bracket"><span class="id">Top</span></span>, the universal type of all values. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="Subtyping.type">type</a></span>: <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="Subtyping.Top">Top</a></span>                           <span class="docright">(* universal type  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="Subtyping.Bool">Bool</a></span>                          <span class="docright">(* type of Booleans  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="Subtyping.Fun">Fun</a></span> (<span class="id">t1</span>: <span class="id">type</span>) (<span class="id">t2</span>: <span class="id">type</span>).    <span class="docright">(* type of functions from <span class="bracket"><span class="id">t1</span></span> to <span class="bracket"><span class="id">t2</span></span>  *)</span><br/>
<br/>
<span class="kwd">Reserved</span> <span class="kwd">Notation</span> "<span class="id">t</span> '&lt;:' <span class="id">s</span>" (<span class="kwd">at</span> <span class="id">level</span> 40).<br/>
<br/>
<div class="doc">The subtyping relation.  Intuitively, <span class="bracket"><span class="id">t</span></span> is subtype of <span class="bracket"><span class="id">s</span></span>
    if every value of type <span class="bracket"><span class="id">t</span></span> can be used with type <span class="bracket"><span class="id">s</span></span>. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="Subtyping.subtype">subtype</a></span>: <span class="id"><a href="CDF.FUN.html#Subtyping.type">type</a></span> -&gt; <span class="id"><a href="CDF.FUN.html#Subtyping.type">type</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="Subtyping.subtype_top">subtype_top</a></span>: <span class="kwd">forall</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">t</span> &lt;: <span class="id"><a href="CDF.FUN.html#Subtyping.Top">Top</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a name="Subtyping.subtype_bool">subtype_bool</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.FUN.html#Subtyping.Bool">Bool</a></span> &lt;: <span class="id"><a href="CDF.FUN.html#Subtyping.Bool">Bool</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a name="Subtyping.subtype_fun">subtype_fun</a></span>: <span class="kwd">forall</span> <span class="id">s1</span> <span class="id">t1</span> <span class="id">s2</span> <span class="id">t2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">s2</span> &lt;: <span class="id">s1</span> -&gt; <span class="id">t1</span> &lt;: <span class="id">t2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.FUN.html#Subtyping.Fun">Fun</a></span> <span class="id">s1</span> <span class="id">t1</span> &lt;: <span class="id"><a href="CDF.FUN.html#Subtyping.Fun">Fun</a></span> <span class="id">s2</span> <span class="id">t2</span><br/>
<br/>
<span class="kwd">where</span> "<span class="id">t</span> '&lt;:' <span class="id">s</span>" := (<span class="id"><a href="CDF.FUN.html#Subtyping.subtype">subtype</a></span> <span class="id">t</span> <span class="id">s</span>).<br/>
<br/>
<div class="doc">Every type is subtype of itself. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Subtyping.subtype_refl">subtype_refl</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>, <span class="id">t</span> &lt;: <span class="id">t</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof18')">Proof.</span></div>
<div class="proofscript" id="proof18">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">t</span>; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.FUN.html#Subtyping.subtype">subtype</a></span>.<br/>
Qed.</div>
<br/>
<div class="doc">The subtyping relation is transitive. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Subtyping.subtype_trans">subtype_trans</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">t3</span>, <span class="id">t1</span> &lt;: <span class="id">t2</span> -&gt; <span class="id">t2</span> &lt;: <span class="id">t3</span> -&gt; <span class="id">t1</span> &lt;: <span class="id">t3</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof19')">Proof.</span></div>
<div class="proofscript" id="proof19">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t1</span> <span class="id">t2</span>; <span class="id">revert</span> <span class="id">t2</span> <span class="id">t1</span>.<br/>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">t2</span>; <span class="id">intros</span> <span class="id">t1</span> <span class="id">t3</span> <span class="id">S1</span> <span class="id">S2</span>; <br/>
&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">S1</span>; <span class="id">inversion</span> <span class="id">S2</span>; <span class="id">subst</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.FUN.html#Subtyping.subtype">subtype</a></span>.<br/>
Qed.</div>
<br/>
<div class="doc">We extend the type system with a subsumption rule <span class="bracket"><span class="id">T_Sub</span></span>
    that allows us to use a term with a super-type of its type. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Subtyping.context">context</a></span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string">string</a></span> * <span class="id"><a href="CDF.FUN.html#Subtyping.type">type</a></span>).<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="Subtyping.has_type">has_type</a></span> : <span class="id"><a href="CDF.FUN.html#Subtyping.context">context</a></span> -&gt; <span class="id"><a href="CDF.FUN.html#term">term</a></span> -&gt; <span class="id"><a href="CDF.FUN.html#Subtyping.type">type</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="Subtyping.T_Var">T_Var</a></span>: <span class="kwd">forall</span> <span class="id">E</span> <span class="id">x</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.FUN.html#lookup">lookup</a></span> <span class="id">x</span> <span class="id">E</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">E</span> ⊢ <span class="id"><a href="CDF.FUN.html#Var">Var</a></span> <span class="id">x</span> ∈ <span class="id">t</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="Subtyping.T_Abs">T_Abs</a></span> : <span class="kwd">forall</span> <span class="id">E</span> <span class="id">x</span> <span class="id">a</span> <span class="id">t</span> <span class="id">t</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id">x</span>, <span class="id">t</span>) :: <span class="id">E</span>) ⊢ <span class="id">a</span> ∈ <span class="id">t</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">E</span> ⊢ <span class="id"><a href="CDF.FUN.html#Abs">Abs</a></span> <span class="id">x</span> <span class="id">a</span> ∈ <span class="id"><a href="CDF.FUN.html#Subtyping.Fun">Fun</a></span> <span class="id">t</span> <span class="id">t</span>'<br/>
&nbsp;&nbsp;| <span class="id"><a name="Subtyping.T_App">T_App</a></span> : <span class="kwd">forall</span> <span class="id">E</span> <span class="id">a1</span> <span class="id">a2</span> <span class="id">t</span> <span class="id">t</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">E</span> ⊢ <span class="id">a1</span> ∈ <span class="id"><a href="CDF.FUN.html#Subtyping.Fun">Fun</a></span> <span class="id">t</span> <span class="id">t</span>' -&gt; <span class="id">E</span> ⊢ <span class="id">a2</span> ∈ <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">E</span> ⊢ <span class="id"><a href="CDF.FUN.html#App">App</a></span> <span class="id">a1</span> <span class="id">a2</span> ∈ <span class="id">t</span>'<br/>
&nbsp;&nbsp;| <span class="id"><a name="Subtyping.T_Const">T_Const</a></span> : <span class="kwd">forall</span> <span class="id">E</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">E</span> ⊢ <span class="id"><a href="CDF.FUN.html#Const">Const</a></span> <span class="id">b</span> ∈ <span class="id"><a href="CDF.FUN.html#Subtyping.Bool">Bool</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a name="Subtyping.T_Cond">T_Cond</a></span> : <span class="kwd">forall</span> <span class="id">E</span> <span class="id">a</span> <span class="id">ifso</span> <span class="id">ifnot</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">E</span> ⊢ <span class="id">a</span> ∈ <span class="id"><a href="CDF.FUN.html#Subtyping.Bool">Bool</a></span> -&gt; <span class="id">E</span> ⊢ <span class="id">ifso</span> ∈ <span class="id">t</span> -&gt; <span class="id">E</span> ⊢ <span class="id">ifnot</span> ∈ <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">E</span> ⊢ <span class="id"><a href="CDF.FUN.html#Cond">Cond</a></span> <span class="id">a</span> <span class="id">ifso</span> <span class="id">ifnot</span> ∈ <span class="id">t</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="Subtyping.T_Sub">T_Sub</a></span>: <span class="kwd">forall</span> <span class="id">E</span> <span class="id">a</span> <span class="id">s</span> <span class="id">t</span>,       <span class="docright">(* &lt;-- new!  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">E</span> ⊢ <span class="id">a</span> ∈ <span class="id">s</span> -&gt; <span class="id">s</span> &lt;: <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">E</span> ⊢ <span class="id">a</span> ∈ <span class="id">t</span><br/>
<br/>
<span class="kwd">where</span> "<span class="id">E</span> '⊢' <span class="id">a</span> '∈' <span class="id">t</span>" := (<span class="id"><a href="CDF.FUN.html#Subtyping.has_type">has_type</a></span> <span class="id">E</span> <span class="id">a</span> <span class="id">t</span>).<br/>
<br/>
<h3> Exercise (3 stars) </h3>
<div class="doc">Prove type soundness for this type system with subtyping.
    The proof in section 7.2 can be reused with very few changes.  
    However, it is necessary to use the following inversion lemmas. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Subtyping.T_Abs_inv">T_Abs_inv</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">E</span> <span class="id">x</span> <span class="id">a</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;<span class="id">E</span> ⊢ <span class="id"><a href="CDF.FUN.html#Abs">Abs</a></span> <span class="id">x</span> <span class="id">a</span> ∈ <span class="id">t</span> -&gt; <span class="kwd">exists</span> <span class="id">t1</span> <span class="id">t2</span>, ((<span class="id">x</span>, <span class="id">t1</span>) :: <span class="id">E</span>) ⊢ <span class="id">a</span> ∈ <span class="id">t2</span> /\ <span class="id"><a href="CDF.FUN.html#Subtyping.Fun">Fun</a></span> <span class="id">t1</span> <span class="id">t2</span> &lt;: <span class="id">t</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof20')">Proof.</span></div>
<div class="proofscript" id="proof20">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">until</span> <span class="id">t</span>; <span class="id">intros</span> <span class="id">TY</span>; <span class="id">dependent</span> <span class="id">induction</span> <span class="id">TY</span>.<br/>
- <span class="kwd">exists</span> <span class="id">t</span>, <span class="id">t</span>'; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.FUN.html#Subtyping.subtype_refl">subtype_refl</a></span>.<br/>
- <span class="id">edestruct</span> <span class="id">IHTY</span> <span class="kwd">as</span> (<span class="id">t1</span> &amp; <span class="id">t2</span> &amp; <span class="id">P</span> &amp; <span class="id">Q</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">t1</span>, <span class="id">t2</span>; <span class="id">split</span>. <span class="id">auto</span>. <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#Subtyping.subtype_trans">subtype_trans</a></span> <span class="kwd">with</span> <span class="id">s</span>; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Subtyping.T_App_inv">T_App_inv</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">E</span> <span class="id">a1</span> <span class="id">a2</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;<span class="id">E</span> ⊢ <span class="id"><a href="CDF.FUN.html#App">App</a></span> <span class="id">a1</span> <span class="id">a2</span> ∈ <span class="id">t</span> -&gt; <span class="kwd">exists</span> <span class="id">t1</span> <span class="id">t2</span>, <span class="id">E</span> ⊢ <span class="id">a1</span> ∈ <span class="id"><a href="CDF.FUN.html#Subtyping.Fun">Fun</a></span> <span class="id">t1</span> <span class="id">t2</span> /\ <span class="id">E</span> ⊢ <span class="id">a2</span> ∈ <span class="id">t1</span> /\ <span class="id">t2</span> &lt;: <span class="id">t</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof21')">Proof.</span></div>
<div class="proofscript" id="proof21">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">until</span> <span class="id">t</span>; <span class="id">intros</span> <span class="id">TY</span>; <span class="id">dependent</span> <span class="id">induction</span> <span class="id">TY</span>.<br/>
- <span class="kwd">exists</span> <span class="id">t</span>, <span class="id">t</span>'; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.FUN.html#Subtyping.subtype_refl">subtype_refl</a></span>.<br/>
- <span class="id">edestruct</span> <span class="id">IHTY</span> <span class="kwd">as</span> (<span class="id">t1</span> &amp; <span class="id">t2</span> &amp; <span class="id">P</span> &amp; <span class="id">Q</span> &amp; <span class="id">R</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">t1</span>, <span class="id">t2</span>; <span class="id">split</span>. <span class="id">auto</span>. <span class="id">split</span>. <span class="id">auto</span>. <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#Subtyping.subtype_trans">subtype_trans</a></span> <span class="kwd">with</span> <span class="id">s</span>; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Subtyping.T_Cond_inv">T_Cond_inv</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">E</span> <span class="id">a</span> <span class="id">ifso</span> <span class="id">ifnot</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;<span class="id">E</span> ⊢ <span class="id"><a href="CDF.FUN.html#Cond">Cond</a></span> <span class="id">a</span> <span class="id">ifso</span> <span class="id">ifnot</span> ∈ <span class="id">t</span> -&gt; <span class="kwd">exists</span> <span class="id">t</span>', <span class="id">E</span> ⊢ <span class="id">a</span> ∈ <span class="id"><a href="CDF.FUN.html#Subtyping.Bool">Bool</a></span> /\ <span class="id">E</span> ⊢ <span class="id">ifso</span> ∈ <span class="id">t</span>' /\ <span class="id">E</span> ⊢ <span class="id">ifnot</span> ∈ <span class="id">t</span>' /\ <span class="id">t</span>' &lt;: <span class="id">t</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof22')">Proof.</span></div>
<div class="proofscript" id="proof22">
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">until</span> <span class="id">t</span>; <span class="id">intros</span> <span class="id">TY</span>; <span class="id">dependent</span> <span class="id">induction</span> <span class="id">TY</span>.<br/>
- <span class="kwd">exists</span> <span class="id">t</span>; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.FUN.html#Subtyping.subtype_refl">subtype_refl</a></span>.<br/>
- <span class="id">edestruct</span> <span class="id">IHTY</span> <span class="kwd">as</span> (<span class="id">t</span>' &amp; <span class="id">P</span> &amp; <span class="id">Q</span> &amp; <span class="id">R</span> &amp; <span class="id">S</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">t</span>'; <span class="id">intuition</span> <span class="id">auto</span>. <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#Subtyping.subtype_trans">subtype_trans</a></span> <span class="kwd">with</span> <span class="id">s</span>; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="Subtyping.well_typed_programs_are_safe">well_typed_programs_are_safe</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> ⊢ <span class="id">a</span> ∈ <span class="id">t</span> -&gt; <span class="id"><a href="CDF.FUN.html#safe">safe</a></span> <span class="id">a</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof23')">Proof.</span></div>
<div class="proofscript" id="proof23">
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/>
Abort.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.FUN.html#Subtyping">Subtyping</a></span>.<br/>
<br/>
<h2> 7.4.  Intrinsically-typed terms </h2>
<br/>
<span class="kwd">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Logic.FunctionalExtensionality.html">FunctionalExtensionality</a></span>.<br/>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="Intrinsic">Intrinsic</a></span>.<br/>
<br/>
<div class="doc">We now develop an abstract syntax for FUN where terms are indexed
    by their types and the contexts in which they are typed. </div>
<br/>
<div class="doc">A context lists the free variables that can occur in the term,
    along with their types.  We use a positional notation (de Bruijn indices)
    for variables.  Consequently, the context is just a list of types:
    <span class="bracket"><span class="id">t1</span> :: ... :: <span class="id">tN</span> :: <span class="id">nil</span></span> is the context that assigns type <span class="bracket"><span class="id">ti</span></span>
    to the variable having index <span class="bracket"><span class="id">i</span></span>, for <span class="bracket"><span class="id">i</span></span> ranging from 1 to <span class="bracket"><span class="id">N</span></span>. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Intrinsic.context">context</a></span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CDF.FUN.html#type">type</a></span>.<br/>
<br/>
<div class="doc"><span class="bracket"><span class="id">var</span> <span class="id">E</span> <span class="id">t</span></span> is the type of variables that can be used in context <span class="bracket"><span class="id">E</span></span>
    with type <span class="bracket"><span class="id">t</span></span>. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="Intrinsic.var">var</a></span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span> -&gt; <span class="id"><a href="CDF.FUN.html#type">type</a></span> -&gt; <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="Intrinsic.V1">V1</a></span>: <span class="kwd">forall</span> {<span class="id">E</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>} {<span class="id">t</span>: <span class="id"><a href="CDF.FUN.html#type">type</a></span>}, <span class="id">var</span> (<span class="id">t</span> :: <span class="id">E</span>) <span class="id">t</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="Intrinsic.VS">VS</a></span>: <span class="kwd">forall</span> {<span class="id">E</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>} {<span class="id">t</span> <span class="id">t</span>': <span class="id"><a href="CDF.FUN.html#type">type</a></span>}, <span class="id">var</span> <span class="id">E</span> <span class="id">t</span>' -&gt; <span class="id">var</span> (<span class="id">t</span> :: <span class="id">E</span>) <span class="id">t</span>'.<br/>
<br/>
<div class="doc">Examples of variables. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Intrinsic.V2">V2</a></span> {<span class="id">E</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>} {<span class="id">t1</span> <span class="id">t2</span>: <span class="id"><a href="CDF.FUN.html#type">type</a></span>}: <span class="id"><a href="CDF.FUN.html#Intrinsic.var">var</a></span> (<span class="id">t1</span> :: <span class="id">t2</span> :: <span class="id">E</span>) <span class="id">t2</span> := <span class="id"><a href="CDF.FUN.html#Intrinsic.VS">VS</a></span> <span class="id"><a href="CDF.FUN.html#Intrinsic.V1">V1</a></span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Intrinsic.V3">V3</a></span> {<span class="id">E</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>} {<span class="id">t1</span> <span class="id">t2</span> <span class="id">t3</span>: <span class="id"><a href="CDF.FUN.html#type">type</a></span>}: <span class="id"><a href="CDF.FUN.html#Intrinsic.var">var</a></span> (<span class="id">t1</span> :: <span class="id">t2</span> :: <span class="id">t3</span> :: <span class="id">E</span>) <span class="id">t3</span> := <span class="id"><a href="CDF.FUN.html#Intrinsic.VS">VS</a></span> <span class="id"><a href="CDF.FUN.html#Intrinsic.V2">V2</a></span>.<br/>
<br/>
<div class="doc"><span class="bracket"><span class="id">term</span> <span class="id">E</span> <span class="id">t</span></span> is the type of terms having type <span class="bracket"><span class="id">t</span></span> in context <span class="bracket"><span class="id">E</span></span>. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="Intrinsic.term">term</a></span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span> -&gt; <span class="id"><a href="CDF.FUN.html#type">type</a></span> -&gt; <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="Intrinsic.Var">Var</a></span>: <span class="kwd">forall</span> {<span class="id">E</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>} {<span class="id">t</span>: <span class="id"><a href="CDF.FUN.html#type">type</a></span>},<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.FUN.html#Intrinsic.var">var</a></span> <span class="id">E</span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">term</span> <span class="id">E</span> <span class="id">t</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="Intrinsic.Abs">Abs</a></span>: <span class="kwd">forall</span> {<span class="id">E</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>} {<span class="id">t</span> <span class="id">t</span>': <span class="id"><a href="CDF.FUN.html#type">type</a></span>},<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">term</span> (<span class="id">t</span> :: <span class="id">E</span>) <span class="id">t</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">term</span> <span class="id">E</span> (<span class="id"><a href="CDF.FUN.html#Fun">Fun</a></span> <span class="id">t</span> <span class="id">t</span>')<br/>
&nbsp;&nbsp;| <span class="id"><a name="Intrinsic.App">App</a></span>: <span class="kwd">forall</span> {<span class="id">E</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>} {<span class="id">t</span> <span class="id">t</span>': <span class="id"><a href="CDF.FUN.html#type">type</a></span>},<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">term</span> <span class="id">E</span> (<span class="id"><a href="CDF.FUN.html#Fun">Fun</a></span> <span class="id">t</span> <span class="id">t</span>') -&gt; <span class="id">term</span> <span class="id">E</span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">term</span> <span class="id">E</span> <span class="id">t</span>'<br/>
&nbsp;&nbsp;| <span class="id"><a name="Intrinsic.Const">Const</a></span>: <span class="kwd">forall</span> {<span class="id">E</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>} (<span class="id">b</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">term</span> <span class="id">E</span> <span class="id"><a href="CDF.FUN.html#Bool">Bool</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a name="Intrinsic.Cond">Cond</a></span>: <span class="kwd">forall</span> {<span class="id">E</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>} {<span class="id">t</span>: <span class="id"><a href="CDF.FUN.html#type">type</a></span>},<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">term</span> <span class="id">E</span> <span class="id"><a href="CDF.FUN.html#Bool">Bool</a></span> -&gt; <span class="id">term</span> <span class="id">E</span> <span class="id">t</span> -&gt; <span class="id">term</span> <span class="id">E</span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">term</span> <span class="id">E</span> <span class="id">t</span>.<br/>
<br/>
<div class="doc">Examples of terms. </div>
<br/>
<div class="doc">The term <span class="bracket"><span class="kwd">fun</span> <span class="id">b</span> =&gt; <span class="kwd">if</span> <span class="id">b</span> <span class="kwd">then</span> <span class="id">false</span> <span class="kwd">else</span> <span class="id">true</span></span>. </div>
<span class="kwd">Definition</span> <span class="id"><a name="Intrinsic.t_negation">t_negation</a></span> : <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> (<span class="id"><a href="CDF.FUN.html#Bool">Bool</a></span> --&gt; <span class="id"><a href="CDF.FUN.html#Bool">Bool</a></span>) :=<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.FUN.html#Intrinsic.Abs">Abs</a></span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.Cond">Cond</a></span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.Var">Var</a></span> <span class="id"><a href="CDF.FUN.html#Intrinsic.V1">V1</a></span>) (<span class="id"><a href="CDF.FUN.html#Intrinsic.Const">Const</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>) (<span class="id"><a href="CDF.FUN.html#Intrinsic.Const">Const</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>)).<br/>
<br/>
<div class="doc">The term <span class="bracket"><span class="kwd">fun</span> <span class="id">f</span> =&gt; <span class="kwd">fun</span> <span class="id">g</span> =&gt; <span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">g</span> (<span class="id">f</span> <span class="id">x</span>)</span>. </div>
<span class="kwd">Definition</span> <span class="id"><a name="Intrinsic.t_compose">t_compose</a></span> (<span class="id">t1</span> <span class="id">t2</span> <span class="id">t3</span>: <span class="id"><a href="CDF.FUN.html#type">type</a></span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> ((<span class="id">t1</span> --&gt; <span class="id">t2</span>) --&gt; (<span class="id">t2</span> --&gt; <span class="id">t3</span>) --&gt; (<span class="id">t1</span> --&gt; <span class="id">t3</span>)) :=<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.FUN.html#Intrinsic.Abs">Abs</a></span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.Abs">Abs</a></span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.Abs">Abs</a></span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.App">App</a></span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.Var">Var</a></span> <span class="id"><a href="CDF.FUN.html#Intrinsic.V2">V2</a></span>) (<span class="id"><a href="CDF.FUN.html#Intrinsic.App">App</a></span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.Var">Var</a></span> <span class="id"><a href="CDF.FUN.html#Intrinsic.V3">V3</a></span>) (<span class="id"><a href="CDF.FUN.html#Intrinsic.Var">Var</a></span> <span class="id"><a href="CDF.FUN.html#Intrinsic.V1">V1</a></span>))))).<br/>
<br/>
<div class="doc">An ill-typed term that, consequently, cannot be expressed. </div>
<span class="kwd">Fail</span> <span class="kwd">Definition</span> <span class="id"><a name="Intrinsic.t_error">t_error</a></span> : <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> <span class="id"><a href="CDF.FUN.html#Bool">Bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.FUN.html#Intrinsic.Cond">Cond</a></span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.Abs">Abs</a></span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.Var">Var</a></span> <span class="id"><a href="CDF.FUN.html#Intrinsic.V1">V1</a></span>)) (<span class="id"><a href="CDF.FUN.html#Intrinsic.Const">Const</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>) (<span class="id"><a href="CDF.FUN.html#Intrinsic.Const">Const</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>).<br/>
<br/>
<div class="doc">We interpret a FUN type expression by a Coq type.  It's the type of
    Coq values that match this FUN type. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="Intrinsic.dtype">dtype</a></span> (<span class="id">t</span>: <span class="id"><a href="CDF.FUN.html#type">type</a></span>) : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">t</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.FUN.html#Bool">Bool</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.FUN.html#Fun">Fun</a></span> <span class="id">t1</span> <span class="id">t2</span> =&gt; <span class="id">dtype</span> <span class="id">t1</span> -&gt; <span class="id">dtype</span> <span class="id">t2</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Likewise, we interpret a typing context by a Coq type.
    It is the type of evaluation environments corresponding to this
    context: an heterogeneous list of the values associated to the variables. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="Intrinsic.dcontext">dcontext</a></span> (<span class="id">E</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>) : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">E</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span><br/>
&nbsp;&nbsp;| <span class="id">t</span> :: <span class="id">E</span> =&gt; <span class="id"><a href="CDF.FUN.html#Intrinsic.dtype">dtype</a></span> <span class="id">t</span> * <span class="id">dcontext</span> <span class="id">E</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">The denotational semantics of a variable.
    It is the value associated to the variable in the evaluation environment. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="Intrinsic.dvar">dvar</a></span> {<span class="id">E</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>} {<span class="id">t</span>: <span class="id"><a href="CDF.FUN.html#type">type</a></span>} (<span class="id">v</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.var">var</a></span> <span class="id">E</span> <span class="id">t</span>): <span class="id"><a href="CDF.FUN.html#Intrinsic.dcontext">dcontext</a></span> <span class="id">E</span> -&gt; <span class="id"><a href="CDF.FUN.html#Intrinsic.dtype">dtype</a></span> <span class="id">t</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.FUN.html#Intrinsic.V1">V1</a></span> =&gt; (<span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">e</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.FUN.html#Intrinsic.VS">VS</a></span> <span class="id">v</span> =&gt; (<span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="id">dvar</span> <span class="id">v</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">e</span>))<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">The denotational semantics of a term.
    It is a function from evaluation environments, <span class="bracket"><span class="id">dcontext</span> <span class="id">E</span></span>,
    to Coq values matching the type of the expression, <span class="bracket"><span class="id">dtype</span> <span class="id">t</span></span>. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="Intrinsic.dterm">dterm</a></span> {<span class="id">E</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>} {<span class="id">t</span>: <span class="id"><a href="CDF.FUN.html#type">type</a></span>} (<span class="id">a</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> <span class="id">E</span> <span class="id">t</span>) : <span class="id"><a href="CDF.FUN.html#Intrinsic.dcontext">dcontext</a></span> <span class="id">E</span> -&gt; <span class="id"><a href="CDF.FUN.html#Intrinsic.dtype">dtype</a></span> <span class="id">t</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">a</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.FUN.html#Intrinsic.Var">Var</a></span> <span class="id">v</span> =&gt; <span class="id"><a href="CDF.FUN.html#Intrinsic.dvar">dvar</a></span> <span class="id">v</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.FUN.html#Intrinsic.Abs">Abs</a></span> <span class="id">a</span> =&gt; (<span class="kwd">fun</span> <span class="id">e</span> =&gt; (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id">dterm</span> <span class="id">a</span> (<span class="id">v</span>, <span class="id">e</span>)))<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.FUN.html#Intrinsic.App">App</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt; (<span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="id">dterm</span> <span class="id">a1</span> <span class="id">e</span> (<span class="id">dterm</span> <span class="id">a2</span> <span class="id">e</span>))<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.FUN.html#Intrinsic.Const">Const</a></span> <span class="id">b</span> =&gt; (<span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="id">b</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.FUN.html#Intrinsic.Cond">Cond</a></span> <span class="id">a</span> <span class="id">ifso</span> <span class="id">ifnot</span> =&gt; (<span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="kwd">if</span> <span class="id">dterm</span> <span class="id">a</span> <span class="id">e</span> <span class="kwd">then</span> <span class="id">dterm</span> <span class="id">ifso</span> <span class="id">e</span> <span class="kwd">else</span> <span class="id">dterm</span> <span class="id">ifnot</span> <span class="id">e</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">The semantics of a beta-redex <span class="bracket"><span class="id">App</span> (<span class="id">Abs</span> <span class="id">a</span>) <span class="id">b</span></span> is just that of the
    binding <span class="bracket"><span class="kwd">let</span> 1 = <span class="id">b</span> <span class="kwd">in</span> <span class="id">a</span></span>: we evaluate <span class="bracket"><span class="id">a</span></span> after binding the
    variable of index 1 to the value of <span class="bracket"><span class="id">b</span></span>. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Intrinsic.dbeta">dbeta</a></span>: <span class="kwd">forall</span> (<span class="id">E</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>) (<span class="id">t</span> <span class="id">t</span>': <span class="id"><a href="CDF.FUN.html#type">type</a></span>) (<span class="id">a</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> (<span class="id">t</span> :: <span class="id">E</span>) <span class="id">t</span>') (<span class="id">b</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> <span class="id">E</span> <span class="id">t</span>),<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span>, <span class="id"><a href="CDF.FUN.html#Intrinsic.dterm">dterm</a></span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.App">App</a></span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.Abs">Abs</a></span> <span class="id">a</span>) <span class="id">b</span>) <span class="id">e</span> = <span class="id"><a href="CDF.FUN.html#Intrinsic.dterm">dterm</a></span> <span class="id">a</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.dterm">dterm</a></span> <span class="id">b</span> <span class="id">e</span>, <span class="id">e</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof24')">Proof.</span></div>
<div class="proofscript" id="proof24">
&nbsp;&nbsp;<span class="id">reflexivity</span>.<br/>
Qed.</div>
<br/>
<div class="doc">In preparation for a reduction semantics, we now build a substitution
    function over intrinsically-typed terms.
    The substitution of <span class="bracket"><span class="id">b</span></span> for variable of index 1 in <span class="bracket"><span class="id">a</span></span> has type
<pre>
   subst1 {t': type} {E: context} {t: type} (a: term (t' :: E) t) (b: term E t') : term E t</pre>
    and satisfies the equation <span class="bracket"><span class="id">dterm</span> (<span class="id">subst1</span> <span class="id">a</span> <span class="id">b</span>) <span class="id">e</span> = <span class="id">dterm</span> <span class="id">a</span> (<span class="id">dterm</span> <span class="id">b</span> <span class="id">e</span>, <span class="id">e</span>)</span>. </div>
<br/>
<div class="doc">Definiting the substitution function is difficult:
<ul>
<li>
   Since we use a positional notation, we need to "lift" by one certain
    variable indices (function <span class="bracket"><span class="id">lift</span></span> below).
</li>
<li>
   Our functions have complex dependent types.  On the one hand, these
    types guarantee type preservation by construction.  On the other hand,
    the functions are hard to write directly.
</li>
<li>
   We chose to prove semantic equations about our functions at the
    same time we define the functions, resulting in many subset types
    <span class="bracket"> { <span class="id">x</span> | <span class="id">P</span> <span class="id">x</span> } </span>.
</li>
</ul>
</div>
<br/>
<div class="doc">Lifting. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="Intrinsic.unlift_env">unlift_env</a></span> (<span class="id">E</span>': <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>) (<span class="id">t</span>': <span class="id"><a href="CDF.FUN.html#type">type</a></span>) (<span class="id">E</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>) : <span class="id"><a href="CDF.FUN.html#Intrinsic.dcontext">dcontext</a></span> (<span class="id">E</span>' ++ <span class="id">t</span>' :: <span class="id">E</span>) -&gt; <span class="id"><a href="CDF.FUN.html#Intrinsic.dcontext">dcontext</a></span> (<span class="id">E</span>' ++ <span class="id">E</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">E</span>' <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">e</span><br/>
&nbsp;&nbsp;| <span class="id">t</span> :: <span class="id">E</span>' =&gt; <span class="kwd">fun</span> <span class="id">e</span> =&gt; (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">e</span>, <span class="id">unlift_env</span> <span class="id">E</span>' <span class="id">t</span>' <span class="id">E</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">e</span>))<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Intrinsic.lift_var">lift_var</a></span>  (<span class="id">E</span>': <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>) (<span class="id">t</span>': <span class="id"><a href="CDF.FUN.html#type">type</a></span>) {<span class="id">E</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>} {<span class="id">t</span>: <span class="id"><a href="CDF.FUN.html#type">type</a></span>} (<span class="id">v</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.var">var</a></span> (<span class="id">E</span>' ++ <span class="id">E</span>) <span class="id">t</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">w</span> : <span class="id"><a href="CDF.FUN.html#Intrinsic.var">var</a></span> (<span class="id">E</span>' ++ <span class="id">t</span>' :: <span class="id">E</span>) <span class="id">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="kwd">forall</span> <span class="id">e</span>, <span class="id"><a href="CDF.FUN.html#Intrinsic.dvar">dvar</a></span> <span class="id">w</span> <span class="id">e</span> = <span class="id"><a href="CDF.FUN.html#Intrinsic.dvar">dvar</a></span> <span class="id">v</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.unlift_env">unlift_env</a></span> <span class="id">E</span>' <span class="id">t</span>' <span class="id">E</span> <span class="id">e</span>)}.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof25')">Proof.</span></div>
<div class="proofscript" id="proof25">
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">E</span>' <span class="id">t</span>' <span class="id">E</span> <span class="id">t</span> <span class="id">v</span>. <span class="id">induction</span> <span class="id">E</span>' <span class="kwd">as</span> [ | <span class="id">t0</span> <span class="id">E</span>' ]; <span class="id">cbn</span>.<br/>
- <span class="id">intros</span>. <span class="kwd">exists</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.VS">VS</a></span> <span class="id">v</span>). <span class="id">auto</span>.<br/>
- <span class="id">intros</span>. <span class="id">dependent</span> <span class="id">destruction</span> <span class="id">v</span>.<br/>
&nbsp;&nbsp;+ <span class="kwd">exists</span> <span class="id"><a href="CDF.FUN.html#Intrinsic.V1">V1</a></span>. <span class="id">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="id">destruct</span> (<span class="id">IHE</span>' <span class="id">t</span>' <span class="id">_</span> <span class="id">_</span> <span class="id">v</span>) <span class="kwd">as</span> (<span class="id">w</span> &amp; <span class="id">W</span>). <span class="kwd">exists</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.VS">VS</a></span> <span class="id">w</span>). <span class="id">intros</span>; <span class="id">cbn</span>. <span class="id">rewrite</span> <span class="id">W</span>; <span class="id">auto</span>.<br/>
Defined.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Intrinsic.lift">lift</a></span> (<span class="id">E</span>': <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>) (<span class="id">t</span>': <span class="id"><a href="CDF.FUN.html#type">type</a></span>) {<span class="id">E</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>} {<span class="id">t</span>: <span class="id"><a href="CDF.FUN.html#type">type</a></span>} (<span class="id">a</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> (<span class="id">E</span>' ++ <span class="id">E</span>) <span class="id">t</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">b</span> : <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> (<span class="id">E</span>' ++ <span class="id">t</span>' :: <span class="id">E</span>) <span class="id">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="kwd">forall</span> <span class="id">e</span>, <span class="id"><a href="CDF.FUN.html#Intrinsic.dterm">dterm</a></span> <span class="id">b</span> <span class="id">e</span> = <span class="id"><a href="CDF.FUN.html#Intrinsic.dterm">dterm</a></span> <span class="id">a</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.unlift_env">unlift_env</a></span> <span class="id">E</span>' <span class="id">t</span>' <span class="id">E</span> <span class="id">e</span>) }.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof26')">Proof.</span></div>
<div class="proofscript" id="proof26">
&nbsp;&nbsp;<span class="id">dependent</span> <span class="id">induction</span> <span class="id">a</span>.<br/>
- <span class="id">destruct</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.lift_var">lift_var</a></span> <span class="id">E</span>' <span class="id">t</span>' <span class="id">v</span>) <span class="kwd">as</span> (<span class="id">w</span> &amp; <span class="id">W</span>). <span class="kwd">exists</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.Var">Var</a></span> <span class="id">w</span>). <span class="id">auto</span>.<br/>
- <span class="id">destruct</span> (<span class="id">IHa</span> (<span class="id">t</span>::<span class="id">E</span>') <span class="id">_</span> <span class="id">a</span>) <span class="kwd">as</span> (<span class="id">b</span> &amp; <span class="id">B</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.Abs">Abs</a></span> <span class="id">b</span>). <span class="id">intros</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Logic.FunctionalExtensionality.html#functional_extensionality">functional_extensionality</a></span>; <span class="id">intros</span>. <span class="id">cbn</span>. <span class="id">rewrite</span> <span class="id">B</span>. <span class="id">auto</span>.<br/>
- <span class="id">destruct</span> (<span class="id">IHa1</span> <span class="id">E</span>' <span class="id">_</span> <span class="id">a1</span>) <span class="kwd">as</span> (<span class="id">b1</span> &amp; <span class="id">B1</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">IHa2</span> <span class="id">E</span>' <span class="id">_</span> <span class="id">a2</span>) <span class="kwd">as</span> (<span class="id">b2</span> &amp; <span class="id">B2</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.App">App</a></span> <span class="id">b1</span> <span class="id">b2</span>). <span class="id">cbn</span>; <span class="id">intros</span>. <span class="id">rewrite</span> <span class="id">B1</span>, <span class="id">B2</span>. <span class="id">auto</span>.<br/>
- <span class="kwd">exists</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.Const">Const</a></span> <span class="id">b</span>); <span class="id">auto</span>.<br/>
- <span class="id">destruct</span> (<span class="id">IHa1</span> <span class="id">E</span>' <span class="id">_</span> <span class="id">a1</span>) <span class="kwd">as</span> (<span class="id">b1</span> &amp; <span class="id">B1</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">IHa2</span> <span class="id">E</span>' <span class="id">_</span> <span class="id">a2</span>) <span class="kwd">as</span> (<span class="id">b2</span> &amp; <span class="id">B2</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">IHa3</span> <span class="id">E</span>' <span class="id">_</span> <span class="id">a3</span>) <span class="kwd">as</span> (<span class="id">b3</span> &amp; <span class="id">B3</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.Cond">Cond</a></span> <span class="id">b1</span> <span class="id">b2</span> <span class="id">b3</span>). <span class="id">intros</span>; <span class="id">cbn</span>. <span class="id">rewrite</span> <span class="id">B1</span>, <span class="id">B2</span>, <span class="id">B3</span>; <span class="id">auto</span>.<br/>
Defined.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Intrinsic.lift1">lift1</a></span> (<span class="id">t</span>': <span class="id"><a href="CDF.FUN.html#type">type</a></span>) {<span class="id">E</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>} {<span class="id">t</span>: <span class="id"><a href="CDF.FUN.html#type">type</a></span>} (<span class="id">a</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> <span class="id">E</span> <span class="id">t</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">b</span> : <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> (<span class="id">t</span>' :: <span class="id">E</span>) <span class="id">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="kwd">forall</span> <span class="id">e</span>, <span class="id"><a href="CDF.FUN.html#Intrinsic.dterm">dterm</a></span> <span class="id">b</span> <span class="id">e</span> = <span class="id"><a href="CDF.FUN.html#Intrinsic.dterm">dterm</a></span> <span class="id">a</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">e</span>) }.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof27')">Proof.</span></div>
<div class="proofscript" id="proof27">
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#Intrinsic.lift">lift</a></span> <span class="kwd">with</span> (<span class="id">E</span>' := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>).<br/>
Defined.</div>
<br/>
<div class="doc">Substitution. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="Intrinsic.proj_env">proj_env</a></span> (<span class="id">E</span>': <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>) (<span class="id">E</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>) : <span class="id"><a href="CDF.FUN.html#Intrinsic.dcontext">dcontext</a></span> (<span class="id">E</span>' ++ <span class="id">E</span>) -&gt; <span class="id"><a href="CDF.FUN.html#Intrinsic.dcontext">dcontext</a></span> <span class="id">E</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">E</span>' <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="id">e</span><br/>
&nbsp;&nbsp;| <span class="id">t</span> :: <span class="id">E</span>' =&gt; <span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="id">proj_env</span> <span class="id">E</span>' <span class="id">E</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">e</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="Intrinsic.unsubst_env">unsubst_env</a></span> (<span class="id">E</span>': <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>) (<span class="id">t</span>': <span class="id"><a href="CDF.FUN.html#type">type</a></span>) (<span class="id">E</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>) : <span class="id"><a href="CDF.FUN.html#Intrinsic.dcontext">dcontext</a></span> (<span class="id">E</span>' ++  <span class="id">E</span>) -&gt; <span class="id"><a href="CDF.FUN.html#Intrinsic.dtype">dtype</a></span> <span class="id">t</span>' -&gt; <span class="id"><a href="CDF.FUN.html#Intrinsic.dcontext">dcontext</a></span> (<span class="id">E</span>' ++ <span class="id">t</span>' :: <span class="id">E</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">E</span>' <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; (<span class="id">v</span>, <span class="id">e</span>)<br/>
&nbsp;&nbsp;| <span class="id">t</span> :: <span class="id">E</span>' =&gt; <span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">e</span>, <span class="id">unsubst_env</span> <span class="id">E</span>' <span class="id">t</span>' <span class="id">E</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">e</span>) <span class="id">v</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Intrinsic.subst_var">subst_var</a></span> (<span class="id">E</span>': <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>) (<span class="id">t</span>': <span class="id"><a href="CDF.FUN.html#type">type</a></span>) {<span class="id">E</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>} {<span class="id">t</span>: <span class="id"><a href="CDF.FUN.html#type">type</a></span>} (<span class="id">v</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.var">var</a></span> (<span class="id">E</span>' ++ <span class="id">t</span>' :: <span class="id">E</span>) <span class="id">t</span>) (<span class="id">b</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> <span class="id">E</span> <span class="id">t</span>') :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">c</span> : <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> (<span class="id">E</span>' ++ <span class="id">E</span>) <span class="id">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="kwd">forall</span> <span class="id">e</span>, <span class="id"><a href="CDF.FUN.html#Intrinsic.dterm">dterm</a></span> <span class="id">c</span> <span class="id">e</span> = <span class="id"><a href="CDF.FUN.html#Intrinsic.dvar">dvar</a></span> <span class="id">v</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.unsubst_env">unsubst_env</a></span> <span class="id">E</span>' <span class="id">t</span>' <span class="id">E</span> <span class="id">e</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.dterm">dterm</a></span> <span class="id">b</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.proj_env">proj_env</a></span> <span class="id">E</span>' <span class="id">E</span> <span class="id">e</span>))) }.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof28')">Proof.</span></div>
<div class="proofscript" id="proof28">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">E</span>' <span class="kwd">as</span> [ | <span class="id">t0</span> <span class="id">E</span>' ]; <span class="id">simpl</span>.<br/>
- <span class="id">dependent</span> <span class="id">destruction</span> <span class="id">v</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;+ <span class="kwd">exists</span> <span class="id">b</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="kwd">exists</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.Var">Var</a></span> <span class="id">v</span>); <span class="id">auto</span>.<br/>
- <span class="id">dependent</span> <span class="id">destruction</span> <span class="id">v</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;+ <span class="kwd">exists</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.Var">Var</a></span> <span class="id"><a href="CDF.FUN.html#Intrinsic.V1">V1</a></span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="id">destruct</span> (<span class="id">IHE</span>' <span class="id">v</span>) <span class="kwd">as</span> (<span class="id">c</span> &amp; <span class="id">C</span>). <span class="id">destruct</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.lift1">lift1</a></span> <span class="id">t0</span> <span class="id">c</span>) <span class="kwd">as</span> (<span class="id">c</span>' &amp; <span class="id">C</span>'). <span class="kwd">exists</span> <span class="id">c</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>; <span class="id">intros</span>. <span class="id">rewrite</span> <span class="id">C</span>', <span class="id">C</span>. <span class="id">auto</span>.<br/>
Defined.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Intrinsic.subst">subst</a></span> (<span class="id">E</span>': <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>) (<span class="id">t</span>': <span class="id"><a href="CDF.FUN.html#type">type</a></span>) {<span class="id">E</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>} {<span class="id">t</span>: <span class="id"><a href="CDF.FUN.html#type">type</a></span>} (<span class="id">a</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> (<span class="id">E</span>' ++ <span class="id">t</span>' :: <span class="id">E</span>) <span class="id">t</span>) (<span class="id">b</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> <span class="id">E</span> <span class="id">t</span>') :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">c</span> : <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> (<span class="id">E</span>' ++ <span class="id">E</span>) <span class="id">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="kwd">forall</span> <span class="id">e</span>, <span class="id"><a href="CDF.FUN.html#Intrinsic.dterm">dterm</a></span> <span class="id">c</span> <span class="id">e</span> = <span class="id"><a href="CDF.FUN.html#Intrinsic.dterm">dterm</a></span> <span class="id">a</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.unsubst_env">unsubst_env</a></span> <span class="id">E</span>' <span class="id">t</span>' <span class="id">E</span> <span class="id">e</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.dterm">dterm</a></span> <span class="id">b</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.proj_env">proj_env</a></span> <span class="id">E</span>' <span class="id">E</span> <span class="id">e</span>))) }.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof29')">Proof.</span></div>
<div class="proofscript" id="proof29">
&nbsp;&nbsp;<span class="id">dependent</span> <span class="id">induction</span> <span class="id">a</span>.<br/>
- <span class="id">apply</span> <span class="id"><a href="CDF.FUN.html#Intrinsic.subst_var">subst_var</a></span>. <br/>
- <span class="id">edestruct</span> (<span class="id">IHa</span> (<span class="id">t</span> :: <span class="id">E</span>') <span class="id">t</span>' <span class="id">E</span> <span class="id">a</span>) <span class="kwd">as</span> (<span class="id">c</span> &amp; <span class="id">C</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.Abs">Abs</a></span> <span class="id">c</span>). <span class="id">intros</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Logic.FunctionalExtensionality.html#functional_extensionality">functional_extensionality</a></span>. <span class="id">intros</span> <span class="id">v</span>; <span class="id">simpl</span>. <br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">C</span>. <span class="id">simpl</span>. <span class="id">eauto</span>.<br/>
- <span class="id">edestruct</span> (<span class="id">IHa1</span> <span class="id">E</span>' <span class="id">t</span>' <span class="id">E</span> <span class="id">a1</span>) <span class="kwd">as</span> (<span class="id">c1</span> &amp; <span class="id">C1</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">edestruct</span> (<span class="id">IHa2</span> <span class="id">E</span>' <span class="id">t</span>' <span class="id">E</span> <span class="id">a2</span>) <span class="kwd">as</span> (<span class="id">c2</span> &amp; <span class="id">C2</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.App">App</a></span> <span class="id">c1</span> <span class="id">c2</span>). <span class="id">simpl</span>; <span class="id">intros</span>. <span class="id">rewrite</span> <span class="id">C1</span>, <span class="id">C2</span>. <span class="id">eauto</span>.<br/>
- <span class="kwd">exists</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.Const">Const</a></span> <span class="id">b</span>). <span class="id">simpl</span>; <span class="id">auto</span>.<br/>
- <span class="id">edestruct</span> (<span class="id">IHa1</span> <span class="id">E</span>' <span class="id">t</span>' <span class="id">E</span> <span class="id">a1</span>) <span class="kwd">as</span> (<span class="id">c1</span> &amp; <span class="id">C1</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">edestruct</span> (<span class="id">IHa2</span> <span class="id">E</span>' <span class="id">t</span>' <span class="id">E</span> <span class="id">a2</span>) <span class="kwd">as</span> (<span class="id">c2</span> &amp; <span class="id">C2</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">edestruct</span> (<span class="id">IHa3</span> <span class="id">E</span>' <span class="id">t</span>' <span class="id">E</span> <span class="id">a3</span>) <span class="kwd">as</span> (<span class="id">c3</span> &amp; <span class="id">C3</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.Cond">Cond</a></span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">c3</span>). <span class="id">simpl</span>; <span class="id">intros</span>. <span class="id">rewrite</span> <span class="id">C1</span>, <span class="id">C2</span>, <span class="id">C3</span>. <span class="id">eauto</span>.<br/>
Defined.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Intrinsic.subst1">subst1</a></span> {<span class="id">t</span>': <span class="id"><a href="CDF.FUN.html#type">type</a></span>} {<span class="id">E</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>} {<span class="id">t</span>: <span class="id"><a href="CDF.FUN.html#type">type</a></span>} (<span class="id">a</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> (<span class="id">t</span>' :: <span class="id">E</span>) <span class="id">t</span>) (<span class="id">b</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> <span class="id">E</span> <span class="id">t</span>') : <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> <span class="id">E</span> <span class="id">t</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.subst">subst</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> <span class="id">t</span>' <span class="id">a</span> <span class="id">b</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Intrinsic.dterm_subst1">dterm_subst1</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">t</span>': <span class="id"><a href="CDF.FUN.html#type">type</a></span>} {<span class="id">E</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>} {<span class="id">t</span>: <span class="id"><a href="CDF.FUN.html#type">type</a></span>} (<span class="id">a</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> (<span class="id">t</span>' :: <span class="id">E</span>) <span class="id">t</span>) (<span class="id">b</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> <span class="id">E</span> <span class="id">t</span>') <span class="id">e</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.FUN.html#Intrinsic.dterm">dterm</a></span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.subst1">subst1</a></span> <span class="id">a</span> <span class="id">b</span>) <span class="id">e</span> = <span class="id"><a href="CDF.FUN.html#Intrinsic.dterm">dterm</a></span> <span class="id">a</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.dterm">dterm</a></span> <span class="id">b</span> <span class="id">e</span>, <span class="id">e</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof30')">Proof.</span></div>
<div class="proofscript" id="proof30">
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">unfold</span> <span class="id"><a href="CDF.FUN.html#Intrinsic.subst1">subst1</a></span>. <span class="id">destruct</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.subst">subst</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> <span class="id">t</span>' <span class="id">a</span> <span class="id">b</span>) <span class="kwd">as</span> (<span class="id">c</span> &amp; <span class="id">C</span>). <span class="id">apply</span> <span class="id">C</span>. <br/>
Qed.</div>
<br/>
<div class="doc">The reduction semantics. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="Intrinsic.isvalue">isvalue</a></span>: <span class="kwd">forall</span> (<span class="id">E</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.context">context</a></span>) (<span class="id">t</span>: <span class="id"><a href="CDF.FUN.html#type">type</a></span>), <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> <span class="id">E</span> <span class="id">t</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="Intrinsic.V_Abs">V_Abs</a></span>: <span class="kwd">forall</span> <span class="id">E</span> <span class="id">t1</span> <span class="id">t2</span> (<span class="id">a</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> (<span class="id">t1</span> :: <span class="id">E</span>) <span class="id">t2</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">isvalue</span> <span class="id">E</span> (<span class="id"><a href="CDF.FUN.html#Fun">Fun</a></span> <span class="id">t1</span> <span class="id">t2</span>) (<span class="id"><a href="CDF.FUN.html#Intrinsic.Abs">Abs</a></span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="Intrinsic.V_Const">V_Const</a></span>: <span class="kwd">forall</span> <span class="id">E</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">isvalue</span> <span class="id">E</span> <span class="id"><a href="CDF.FUN.html#Bool">Bool</a></span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.Const">Const</a></span> <span class="id">b</span>).<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="Intrinsic.red">red</a></span>: <span class="kwd">forall</span> <span class="id">E</span> <span class="id">t</span>, <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> <span class="id">E</span> <span class="id">t</span> -&gt; <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> <span class="id">E</span> <span class="id">t</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="Intrinsic.red_beta">red_beta</a></span>: <span class="kwd">forall</span> <span class="id">E</span> <span class="id">t1</span> <span class="id">t2</span> (<span class="id">a</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> (<span class="id">t1</span> :: <span class="id">E</span>) <span class="id">t2</span>) (<span class="id">v</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> <span class="id">E</span> <span class="id">t1</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.FUN.html#Intrinsic.isvalue">isvalue</a></span> <span class="id">E</span> <span class="id">t1</span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> <span class="id">E</span> <span class="id">t2</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.App">App</a></span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.Abs">Abs</a></span> <span class="id">a</span>) <span class="id">v</span>) (<span class="id"><a href="CDF.FUN.html#Intrinsic.subst1">subst1</a></span> <span class="id">a</span> <span class="id">v</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="Intrinsic.red_cond">red_cond</a></span>: <span class="kwd">forall</span> <span class="id">E</span> <span class="id">t</span> (<span class="id">b</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>) (<span class="id">ifso</span> <span class="id">ifnot</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> <span class="id">E</span> <span class="id">t</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> <span class="id">E</span> <span class="id">t</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.Cond">Cond</a></span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.Const">Const</a></span> <span class="id">b</span>) <span class="id">ifso</span> <span class="id">ifnot</span>) (<span class="kwd">if</span> <span class="id">b</span> <span class="kwd">then</span> <span class="id">ifso</span> <span class="kwd">else</span> <span class="id">ifnot</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="Intrinsic.red_app_1">red_app_1</a></span>: <span class="kwd">forall</span> <span class="id">E</span> <span class="id">t</span> <span class="id">t</span>' (<span class="id">a1</span> <span class="id">a1</span>': <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> <span class="id">E</span> (<span class="id"><a href="CDF.FUN.html#Fun">Fun</a></span> <span class="id">t</span> <span class="id">t</span>')) (<span class="id">a2</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> <span class="id">E</span> <span class="id">t</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> <span class="id">E</span> (<span class="id"><a href="CDF.FUN.html#Fun">Fun</a></span> <span class="id">t</span> <span class="id">t</span>') <span class="id">a1</span> <span class="id">a1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> <span class="id">E</span> <span class="id">t</span>' (<span class="id"><a href="CDF.FUN.html#Intrinsic.App">App</a></span> <span class="id">a1</span> <span class="id">a2</span>) (<span class="id"><a href="CDF.FUN.html#Intrinsic.App">App</a></span> <span class="id">a1</span>' <span class="id">a2</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="Intrinsic.red_app_2">red_app_2</a></span>: <span class="kwd">forall</span> <span class="id">E</span> <span class="id">t</span> <span class="id">t</span>' (<span class="id">v</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> <span class="id">E</span> (<span class="id"><a href="CDF.FUN.html#Fun">Fun</a></span> <span class="id">t</span> <span class="id">t</span>')) (<span class="id">a2</span> <span class="id">a2</span>': <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> <span class="id">E</span> <span class="id">t</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.FUN.html#Intrinsic.isvalue">isvalue</a></span> <span class="id">E</span> (<span class="id"><a href="CDF.FUN.html#Fun">Fun</a></span> <span class="id">t</span> <span class="id">t</span>') <span class="id">v</span> -&gt; <span class="id">red</span> <span class="id">E</span> <span class="id">t</span> <span class="id">a2</span> <span class="id">a2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> <span class="id">E</span> <span class="id">t</span>' (<span class="id"><a href="CDF.FUN.html#Intrinsic.App">App</a></span> <span class="id">v</span> <span class="id">a2</span>) (<span class="id"><a href="CDF.FUN.html#Intrinsic.App">App</a></span> <span class="id">v</span> <span class="id">a2</span>')<br/>
&nbsp;&nbsp;| <span class="id"><a name="Intrinsic.red_cond_1">red_cond_1</a></span>: <span class="kwd">forall</span> <span class="id">E</span> <span class="id">t</span> (<span class="id">a</span> <span class="id">a</span>': <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> <span class="id">E</span> <span class="id"><a href="CDF.FUN.html#Bool">Bool</a></span>) (<span class="id">ifso</span> <span class="id">ifnot</span>: <span class="id"><a href="CDF.FUN.html#Intrinsic.term">term</a></span> <span class="id">E</span> <span class="id">t</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> <span class="id">E</span> <span class="id"><a href="CDF.FUN.html#Bool">Bool</a></span> <span class="id">a</span> <span class="id">a</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">red</span> <span class="id">E</span> <span class="id">t</span> (<span class="id"><a href="CDF.FUN.html#Intrinsic.Cond">Cond</a></span> <span class="id">a</span> <span class="id">ifso</span> <span class="id">ifnot</span>) (<span class="id"><a href="CDF.FUN.html#Intrinsic.Cond">Cond</a></span> <span class="id">a</span>' <span class="id">ifso</span> <span class="id">ifnot</span>).<br/>
<br/>
<div class="doc">Reductions are compatible with the denotational semantics. </div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="Intrinsic.red_denot">red_denot</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">E</span> <span class="id">t</span> <span class="id">a1</span> <span class="id">a2</span>, <span class="id"><a href="CDF.FUN.html#Intrinsic.red">red</a></span> <span class="id">E</span> <span class="id">t</span> <span class="id">a1</span> <span class="id">a2</span> -&gt; <span class="kwd">forall</span> <span class="id">e</span>, <span class="id"><a href="CDF.FUN.html#Intrinsic.dterm">dterm</a></span> <span class="id">a1</span> <span class="id">e</span> = <span class="id"><a href="CDF.FUN.html#Intrinsic.dterm">dterm</a></span> <span class="id">a2</span> <span class="id">e</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof31')">Proof.</span></div>
<div class="proofscript" id="proof31">
&nbsp;&nbsp;<span class="id">induction</span> 1; <span class="id">simpl</span>; <span class="id">intros</span>.<br/>
- <span class="id">rewrite</span> <span class="id"><a href="CDF.FUN.html#Intrinsic.dterm_subst1">dterm_subst1</a></span>; <span class="id">auto</span>.<br/>
- <span class="id">destruct</span> <span class="id">b</span>; <span class="id">auto</span>.<br/>
- <span class="id">rewrite</span> <span class="id">IHred</span>; <span class="id">auto</span>.<br/>
- <span class="id">rewrite</span> <span class="id">IHred</span>; <span class="id">auto</span>.<br/>
- <span class="id">rewrite</span> <span class="id">IHred</span>; <span class="id">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.FUN.html#Intrinsic">Intrinsic</a></span>.<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
